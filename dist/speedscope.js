// modules are defined as an array
// [ module function, map of requires ]
//
// map of requires is short require name -> numeric require
//
// anything defined in a previous bundle is accessed via the
// orig method which is the require for previous bundles

require = (function (modules, cache, entry) {
  // Save the require from previous bundle to this closure if any
  var previousRequire = typeof require === "function" && require;

  function newRequire(name, jumped) {
    if (!cache[name]) {
      if (!modules[name]) {
        // if we cannot find the module within our internal map or
        // cache jump to the current global require ie. the last bundle
        // that was added to the page.
        var currentRequire = typeof require === "function" && require;
        if (!jumped && currentRequire) {
          return currentRequire(name, true);
        }

        // If there are other bundles on this page the require from the
        // previous one is saved to 'previousRequire'. Repeat this as
        // many times as there are bundles until the module is found or
        // we exhaust the require chain.
        if (previousRequire) {
          return previousRequire(name, true);
        }

        var err = new Error('Cannot find module \'' + name + '\'');
        err.code = 'MODULE_NOT_FOUND';
        throw err;
      }
      
      localRequire.resolve = resolve;

      var module = cache[name] = new newRequire.Module;

      modules[name][0].call(module.exports, localRequire, module, module.exports);
    }

    return cache[name].exports;

    function localRequire(x){
      return newRequire(localRequire.resolve(x));
    }

    function resolve(x){
      return modules[name][1][x] || x;
    }
  }

  function Module() {
    this.bundle = newRequire;
    this.exports = {};
  }

  newRequire.Module = Module;
  newRequire.modules = modules;
  newRequire.cache = cache;
  newRequire.parent = previousRequire;

  for (var i = 0; i < entry.length; i++) {
    newRequire(entry[i]);
  }

  // Override the current require with this new one
  return newRequire;
})({3:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});function e(){}var t={},n=[],o=[];function r(r,i){var l,a,p,s,c=o;for(s=arguments.length;s-- >2;)n.push(arguments[s]);for(i&&null!=i.children&&(n.length||n.push(i.children),delete i.children);n.length;)if((a=n.pop())&&void 0!==a.pop)for(s=a.length;s--;)n.push(a[s]);else"boolean"==typeof a&&(a=null),(p="function"!=typeof r)&&(null==a?a="":"number"==typeof a?a=String(a):"string"!=typeof a&&(p=!1)),p&&l?c[c.length-1]+=a:c===o?c=[a]:c.push(a),l=p;var u=new e;return u.nodeName=r,u.children=c,u.attributes=null==i?void 0:i,u.key=null==i?void 0:i.key,void 0!==t.vnode&&t.vnode(u),u}function i(e,t){for(var n in t)e[n]=t[n];return e}var l="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function a(e,t){return r(e.nodeName,i(i({},e.attributes),t),arguments.length>2?[].slice.call(arguments,2):e.children)}var p=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,s=[];function c(e){!e._dirty&&(e._dirty=!0)&&1==s.push(e)&&(t.debounceRendering||l)(u)}function u(){var e,t=s;for(s=[];e=t.pop();)e._dirty&&A(e)}function f(e,t,n){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&d(e,t.nodeName):n||e._componentConstructor===t.nodeName}function d(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function _(e){var t=i({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(void 0!==n)for(var o in n)void 0===t[o]&&(t[o]=n[o]);return t}function v(e,t){var n=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return n.normalizedNodeName=e,n}function m(e){var t=e.parentNode;t&&t.removeChild(e)}function h(e,t,n,o,r){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)n&&n(null),o&&o(e);else if("class"!==t||r)if("style"===t){if(o&&"string"!=typeof o&&"string"!=typeof n||(e.style.cssText=o||""),o&&"object"==typeof o){if("string"!=typeof n)for(var i in n)i in o||(e.style[i]="");for(var i in o)e.style[i]="number"==typeof o[i]&&!1===p.test(i)?o[i]+"px":o[i]}}else if("dangerouslySetInnerHTML"===t)o&&(e.innerHTML=o.__html||"");else if("o"==t[0]&&"n"==t[1]){var l=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),o?n||e.addEventListener(t,y,l):e.removeEventListener(t,y,l),(e._listeners||(e._listeners={}))[t]=o}else if("list"!==t&&"type"!==t&&!r&&t in e)b(e,t,null==o?"":o),null!=o&&!1!==o||e.removeAttribute(t);else{var a=r&&t!==(t=t.replace(/^xlink\:?/,""));null==o||!1===o?a?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof o&&(a?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),o):e.setAttribute(t,o))}else e.className=o||""}function b(e,t,n){try{e[t]=n}catch(e){}}function y(e){return this._listeners[e.type](t.event&&t.event(e)||e)}var x=[],C=0,g=!1,N=!1;function k(){for(var e;e=x.pop();)t.afterMount&&t.afterMount(e),e.componentDidMount&&e.componentDidMount()}function w(e,t,n,o,r,i){C++||(g=null!=r&&void 0!==r.ownerSVGElement,N=null!=e&&!("__preactattr_"in e));var l=S(e,t,n,o,i);return r&&l.parentNode!==r&&r.appendChild(l),--C||(N=!1,i||k()),l}function S(e,t,n,o,r){var i=e,l=g;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||r)?e.nodeValue!=t&&(e.nodeValue=t):(i=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(i,e),L(e,!0))),i.__preactattr_=!0,i;var a=t.nodeName;if("function"==typeof a)return D(e,t,n,o);if(g="svg"===a||"foreignObject"!==a&&g,a=String(a),(!e||!d(e,a))&&(i=v(a,g),e)){for(;e.firstChild;)i.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(i,e),L(e,!0)}var p=i.firstChild,s=i.__preactattr_,c=t.children;if(null==s){s=i.__preactattr_={};for(var u=i.attributes,f=u.length;f--;)s[u[f].name]=u[f].value}return!N&&c&&1===c.length&&"string"==typeof c[0]&&null!=p&&void 0!==p.splitText&&null==p.nextSibling?p.nodeValue!=c[0]&&(p.nodeValue=c[0]):(c&&c.length||null!=p)&&U(i,c,n,o,N||null!=s.dangerouslySetInnerHTML),P(i,t.attributes,s),g=l,i}function U(e,t,n,o,r){var i,l,a,p,s,c=e.childNodes,u=[],d={},_=0,v=0,h=c.length,b=0,y=t?t.length:0;if(0!==h)for(var x=0;x<h;x++){var C=c[x],g=C.__preactattr_;null!=(N=y&&g?C._component?C._component.__key:g.key:null)?(_++,d[N]=C):(g||(void 0!==C.splitText?!r||C.nodeValue.trim():r))&&(u[b++]=C)}if(0!==y)for(x=0;x<y;x++){s=null;var N;if(null!=(N=(p=t[x]).key))_&&void 0!==d[N]&&(s=d[N],d[N]=void 0,_--);else if(!s&&v<b)for(i=v;i<b;i++)if(void 0!==u[i]&&f(l=u[i],p,r)){s=l,u[i]=void 0,i===b-1&&b--,i===v&&v++;break}s=S(s,p,n,o),a=c[x],s&&s!==e&&s!==a&&(null==a?e.appendChild(s):s===a.nextSibling?m(a):e.insertBefore(s,a))}if(_)for(var x in d)void 0!==d[x]&&L(d[x],!1);for(;v<=b;)void 0!==(s=u[b--])&&L(s,!1)}function L(e,t){var n=e._component;n?H(n):(null!=e.__preactattr_&&e.__preactattr_.ref&&e.__preactattr_.ref(null),!1!==t&&null!=e.__preactattr_||m(e),M(e))}function M(e){for(e=e.lastChild;e;){var t=e.previousSibling;L(e,!0),e=t}}function P(e,t,n){var o;for(o in n)t&&null!=t[o]||null==n[o]||h(e,o,n[o],n[o]=void 0,g);for(o in t)"children"===o||"innerHTML"===o||o in n&&t[o]===("value"===o||"checked"===o?e[o]:n[o])||h(e,o,n[o],n[o]=t[o],g)}var T={};function B(e){var t=e.constructor.name;(T[t]||(T[t]=[])).push(e)}function E(e,t,n){var o,r=T[e.name];if(e.prototype&&e.prototype.render?(o=new e(t,n),j.call(o,t,n)):((o=new j(t,n)).constructor=e,o.render=W),r)for(var i=r.length;i--;)if(r[i].constructor===e){o.nextBase=r[i].nextBase,r.splice(i,1);break}return o}function W(e,t,n){return this.constructor(e,n)}function V(e,n,o,r,i){e._disable||(e._disable=!0,(e.__ref=n.ref)&&delete n.ref,(e.__key=n.key)&&delete n.key,!e.base||i?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(n,r),r&&r!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=r),e.prevProps||(e.prevProps=e.props),e.props=n,e._disable=!1,0!==o&&(1!==o&&!1===t.syncComponentUpdates&&e.base?c(e):A(e,1,i)),e.__ref&&e.__ref(e))}function A(e,n,o,r){if(!e._disable){var l,a,p,s=e.props,c=e.state,u=e.context,f=e.prevProps||s,d=e.prevState||c,v=e.prevContext||u,m=e.base,h=e.nextBase,b=m||h,y=e._component,g=!1;if(m&&(e.props=f,e.state=d,e.context=v,2!==n&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(s,c,u)?g=!0:e.componentWillUpdate&&e.componentWillUpdate(s,c,u),e.props=s,e.state=c,e.context=u),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!g){l=e.render(s,c,u),e.getChildContext&&(u=i(i({},u),e.getChildContext()));var N,S,U=l&&l.nodeName;if("function"==typeof U){var M=_(l);(a=y)&&a.constructor===U&&M.key==a.__key?V(a,M,1,u,!1):(N=a,e._component=a=E(U,M,u),a.nextBase=a.nextBase||h,a._parentComponent=e,V(a,M,0,u,!1),A(a,1,o,!0)),S=a.base}else p=b,(N=y)&&(p=e._component=null),(b||1===n)&&(p&&(p._component=null),S=w(p,l,u,o||!m,b&&b.parentNode,!0));if(b&&S!==b&&a!==y){var P=b.parentNode;P&&S!==P&&(P.replaceChild(S,b),N||(b._component=null,L(b,!1)))}if(N&&H(N),e.base=S,S&&!r){for(var T=e,B=e;B=B._parentComponent;)(T=B).base=S;S._component=T,S._componentConstructor=T.constructor}}if(!m||o?x.unshift(e):g||(e.componentDidUpdate&&e.componentDidUpdate(f,d,v),t.afterUpdate&&t.afterUpdate(e)),null!=e._renderCallbacks)for(;e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);C||r||k()}}function D(e,t,n,o){for(var r=e&&e._component,i=r,l=e,a=r&&e._componentConstructor===t.nodeName,p=a,s=_(t);r&&!p&&(r=r._parentComponent);)p=r.constructor===t.nodeName;return r&&p&&(!o||r._component)?(V(r,s,3,n,o),e=r.base):(i&&!a&&(H(i),e=l=null),r=E(t.nodeName,s,n),e&&!r.nextBase&&(r.nextBase=e,l=null),V(r,s,1,n,o),e=r.base,l&&e!==l&&(l._component=null,L(l,!1))),e}function H(e){t.beforeUnmount&&t.beforeUnmount(e);var n=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var o=e._component;o?H(o):n&&(n.__preactattr_&&n.__preactattr_.ref&&n.__preactattr_.ref(null),e.nextBase=n,m(n),B(e),M(n)),e.__ref&&e.__ref(null)}function j(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{}}i(j.prototype,{setState:function(e,t){var n=this.state;this.prevState||(this.prevState=i({},n)),i(n,"function"==typeof e?e(n,this.props):e),t&&(this._renderCallbacks=this._renderCallbacks||[]).push(t),c(this)},forceUpdate:function(e){e&&(this._renderCallbacks=this._renderCallbacks||[]).push(e),A(this,2)},render:function(){}});function z(e,t,n){return w(n,e,{},!1,t,!1)}var R={h:r,createElement:r,cloneElement:a,Component:j,render:z,rerender:u,options:t};exports.h=r,exports.createElement=r,exports.cloneElement=a,exports.Component=j,exports.render=z,exports.rerender=u,exports.options=t,exports.default=R;
},{}],36:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;function e(e){return e.charAt(0).toUpperCase()+e.slice(1)}module.exports=exports.default;
},{}],31:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=require("./capitalizeString"),t=r(e);function r(e){return e&&e.__esModule?e:{default:e}}function u(e,r,u){if(e.hasOwnProperty(r))for(var o=e[r],a=0,l=o.length;a<l;++a)u[o[a]+(0,t.default)(r)]=u[r]}module.exports=exports.default;
},{"./capitalizeString":36}],32:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;function e(e,t,r,o,u){for(var s=0,f=e.length;s<f;++s){var l=e[s](t,r,o,u);if(l)return l}}module.exports=exports.default;
},{}],34:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=r;function e(e,r){-1===e.indexOf(r)&&e.push(r)}function r(r,t){if(Array.isArray(t))for(var o=0,s=t.length;o<s;++o)e(r,t[o]);else e(r,t)}module.exports=exports.default;
},{}],33:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;function e(e){return e instanceof Object&&!Array.isArray(e)}module.exports=exports.default;
},{}],24:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=n;var e=require("../utils/prefixProperty"),r=s(e),t=require("../utils/prefixValue"),u=s(t),l=require("../utils/addNewValuesOnly"),a=s(l),i=require("../utils/isObject"),f=s(i);function s(e){return e&&e.__esModule?e:{default:e}}function n(e){var t=e.prefixMap,l=e.plugins;function i(e){for(var s in e){var n=e[s];if((0,f.default)(n))e[s]=i(n);else if(Array.isArray(n)){for(var d=[],o=0,p=n.length;o<p;++o){var v=(0,u.default)(l,s,n[o],e,t);(0,a.default)(d,v||n[o])}d.length>0&&(e[s]=d)}else{var x=(0,u.default)(l,s,n,e,t);x&&(e[s]=x),(0,r.default)(t,s,e)}}return e}return i}module.exports=exports.default;
},{"../utils/prefixProperty":31,"../utils/prefixValue":32,"../utils/addNewValuesOnly":34,"../utils/isObject":33}],50:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=t;var e=/-webkit-|-moz-|-ms-/;function t(t){return"string"==typeof t&&e.test(t)}module.exports=exports.default;
},{}],40:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=i;var e=require("css-in-js-utils/lib/isPrefixedValue"),t=r(e);function r(e){return e&&e.__esModule?e:{default:e}}var u=["-webkit-","-moz-",""];function i(e,r){if("string"==typeof r&&!(0,t.default)(r)&&r.indexOf("calc(")>-1)return u.map(function(e){return r.replace(/calc\(/g,e+"calc(")})}module.exports=exports.default;
},{"css-in-js-utils/lib/isPrefixedValue":50}],37:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=require("css-in-js-utils/lib/isPrefixedValue"),r=t(e);function t(e){return e&&e.__esModule?e:{default:e}}var s=["-webkit-",""];function u(e,t){if("string"==typeof t&&!(0,r.default)(t)&&t.indexOf("cross-fade(")>-1)return s.map(function(e){return t.replace(/cross-fade\(/g,e+"cross-fade(")})}module.exports=exports.default;
},{"css-in-js-utils/lib/isPrefixedValue":50}],38:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=o;var e=["-webkit-","-moz-",""],r={"zoom-in":!0,"zoom-out":!0,grab:!0,grabbing:!0};function o(o,t){if("cursor"===o&&r.hasOwnProperty(t))return e.map(function(e){return e+t})}module.exports=exports.default;
},{}],42:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=require("css-in-js-utils/lib/isPrefixedValue"),t=r(e);function r(e){return e&&e.__esModule?e:{default:e}}var i=["-webkit-",""];function u(e,r){if("string"==typeof r&&!(0,t.default)(r)&&r.indexOf("filter(")>-1)return i.map(function(e){return r.replace(/filter\(/g,e+"filter(")})}module.exports=exports.default;
},{"css-in-js-utils/lib/isPrefixedValue":50}],48:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=i;var e={flex:["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex","flex"],"inline-flex":["-webkit-inline-box","-moz-inline-box","-ms-inline-flexbox","-webkit-inline-flex","inline-flex"]};function i(i,l){if("display"===i&&e.hasOwnProperty(l))return e[l]}module.exports=exports.default;
},{}],39:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=s;var e={"space-around":"distribute","space-between":"justify","flex-start":"start","flex-end":"end"},t={alignContent:"msFlexLinePack",alignSelf:"msFlexItemAlign",alignItems:"msFlexAlign",justifyContent:"msFlexPack",order:"msFlexOrder",flexGrow:"msFlexPositive",flexShrink:"msFlexNegative",flexBasis:"msFlexPreferredSize"};function s(s,l,r){t.hasOwnProperty(s)&&(r[t[s]]=e[l]||l)}module.exports=exports.default;
},{}],41:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=i;var e={"space-around":"justify","space-between":"justify","flex-start":"start","flex-end":"end","wrap-reverse":"multiple",wrap:"multiple"},t={alignItems:"WebkitBoxAlign",justifyContent:"WebkitBoxPack",flexWrap:"WebkitBoxLines"};function i(i,r,o){"flexDirection"===i&&"string"==typeof r&&(r.indexOf("column")>-1?o.WebkitBoxOrient="vertical":o.WebkitBoxOrient="horizontal",r.indexOf("reverse")>-1?o.WebkitBoxDirection="reverse":o.WebkitBoxDirection="normal"),t.hasOwnProperty(i)&&(o[t[i]]=e[r]||r)}module.exports=exports.default;
},{}],44:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=n;var e=require("css-in-js-utils/lib/isPrefixedValue"),t=r(e);function r(e){return e&&e.__esModule?e:{default:e}}var i=["-webkit-","-moz-",""],a=/linear-gradient|radial-gradient|repeating-linear-gradient|repeating-radial-gradient/;function n(e,r){if("string"==typeof r&&!(0,t.default)(r)&&a.test(r))return i.map(function(e){return e+r})}module.exports=exports.default;
},{"css-in-js-utils/lib/isPrefixedValue":50}],43:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=require("css-in-js-utils/lib/isPrefixedValue"),t=r(e);function r(e){return e&&e.__esModule?e:{default:e}}var i=["-webkit-",""];function u(e,r){if("string"==typeof r&&!(0,t.default)(r)&&r.indexOf("image-set(")>-1)return i.map(function(e){return r.replace(/image-set\(/g,e+"image-set(")})}module.exports=exports.default;
},{"css-in-js-utils/lib/isPrefixedValue":50}],45:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;function e(e,t){if("position"===e&&"sticky"===t)return["-webkit-sticky","sticky"]}module.exports=exports.default;
},{}],47:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=i;var t=["-webkit-","-moz-",""],e={maxHeight:!0,maxWidth:!0,width:!0,height:!0,columnWidth:!0,minWidth:!0,minHeight:!0},n={"min-content":!0,"max-content":!0,"fill-available":!0,"fit-content":!0,"contain-floats":!0};function i(i,o){if(e.hasOwnProperty(i)&&n.hasOwnProperty(o))return t.map(function(t){return t+o})}module.exports=exports.default;
},{}],51:[function(require,module,exports) {
"use strict";var e=/[A-Z]/g,r=/^ms-/,s={};function t(t){return t in s?s[t]:s[t]=t.replace(e,"-$&").toLowerCase().replace(r,"-ms-")}module.exports=t;
},{}],49:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=require("hyphenate-style-name"),t=r(e);function r(e){return e&&e.__esModule?e:{default:e}}function u(e){return(0,t.default)(e)}module.exports=exports.default;
},{"hyphenate-style-name":51}],46:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=l;var t=require("css-in-js-utils/lib/hyphenateProperty"),e=s(t),r=require("css-in-js-utils/lib/isPrefixedValue"),i=s(r),n=require("../../utils/capitalizeString"),o=s(n);function s(t){return t&&t.__esModule?t:{default:t}}var u={transition:!0,transitionProperty:!0,WebkitTransition:!0,WebkitTransitionProperty:!0,MozTransition:!0,MozTransitionProperty:!0},a={Webkit:"-webkit-",Moz:"-moz-",ms:"-ms-"};function f(t,r){if((0,i.default)(t))return t;for(var n=t.split(/,(?![^()]*(?:\([^()]*\))?\))/g),o=0,s=n.length;o<s;++o){var u=n[o],f=[u];for(var l in r){var p=(0,e.default)(l);if(u.indexOf(p)>-1&&"order"!==p)for(var d=r[l],c=0,b=d.length;c<b;++c)f.unshift(u.replace(p,a[d[c]]+p))}n[o]=f.join(",")}return n.join(",")}function l(t,e,r,i){if("string"==typeof e&&u.hasOwnProperty(t)){var n=f(e,i),s=n.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter(function(t){return!/-moz-|-ms-/.test(t)}).join(",");if(t.indexOf("Webkit")>-1)return s;var a=n.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter(function(t){return!/-webkit-|-ms-/.test(t)}).join(",");return t.indexOf("Moz")>-1?a:(r["Webkit"+(0,o.default)(t)]=s,r["Moz"+(0,o.default)(t)]=a,n)}}module.exports=exports.default;
},{"css-in-js-utils/lib/hyphenateProperty":49,"css-in-js-utils/lib/isPrefixedValue":50,"../../utils/capitalizeString":36}],17:[function(require,module,exports) {
var e=require("inline-style-prefixer/static/plugins/calc"),i=require("inline-style-prefixer/static/plugins/crossFade"),t=require("inline-style-prefixer/static/plugins/cursor"),r=require("inline-style-prefixer/static/plugins/filter"),s=require("inline-style-prefixer/static/plugins/flex"),o=require("inline-style-prefixer/static/plugins/flexboxIE"),n=require("inline-style-prefixer/static/plugins/flexboxOld"),a=require("inline-style-prefixer/static/plugins/gradient"),k=require("inline-style-prefixer/static/plugins/imageSet"),m=require("inline-style-prefixer/static/plugins/position"),l=require("inline-style-prefixer/static/plugins/sizing"),b=require("inline-style-prefixer/static/plugins/transition");module.exports={plugins:[e,i,t,r,s,o,n,a,k,m,l,b],prefixMap:{transform:["Webkit","ms"],transformOrigin:["Webkit","ms"],transformOriginX:["Webkit","ms"],transformOriginY:["Webkit","ms"],backfaceVisibility:["Webkit"],perspective:["Webkit"],perspectiveOrigin:["Webkit"],transformStyle:["Webkit"],transformOriginZ:["Webkit"],animation:["Webkit"],animationDelay:["Webkit"],animationDirection:["Webkit"],animationFillMode:["Webkit"],animationDuration:["Webkit"],animationIterationCount:["Webkit"],animationName:["Webkit"],animationPlayState:["Webkit"],animationTimingFunction:["Webkit"],appearance:["Webkit","Moz"],userSelect:["Webkit","Moz","ms"],fontKerning:["Webkit"],textEmphasisPosition:["Webkit"],textEmphasis:["Webkit"],textEmphasisStyle:["Webkit"],textEmphasisColor:["Webkit"],boxDecorationBreak:["Webkit"],clipPath:["Webkit"],maskImage:["Webkit"],maskMode:["Webkit"],maskRepeat:["Webkit"],maskPosition:["Webkit"],maskClip:["Webkit"],maskOrigin:["Webkit"],maskSize:["Webkit"],maskComposite:["Webkit"],mask:["Webkit"],maskBorderSource:["Webkit"],maskBorderMode:["Webkit"],maskBorderSlice:["Webkit"],maskBorderWidth:["Webkit"],maskBorderOutset:["Webkit"],maskBorderRepeat:["Webkit"],maskBorder:["Webkit"],maskType:["Webkit"],textDecorationStyle:["Webkit","Moz"],textDecorationSkip:["Webkit","Moz"],textDecorationLine:["Webkit","Moz"],textDecorationColor:["Webkit","Moz"],filter:["Webkit"],fontFeatureSettings:["Webkit","Moz"],breakAfter:["Webkit","Moz","ms"],breakBefore:["Webkit","Moz","ms"],breakInside:["Webkit","Moz","ms"],columnCount:["Webkit","Moz"],columnFill:["Webkit","Moz"],columnGap:["Webkit","Moz"],columnRule:["Webkit","Moz"],columnRuleColor:["Webkit","Moz"],columnRuleStyle:["Webkit","Moz"],columnRuleWidth:["Webkit","Moz"],columns:["Webkit","Moz"],columnSpan:["Webkit","Moz"],columnWidth:["Webkit","Moz"],flex:["Webkit","ms"],flexBasis:["Webkit"],flexDirection:["Webkit","ms"],flexGrow:["Webkit"],flexFlow:["Webkit","ms"],flexShrink:["Webkit"],flexWrap:["Webkit","ms"],alignContent:["Webkit"],alignItems:["Webkit"],alignSelf:["Webkit"],justifyContent:["Webkit"],order:["Webkit"],transitionDelay:["Webkit"],transitionDuration:["Webkit"],transitionProperty:["Webkit"],transitionTimingFunction:["Webkit"],backdropFilter:["Webkit"],scrollSnapType:["Webkit","ms"],scrollSnapPointsX:["Webkit","ms"],scrollSnapPointsY:["Webkit","ms"],scrollSnapDestination:["Webkit","ms"],scrollSnapCoordinate:["Webkit","ms"],shapeImageThreshold:["Webkit"],shapeImageMargin:["Webkit"],shapeImageOutside:["Webkit"],hyphens:["Webkit","Moz","ms"],flowInto:["Webkit","ms"],flowFrom:["Webkit","ms"],regionFragment:["Webkit","ms"],boxSizing:["Moz"],textAlignLast:["Moz"],tabSize:["Moz"],wrapFlow:["ms"],wrapThrough:["ms"],wrapMargin:["ms"],touchAction:["ms"],gridTemplateColumns:["ms"],gridTemplateRows:["ms"],gridTemplateAreas:["ms"],gridTemplate:["ms"],gridAutoColumns:["ms"],gridAutoRows:["ms"],gridAutoFlow:["ms"],grid:["ms"],gridRowStart:["ms"],gridColumnStart:["ms"],gridRowEnd:["ms"],gridRow:["ms"],gridColumn:["ms"],gridColumnEnd:["ms"],gridColumnGap:["ms"],gridRowGap:["ms"],gridArea:["ms"],gridGap:["ms"],textSizeAdjust:["Webkit","ms"],borderImage:["Webkit"],borderImageOutset:["Webkit"],borderImageRepeat:["Webkit"],borderImageSlice:["Webkit"],borderImageSource:["Webkit"],borderImageWidth:["Webkit"]}};
},{"inline-style-prefixer/static/plugins/calc":40,"inline-style-prefixer/static/plugins/crossFade":37,"inline-style-prefixer/static/plugins/cursor":38,"inline-style-prefixer/static/plugins/filter":42,"inline-style-prefixer/static/plugins/flex":48,"inline-style-prefixer/static/plugins/flexboxIE":39,"inline-style-prefixer/static/plugins/flexboxOld":41,"inline-style-prefixer/static/plugins/gradient":44,"inline-style-prefixer/static/plugins/imageSet":43,"inline-style-prefixer/static/plugins/position":45,"inline-style-prefixer/static/plugins/sizing":47,"inline-style-prefixer/static/plugins/transition":46}],18:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n="undefined"!=typeof Map,r=function(){function r(){t(this,r),this.elements={},this.keyOrder=[]}return e(r,[{key:"forEach",value:function(e){for(var t=0;t<this.keyOrder.length;t++)e(this.elements[this.keyOrder[t]],this.keyOrder[t])}},{key:"set",value:function(e,t,s){var i=this;if(this.elements.hasOwnProperty(e)){if(s){var o=this.keyOrder.indexOf(e);this.keyOrder.splice(o,1),this.keyOrder.push(e)}}else this.keyOrder.push(e);if(null!=t){if(n&&t instanceof Map||t instanceof r){var a=function(){var n=i.elements.hasOwnProperty(e)?i.elements[e]:new r;return t.forEach(function(e,t){n.set(t,e,s)}),i.elements[e]=n,{v:void 0}}();if("object"==typeof a)return a.v}if(Array.isArray(t)||"object"!=typeof t)this.elements[e]=t;else{for(var f=this.elements.hasOwnProperty(e)?this.elements[e]:new r,l=Object.keys(t),u=0;u<l.length;u+=1)f.set(l[u],t[l[u]],s);this.elements[e]=f}}else this.elements[e]=t}},{key:"get",value:function(e){return this.elements[e]}},{key:"has",value:function(e){return this.elements.hasOwnProperty(e)}},{key:"addStyleType",value:function(e){var t=this;if(n&&e instanceof Map||e instanceof r)e.forEach(function(e,n){t.set(n,e,!0)});else for(var s=Object.keys(e),i=0;i<s.length;i++)this.set(s[i],e[s[i]],!0)}}]),r}();exports.default=r,module.exports=exports.default;
},{}],22:[function(require,module,exports) {
"use strict";function r(r){for(var t=5381,e=r.length;e;)t=33*t^r.charCodeAt(--e);return t>>>0}module.exports=r;
},{}],19:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=function(){return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return function(r,t){var e=[],n=!0,o=!1,i=void 0;try{for(var a,u=r[Symbol.iterator]();!(n=(a=u.next()).done)&&(e.push(a.value),!t||e.length!==t);n=!0);}catch(r){o=!0,i=r}finally{try{!n&&u.return&&u.return()}finally{if(o)throw i}}return e}(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function t(r){return r&&r.__esModule?r:{default:r}}var e=require("string-hash"),n=t(e),o=function(t,e){for(var n=Object.keys(t),o={},i=0;i<n.length;i+=1){var a=e([n[i],t[n[i]]]),u=r(a,2),f=u[0],s=u[1];o[f]=s}return o};exports.mapObj=o;var i=/([A-Z])/g,a=function(r){return"-"+r.toLowerCase()},u=function(r){var t=r.replace(i,a);return"m"===t[0]&&"s"===t[1]&&"-"===t[2]?"-"+t:t};exports.kebabifyStyleName=u;var f={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridColumn:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};function s(r,t){return r+t.charAt(0).toUpperCase()+t.substring(1)}var l=["Webkit","ms","Moz","O"];Object.keys(f).forEach(function(r){l.forEach(function(t){f[s(t,r)]=f[r]})});var c=function(r,t){return"number"==typeof t?f[r]?""+t:t+"px":""+t};exports.stringifyValue=c;var p=function(r,t){return d(c(r,t))};exports.stringifyAndImportantifyValue=p;var y=function(r){return(0,n.default)(r).toString(36)};exports.hashString=y;var h=function(r){return y(JSON.stringify(r))};exports.hashObject=h;var d=function(r){return"!"===r[r.length-10]&&" !important"===r.slice(-11)?r:r+" !important"};
},{"string-hash":22}],15:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e};function r(e){return e&&e.__esModule?e:{default:e}}var t=require("inline-style-prefixer/static/createPrefixer"),n=r(t),a=require("../lib/staticPrefixData"),i=r(a),l=require("./ordered-elements"),u=r(l),o=require("./util"),f=(0,n.default)(i.default),s=[function(e,r,t){return":"!==e[0]?null:t(r+e)},function(e,r,t){if("@"!==e[0])return null;return e+"{"+t(r)+"}"}];exports.defaultSelectorHandlers=s;var c=function e(r,t,n,a,i){for(var l=new u.default,o=0;o<t.length;o++)l.addStyleType(t[o]);var f=new u.default,s="";return l.forEach(function(t,l){n.some(function(u){var o=u(l,r,function(r){return e(r,[t],n,a,i)});if(null!=o)return s+=o,!0})||f.set(l,t,!0)}),v(r,f,a,i,n)+s};exports.generateCSS=c;var d=function(e,r,t){if(r)for(var n=Object.keys(r),a=0;a<n.length;a++){var i=n[a];e.has(i)&&e.set(i,r[i](e.get(i),t),!1)}},y=function(e,r,t){return(0,o.kebabifyStyleName)(e)+":"+t(e,r)+";"},v=function(r,t,n,a,i){d(t,n,i);var l=e({},t.elements),u=f(t.elements),s=Object.keys(u);if(s.length!==t.keyOrder.length)for(var c=0;c<s.length;c++)if(!l.hasOwnProperty(s[c])){var v=void 0;if((v="W"===s[c][0]?s[c][6].toLowerCase()+s[c].slice(7):"o"===s[c][1]?s[c][3].toLowerCase()+s[c].slice(4):s[c][2].toLowerCase()+s[c].slice(3))&&l.hasOwnProperty(v)){var h=t.keyOrder.indexOf(v);t.keyOrder.splice(h,0,s[c])}else t.keyOrder.unshift(s[c])}var p=!1===a?o.stringifyValue:o.stringifyAndImportantifyValue,g=[];for(c=0;c<t.keyOrder.length;c++){var O=t.keyOrder[c],k=u[O];if(Array.isArray(k))for(var b=0;b<k.length;b++)g.push(y(O,k[b],p));else g.push(y(O,k,p))}return g.length?r+"{"+g.join("")+"}":""};exports.generateCSSRuleset=v;
},{"inline-style-prefixer/static/createPrefixer":24,"../lib/staticPrefixData":17,"./ordered-elements":18,"./util":19}],23:[function(require,module,exports) {
var global = (1,eval)("this");
var e=(0,eval)("this");module.exports=t;function t(e){r.length||(n(),a=!0),r[r.length]=e}var n,r=[],a=!1,o=0,u=1024;function l(){for(;o<r.length;){var e=o;if(o+=1,r[e].call(),o>u){for(var t=0,n=r.length-o;t<n;t++)r[t]=r[t+o];r.length-=o,o=0}}r.length=0,o=0,a=!1}var i=void 0!==e?e:self,c=i.MutationObserver||i.WebKitMutationObserver;n="function"==typeof c?v(l):f(l),t.requestFlush=n;function v(e){var t=1,n=new c(e),r=document.createTextNode("");return n.observe(r,{characterData:!0}),function(){t=-t,r.data=t}}function f(e){return function(){var t=setTimeout(r,0),n=setInterval(r,50);function r(){clearTimeout(t),clearInterval(n),e()}}}t.makeRequestCallFromTimer=f;
},{}],21:[function(require,module,exports) {
"use strict";var t=require("./raw"),r=[],n=[],e=t.makeRequestCallFromTimer(l);function l(){if(n.length)throw n.shift()}module.exports=o;function o(n){var e;(e=r.length?r.pop():new i).task=n,t(e)}function i(){this.task=null}i.prototype.call=function(){try{this.task.call()}catch(t){o.onerror?o.onerror(t):(n.push(t),e())}finally{this.task=null,r[r.length]=this}};
},{"./raw":23}],20:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});function e(e){return e&&e.__esModule?e:{default:e}}var t=require("asap"),n=e(t),r=require("./ordered-elements"),a=e(r),i=require("./generate"),o=require("./util"),s=null,u=function(e){if(null==s&&null==(s=document.querySelector("style[data-aphrodite]"))){var t=document.head||document.getElementsByTagName("head")[0];(s=document.createElement("style")).type="text/css",s.setAttribute("data-aphrodite",""),t.appendChild(s)}s.styleSheet?s.styleSheet.cssText+=e:s.appendChild(document.createTextNode(e))},f={fontFamily:function e(t){return Array.isArray(t)?t.map(e).join(","):"object"==typeof t?(h(t.src,"@font-face",[t],!1),'"'+t.fontFamily+'"'):t},animationName:function e(t,n){if(Array.isArray(t))return t.map(function(t){return e(t,n)}).join(",");if("object"==typeof t){var r="keyframe_"+(0,o.hashObject)(t),s="@keyframes "+r+"{";return t instanceof a.default?t.forEach(function(e,t){s+=(0,i.generateCSS)(t,[e],n,f,!1)}):Object.keys(t).forEach(function(e){s+=(0,i.generateCSS)(e,[t[e]],n,f,!1)}),m(r,s+="}"),r}return t}},c={},l="",d=!1,m=function(e,t){if(!c[e]){if(!d){if("undefined"==typeof document)throw new Error("Cannot automatically buffer without a document");d=!0,(0,n.default)(g)}l+=t,c[e]=!0}},h=function(e,t,n,r){var a=arguments.length<=4||void 0===arguments[4]?[]:arguments[4];if(!c[e]){var o=(0,i.generateCSS)(t,n,a,f,r);m(e,o)}};exports.injectStyleOnce=h;var y=function(){l="",c={},d=!1,s=null};exports.reset=y;var p=function(){if(d)throw new Error("Cannot buffer while already buffering");d=!0};exports.startBuffering=p;var v=function(){d=!1;var e=l;return l="",e};exports.flushToString=v;var g=function(){var e=v();e.length>0&&u(e)};exports.flushToStyleTag=g;var S=function(){return Object.keys(c)};exports.getRenderedClassNames=S;var x=function(e){e.forEach(function(e){c[e]=!0})};exports.addRenderedClassNames=x;var N=function e(t,n){for(var r=0;r<t.length;r+=1)t[r]&&(Array.isArray(t[r])?e(t[r],n):(n.classNameBits.push(t[r]._name),n.definitionBits.push(t[r]._definition)))},j=function(e){return(e.reduce(function(e,t){return e+(t?t._len:0)},0)%36).toString(36)},B=function(e,t,n){var r={classNameBits:[],definitionBits:[]};if(N(t,r),0===r.classNameBits.length)return"";var a=void 0;return a=1===r.classNameBits.length?"_"+r.classNameBits[0]:"_"+(0,o.hashString)(r.classNameBits.join())+j(t),h(a,"."+a,r.definitionBits,e,n),a};exports.injectAndGetClassName=B;
},{"asap":21,"./ordered-elements":18,"./generate":15,"./util":19}],16:[function(require,module,exports) {
"use strict";var e=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var u,o=e[Symbol.iterator]();!(n=(u=o.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw a}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},r=require("./util"),n=require("./inject"),i={create:function(t){return(0,r.mapObj)(t,function(t){var n=e(t,2),i=n[0],a=n[1],u=JSON.stringify(a);return[i,{_len:u.length,_name:(0,r.hashString)(u),_definition:a}]})},rehydrate:function(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];(0,n.addRenderedClassNames)(e)}},a={renderStatic:function(e){(0,n.reset)(),(0,n.startBuffering)();return{html:e(),css:{content:(0,n.flushToString)(),renderedClassNames:(0,n.getRenderedClassNames)()}}}},u={suppressStyleInjection:function(){(0,n.reset)(),(0,n.startBuffering)()},clearBufferAndResumeStyleInjection:function(){(0,n.reset)()}},o=function e(r,o){return{StyleSheet:t({},i,{extend:function(t){var n=t.map(function(e){return e.selectorHandler}).filter(function(e){return e});return e(r,o.concat(n))}}),StyleSheetServer:a,StyleSheetTestUtils:u,css:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return(0,n.injectAndGetClassName)(r,t,o)}}};module.exports=o;
},{"./util":19,"./inject":20}],13:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});function e(e){return e&&e.__esModule?e:{default:e}}var r=require("./generate"),t=require("./exports"),u=e(t),l=!0;exports.default=(0,u.default)(l,r.defaultSelectorHandlers),module.exports=exports.default;
},{"./generate":15,"./exports":16}],4:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("preact");class t extends e.Component{serialize(){const e=Object.create(null),s=this.subcomponents();for(const n in s){const o=s[n];o&&o instanceof t&&(e[n]=o.serialize())}return{state:this.state,serializedSubcomponents:e}}rehydrate(e){this.setState(e.state,()=>{const s=this.subcomponents();for(const n in s){const o=s[n],r=e.serializedSubcomponents[n];r&&o&&o instanceof t&&o.rehydrate(r)}})}subcomponents(){return Object.create(null)}}exports.ReloadableComponent=t;
},{"preact":3}],52:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});function t(t){return t[t.length-1]||null}exports.lastOf=t;function e(t,e){t.sort(function(t,r){return e(t)<e(r)?-1:1})}exports.sortBy=e;function r(t,e,r){return t.has(e)||t.set(e,r(e)),t.get(e)}exports.getOrInsert=r;function n(t,e,r){return t.has(e)?t.get(e):r(e)}exports.getOrElse=n;function*o(t,e){for(let r of t)yield e(r)}exports.itMap=o;function s(t,e){for(let r of t)e(r)}exports.itForEach=s;function u(t,e,r){let n=r;for(let r of t)n=e(n,r);return n}exports.itReduce=u;const f=new Map;function i(t,e){return f.has(e)||f.set(e,t.measureText(e).width),f.get(e)}exports.cachedMeasureTextWidth=i;
},{}],14:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("./utils");class t{constructor(){this.selfWeight=0,this.totalWeight=0}getSelfWeight(){return this.selfWeight}getTotalWeight(){return this.totalWeight}addToTotalWeight(e){this.totalWeight+=e}addToSelfWeight(e){this.selfWeight+=e}}exports.HasWeights=t;class s extends t{constructor(e){super(),this.key=e.key,this.name=e.name,this.file=e.file,this.line=e.line,this.col=e.col}}exports.Frame=s;class a extends t{constructor(e,t){super(),this.frame=e,this.parent=t,this.children=[]}}exports.CallTreeNode=a;const r=new s({key:"(speedscope root)",name:"(speedscope root)"});class i{format(e){return e.toLocaleString()}}exports.RawValueFormatter=i;class l{constructor(e){this.multiplier="nanoseconds"===e?1e-9:"microseconds"===e?1e-6:"milliseconds"===e?.001:1}format(e){const t=e*this.multiplier;return t/1>=1?`${t.toFixed(2)}s`:t/.001>=1?`${(t/.001).toFixed(2)}ms`:t/1e-6>=1?`${(t/1e-6).toFixed(2)}µs`:`${(t/1e-9).toFixed(2)}ms`}}exports.TimeFormatter=l;class o{constructor(e){this.frames=new Map,this.appendOrderCalltreeRoot=new a(r,null),this.groupedCalltreeRoot=new a(r,null),this.samples=[],this.weights=[],this.valueFormatter=new i,this.appendOrderStack=[this.appendOrderCalltreeRoot],this.groupedOrderStack=[this.groupedCalltreeRoot],this.framesInStack=new Map,this.stack=[],this.lastValue=null,this.totalWeight=e}formatValue(e){return this.valueFormatter.format(e)}setValueFormatter(e){this.valueFormatter=e}getName(){return this.name}setName(e){this.name=e}getTotalWeight(){return this.totalWeight}getTotalNonIdleWeight(){return this.groupedCalltreeRoot.children.reduce((e,t)=>e+t.getTotalWeight(),0)}forEachCallGrouped(e,t){function s(a,i){a.frame!==r&&e(a,i);let l=0;const o=[...a.children];o.sort((e,t)=>e.getTotalWeight()>t.getTotalWeight()?-1:1),o.forEach(function(e){s(e,i+l),l+=e.getTotalWeight()}),a.frame!==r&&t(i+a.getTotalWeight())}s(this.groupedCalltreeRoot,0)}forEachCall(t,s){let a=[],i=0,l=0;for(let o of this.samples){let h=null;for(h=o;h&&h.frame!=r&&-1===a.indexOf(h);h=h.parent);for(;a.length>0&&e.lastOf(a)!=h;)a.pop(),s(i);const n=[];for(let e=o;e&&e.frame!=r&&e!=h;e=e.parent)n.push(e);n.reverse();for(let e of n)t(e,i);a=a.concat(n),i+=this.weights[l++]}for(let e=a.length-1;e>=0;e--)s(i)}forEachFrame(e){this.frames.forEach(e)}_appendSample(t,r,i){if(isNaN(r))throw new Error("invalid weight");let l=i?this.appendOrderCalltreeRoot:this.groupedCalltreeRoot,o=new Set;for(let h of t){const t=e.getOrInsert(this.frames,h.key,()=>new s(h)),n=i?e.lastOf(l.children):l.children.find(e=>e.frame===t);if(n&&n.frame==t)l=n;else{const e=l;l=new a(t,l),e.children.push(l)}l.addToTotalWeight(r),o.add(l.frame)}if(l.addToSelfWeight(r),i){l.frame.addToSelfWeight(r);for(let e of o)e.addToTotalWeight(r);this.samples.push(l),this.weights.push(r)}}appendSample(e,t){this._appendSample(e,t,!0),this._appendSample(e,t,!1)}addWeightsToFrames(t){null==this.lastValue&&(this.lastValue=t);const s=t-this.lastValue;for(let e of this.framesInStack.keys())e.addToTotalWeight(s);const a=e.lastOf(this.stack);a&&a.addToSelfWeight(s)}addWeightsToNodes(t,s){const a=t-this.lastValue;for(let e of s)e.addToTotalWeight(a);const r=e.lastOf(s);r&&r.addToSelfWeight(a)}_enterFrame(t,s,r){let i=r?this.appendOrderStack:this.groupedOrderStack;this.addWeightsToNodes(s,i);let l=e.lastOf(i);if(l){if(r){s-this.lastValue>0&&(this.samples.push(l),this.weights.push(s-this.lastValue))}const o=r?e.lastOf(l.children):l.children.find(e=>e.frame===t);let h;o&&o.frame==t?h=o:(h=new a(t,l),l.children.push(h)),i.push(h)}}enterFrame(t,a){const r=e.getOrInsert(this.frames,t.key,()=>new s(t));this.addWeightsToFrames(a),this._enterFrame(r,a,!0),this._enterFrame(r,a,!1),this.stack.push(r);const i=this.framesInStack.get(r)||0;this.framesInStack.set(r,i+1),this.lastValue=a}_leaveFrame(e,t,s){let a=s?this.appendOrderStack:this.groupedOrderStack;if(this.addWeightsToNodes(t,a),s){const e=this.appendOrderStack.pop();t-this.lastValue>0&&(this.samples.push(e),this.weights.push(t-this.lastValue))}else this.groupedOrderStack.pop()}leaveFrame(t,a){const r=e.getOrInsert(this.frames,t.key,()=>new s(t));this.addWeightsToFrames(a),this._leaveFrame(r,a,!0),this._leaveFrame(r,a,!1),this.stack.pop();const i=this.framesInStack.get(r);null!=i&&(1===i?this.framesInStack.delete(r):this.framesInStack.set(r,i-1),this.lastValue=a)}}exports.Profile=o;
},{"./utils":52}],11:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../profile");function r(e){const r=[];return e.replace(/^(.*) (\d+)$/gm,(e,t,o)=>(r.push({stack:t.split(";").map(e=>({key:e,name:e})),duration:parseInt(o,10)}),e)),r}function t(t){const o=r(t),n=o.reduce((e,r)=>e+r.duration,0),a=new e.Profile(n);for(let e of o)a.appendSample(e.stack,e.duration);return a}exports.importFromBGFlameGraph=t;
},{"../profile":14}],10:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../profile");function t(t){const r=t.raw_timestamp_deltas.reduce((e,t)=>e+t,0),o=new e.Profile(r),{frames:s,raw:a,raw_timestamp_deltas:n}=t;let l=0;for(let e=0;e<a.length;){const t=a[e++],r=[];for(let o=0;o<t;o++){const t=a[e++];r.push(Object.assign({key:t},s[t]))}const c=a[e++];let i=0;for(let e=0;e<c;e++)i+=n[l++];o.appendSample(r,i)}return o.setValueFormatter(new e.TimeFormatter("microseconds")),o}exports.importFromStackprof=t;
},{"../profile":14}],12:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../profile"),r=require("../utils");function t(e){for(let r of e)if("CpuProfile"==r.name){return n(r.args.data.cpuProfile)}throw new Error("Could not find CPU profile in Timeline")}exports.importFromChromeTimeline=t;const o=new Map;function l(e){return r.getOrInsert(o,e,e=>{const r=e.functionName||"(anonymous)",t=e.url,o=e.lineNumber,l=e.columnNumber;return{key:`${r}:${t}:${o}:${l}`,name:r,file:t,line:o,col:l}})}function n(t){const o=new e.Profile(t.endTime-t.startTime),n=new Map;for(let e of t.nodes)n.set(e.id,e);for(let e of t.nodes)if(e.children)for(let r of e.children){const t=n.get(r);t&&(t.parent=e)}const a=[],i=[];let s=0,f=NaN;for(let e=0;e<t.samples.length;e++){const r=t.samples[e];r!=f&&(a.push(r),i.push(s),s=0),s+=t.timeDeltas[e],f=r}isNaN(f)||(a.push(f),i.push(s));let c=[],m=0;for(let e=0;e<a.length;e++){const t=i[e+1]||0,s=a[e];let f=n.get(s);if(!f)continue;let u=null;for(u=f;u&&-1===c.indexOf(u);u="(garbage collector)"===u.callFrame.functionName?r.lastOf(c):u.parent||null);for(;c.length>0&&r.lastOf(c)!=u;){const e=l(c.pop().callFrame);o.leaveFrame(e,m)}const p=[];for(let e=f;e&&e!=u;e="(garbage collector)"===e.callFrame.functionName?r.lastOf(c):e.parent||null)p.push(e);p.reverse();for(let e of p)o.enterFrame(l(e.callFrame),m);c=c.concat(p),m+=t}for(let e=c.length-1;e>=0;e--)o.leaveFrame(l(c[e].callFrame),m);return o.setValueFormatter(new e.TimeFormatter("microseconds")),o}exports.importFromChromeCPUProfile=n;
},{"../profile":14,"../utils":52}],29:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});function t(t,i,s){return t<i?i:t>s?s:t}exports.clamp=t;class i{constructor(t,i){this.x=t,this.y=i}withX(t){return new i(t,this.y)}withY(t){return new i(this.x,t)}plus(t){return new i(this.x+t.x,this.y+t.y)}minus(t){return new i(this.x-t.x,this.y-t.y)}times(t){return new i(this.x*t,this.y*t)}timesPointwise(t){return new i(this.x*t.x,this.y*t.y)}dividedByPointwise(t){return new i(this.x/t.x,this.y/t.y)}dot(t){return this.x*t.x+this.y*t.y}equals(t){return this.x===t.x&&this.y===t.y}length2(){return this.dot(this)}length(){return Math.sqrt(this.length2())}abs(){return new i(Math.abs(this.x),Math.abs(this.y))}static min(t,s){return new i(Math.min(t.x,s.x),Math.min(t.y,s.y))}static max(t,s){return new i(Math.max(t.x,s.x),Math.max(t.y,s.y))}flatten(){return[this.x,this.y]}}i.zero=new i(0,0),i.unit=new i(1,1),exports.Vec2=i;class s{constructor(t=1,i=0,s=0,e=0,r=1,n=0){this.m00=t,this.m01=i,this.m02=s,this.m10=e,this.m11=r,this.m12=n}withScale(t){let{m00:i,m01:e,m02:r,m10:n,m11:h,m12:m}=this;return i=t.x,h=t.y,new s(i,e,r,n,h,m)}static withScale(t){return(new s).withScale(t)}scaledBy(t){return s.withScale(t).times(this)}getScale(){return new i(this.m00,this.m11)}withTranslation(t){let{m00:i,m01:e,m02:r,m10:n,m11:h,m12:m}=this;return r=t.x,m=t.y,new s(i,e,r,n,h,m)}static withTranslation(t){return(new s).withTranslation(t)}getTranslation(){return new i(this.m02,this.m12)}translatedBy(t){return s.withTranslation(t).times(this)}static betweenRects(t,e){return s.withTranslation(t.origin.times(-1)).scaledBy(new i(e.size.x/t.size.x,e.size.y/t.size.y)).translatedBy(e.origin)}times(t){const i=this.m00*t.m00+this.m01*t.m10,e=this.m00*t.m01+this.m01*t.m11,r=this.m00*t.m02+this.m01*t.m12+this.m02,n=this.m10*t.m00+this.m11*t.m10,h=this.m10*t.m01+this.m11*t.m11,m=this.m10*t.m02+this.m11*t.m12+this.m12;return new s(i,e,r,n,h,m)}equals(t){return this.m00==t.m00&&this.m01==t.m01&&this.m02==t.m02&&this.m10==t.m10&&this.m11==t.m11&&this.m12==t.m12}timesScalar(t){const{m00:i,m01:e,m02:r,m10:n,m11:h,m12:m}=this;return new s(t*i,t*e,t*r,t*n,t*h,t*m)}det(){const{m00:t,m01:i,m02:s,m10:e,m11:r,m12:n}=this;return t*(1*r-0*n)-i*(1*e-0*n)+s*(0*e-0*r)}adj(){const{m00:t,m01:i,m02:e,m10:r,m11:n,m12:h}=this,m=+(1*n-0*h),o=-(1*i-0*e),a=+(i*h-e*n),u=-(1*r-0*h),w=+(1*t-0*e),c=-(t*h-e*r);return new s(m,o,a,u,w,c)}inverted(){const t=this.det();if(0===t)return null;const i=this.adj();return i.timesScalar(1/t)}transformVector(t){return new i(t.x*this.m00+t.y*this.m01,t.x*this.m10+t.y*this.m11)}inverseTransformVector(t){const i=this.inverted();return i?i.transformVector(t):null}transformPosition(t){return new i(t.x*this.m00+t.y*this.m01+this.m02,t.x*this.m10+t.y*this.m11+this.m12)}inverseTransformPosition(t){const i=this.inverted();return i?i.transformPosition(t):null}transformRect(t){const i=this.transformVector(t.size),s=this.transformPosition(t.origin);return i.x<0&&i.y<0?new e(s.plus(i),i.abs()):i.x<0?new e(s.withX(s.x+i.x),i.abs()):i.y<0?new e(s.withY(s.y+i.y),i.abs()):new e(s,i)}inverseTransformRect(t){const i=this.inverted();return i?i.transformRect(t):null}flatten(){return[this.m00,this.m10,0,this.m01,this.m11,0,this.m02,this.m12,1]}}exports.AffineTransform=s;class e{constructor(t,i){this.origin=t,this.size=i}isEmpty(){return 0==this.width()||0==this.height()}width(){return this.size.x}height(){return this.size.y}left(){return this.origin.x}right(){return this.left()+this.width()}top(){return this.origin.y}bottom(){return this.top()+this.height()}topLeft(){return this.origin}topRight(){return this.origin.plus(new i(this.width(),0))}bottomRight(){return this.origin.plus(this.size)}bottomLeft(){return this.origin.plus(new i(0,this.height()))}withOrigin(t){return new e(t,this.size)}withSize(t){return new e(this.origin,t)}closestPointTo(s){return new i(t(s.x,this.left(),this.right()),t(s.y,this.top(),this.bottom()))}distanceFrom(t){return t.minus(this.closestPointTo(t)).length()}contains(t){return 0===this.distanceFrom(t)}hasIntersectionWith(t){const i=Math.max(this.top(),t.top()),s=Math.max(i,Math.min(this.bottom(),t.bottom()));if(s-i==0)return!1;const e=Math.max(this.left(),t.left()),r=Math.max(e,Math.min(this.right(),t.right()));return r-e!=0}intersectWith(t){const s=i.max(this.topLeft(),t.topLeft()),r=i.max(s,i.min(this.bottomRight(),t.bottomRight()));return new e(s,r.minus(s))}equals(t){return this.origin.equals(t.origin)&&this.size.equals(t.size)}}e.empty=new e(i.zero,i.zero),e.unit=new e(i.zero,i.unit),e.NDC=new e(new i(-1,-1),new i(2,2)),exports.Rect=e;
},{}],53:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class t{constructor(t){this.data=t,this.prev=null,this.next=null}}class e{constructor(){this.head=null,this.tail=null,this.size=0}getHead(){return this.head}getTail(){return this.tail}getSize(){return this.size}append(t){this.tail?(this.tail.next=t,t.prev=this.tail,this.tail=t):this.head=this.tail=t,this.size++}prepend(t){return this.head?(this.head.prev=t,t.next=this.head,this.head=t):this.head=this.tail=t,this.size++,t}pop(){if(this.tail){const t=this.tail;return t.prev?(this.tail=t.prev,this.tail.next=null):this.head=this.tail=null,this.size--,t.prev=null,t}return null}dequeue(){if(this.head){const t=this.head;return t.next?(this.head=t.next,this.head.prev=null):this.head=this.tail=null,this.size--,t.next=null,t}return null}remove(t){null==t.prev?this.dequeue():null==t.next?this.pop():(t.next.prev=t.prev,t.prev.next=t.next,t.next=null,t.prev=null,this.size--)}}exports.List=e;class i{constructor(t){this.capacity=t,this.list=new e,this.map=new Map}has(t){return this.map.has(t)}get(t){const e=this.map.get(t);return e?(this.list.remove(e.listNode),this.list.prepend(e.listNode),e?e.value:null):null}getSize(){return this.list.getSize()}getCapacity(){return this.capacity}insert(e,i){const s=this.map.get(e);for(s&&this.list.remove(s.listNode);this.list.getSize()>=this.capacity;)this.map.delete(this.list.pop().data);const h=this.list.prepend(new t(e));this.map.set(e,{value:i,listNode:h})}getOrInsert(t,e){let i=this.get(t);return null==i&&(i=e(t),this.insert(t,i)),i}removeLRU(){const t=this.list.pop();if(!t)return null;const e=t.data,i=this.map.get(e).value;return this.map.delete(e),[e,i]}}exports.LRUCache=i;
},{}],54:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class t{constructor(t=0,o=0,r=0,e=1){this.r=t,this.g=o,this.b=r,this.a=e}static fromLumaChromaHue(o,r,e){const s=e/60,n=r*(1-Math.abs(s%2-1)),[a,l,u]=s<1?[r,n,0]:s<2?[n,r,0]:s<3?[0,r,n]:s<4?[0,n,r]:s<5?[n,0,r]:[r,0,n],c=o-(.3*a+.59*l+.11*u);return new t(a+c,l+c,u+c,1)}}exports.Color=t;function o(t){return t-Math.floor(t)}class r{constructor(r){this.frameToColor=new Map;function e(t){return(t.file||"")+t.name}function s(t,o){return e(t)>e(o)?1:-1}(r=[...r]).sort(s);const n=[];let a=0;for(let t=0;t<r.length;t++){const o=a+Math.abs(s(r[t],r[(t+1)%r.length]));n.push(o),a=o}const l=n[n.length-1]||1;for(let e=0;e<n.length;e++){const s=n[e]/l,a=2*o(100*s)-1,u=.85-.1*a,c=.2+.1*a,h=360*s;this.frameToColor.set(r[e],t.fromLumaChromaHue(u,c,h))}}getColorForFrame(o){return this.frameToColor.get(o)||new t}}exports.FrameColorGenerator=r;
},{}],6:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t=require("./math"),e=require("./lru-cache"),r=require("./color"),s=require("./utils"),c=1e4;class n{constructor(s){this.canvasContext=s,this.texture=s.gl.texture({width:Math.min(s.getMaxTextureSize(),4096),height:Math.min(s.getMaxTextureSize(),1024),wrapS:"clamp",wrapT:"clamp"}),this.framebuffer=s.gl.framebuffer({color:[this.texture]}),this.rowCache=new e.LRUCache(this.texture.height),this.renderToFramebuffer=s.gl({framebuffer:this.framebuffer}),this.clearLineBatch=s.createRectangleBatch(),this.clearLineBatch.addRect(t.Rect.unit,new r.Color(0,0,0,0))}has(t){return this.rowCache.has(t)}getResolution(){return this.texture.width}getCapacity(){return this.texture.height}allocateLine(t){if(this.rowCache.getSize()<this.rowCache.getCapacity()){const e=this.rowCache.getSize();return this.rowCache.insert(t,e),e}{const[,e]=this.rowCache.removeLRU();return this.rowCache.insert(t,e),e}}writeToAtlasIfNeeded(e,r){this.renderToFramebuffer(s=>{for(let s of e){let e=this.rowCache.get(s);if(null!=e)continue;e=this.allocateLine(s);const c=new t.Rect(new t.Vec2(0,e),new t.Vec2(this.texture.width,1));this.canvasContext.drawRectangleBatch({batch:this.clearLineBatch,configSpaceSrcRect:t.Rect.unit,physicalSpaceDstRect:c}),r(c,s)}})}renderViaAtlas(e,r){let s=this.rowCache.get(e);if(null==s)return!1;const c=new t.Rect(new t.Vec2(0,s),new t.Vec2(this.texture.width,1));return this.canvasContext.drawTexture({texture:this.texture,srcRect:c,dstRect:r}),!0}}class a{constructor(t,e,r){this.batch=t,this.bounds=e,this.numPrecedingRectanglesInRow=r,this.children=[],t.uploadToGPU()}getBatch(){return this.batch}getBounds(){return this.bounds}getRectCount(){return this.batch.getRectCount()}getChildren(){return this.children}getParity(){return this.numPrecedingRectanglesInRow%2}forEachLeafNodeWithinBounds(t,e){this.bounds.hasIntersectionWith(t)&&e(this)}}class i{constructor(e){if(this.children=e,this.rectCount=0,0===e.length)throw new Error("Empty interior node");let r=1/0,s=-1/0,c=1/0,n=-1/0;for(let t of e){this.rectCount+=t.getRectCount();const e=t.getBounds();r=Math.min(r,e.left()),s=Math.max(s,e.right()),c=Math.min(c,e.top()),n=Math.max(n,e.bottom())}this.bounds=new t.Rect(new t.Vec2(r,c),new t.Vec2(s-r,n-c))}getBounds(){return this.bounds}getRectCount(){return this.rectCount}getChildren(){return this.children}forEachLeafNodeWithinBounds(t,e){if(this.bounds.hasIntersectionWith(t))for(let r of this.children)r.forEachLeafNodeWithinBounds(t,e)}}class h{constructor(e,s){this.canvasContext=e,this.flamechart=s,this.layers=[],this.atlasKeys=new Map;const h=s.getLayers().length;this.rowAtlas=new n(e);for(let n=0;n<h;n++){const h=[],o=n;let l=1/0,u=-1/0,f=e.createRectangleBatch(),g=0;const d=s.getLayers()[n];for(let s=0;s<d.length;s++){const i=d[s];f.getRectCount()>=c&&(h.push(new a(f,new t.Rect(new t.Vec2(l,n),new t.Vec2(u-l,1)),g)),l=1/0,u=-1/0,f=e.createRectangleBatch());const w=new t.Rect(new t.Vec2(i.start,o),new t.Vec2(i.end-i.start,1));l=Math.min(l,w.left()),u=Math.max(u,w.right());const p=new r.Color((1+s%255)/256,(1+n%255)/256,(1+this.flamechart.getColorBucketForFrame(i.node.frame))/256);f.addRect(w,p),g++}f.getRectCount()>0&&h.push(new a(f,new t.Rect(new t.Vec2(l,n),new t.Vec2(u-l,1)),g)),this.layers.push(new i(h)),this.rectInfoTexture=this.canvasContext.gl.texture({width:1,height:1}),this.framebuffer=this.canvasContext.gl.framebuffer({color:[this.rectInfoTexture]})}}getOrInsertKey(t){const e=`${t.stackDepth}_${t.index}_${t.zoomLevel}`;return s.getOrInsert(this.atlasKeys,e,()=>t)}configSpaceBoundsForKey(e){const{stackDepth:r,zoomLevel:s,index:c}=e,n=this.flamechart.getTotalWeight(),a=n/Math.pow(2,s);return new t.Rect(new t.Vec2(a*c,r),new t.Vec2(a,1))}render(e){const{configSpaceSrcRect:r,physicalSpaceDstRect:s}=e,c=[],n=t.AffineTransform.betweenRects(r,s);let a=0;for(;;){const t=this.configSpaceBoundsForKey({stackDepth:0,zoomLevel:a,index:0});if(n.transformRect(t).width()<this.rowAtlas.getResolution())break;a++}const i=Math.max(0,Math.floor(r.top())),h=Math.min(this.layers.length,Math.ceil(r.bottom())),o=this.flamechart.getTotalWeight(),l=Math.pow(2,a),u=Math.floor(l*r.left()/o),f=Math.ceil(l*r.right()/o);for(let t=i;t<h;t++)for(let e=u;e<=f;e++){const s=this.getOrInsertKey({stackDepth:t,zoomLevel:a,index:e});this.configSpaceBoundsForKey(s).hasIntersectionWith(r)&&c.push(s)}const g=this.rowAtlas.getCapacity(),d=c.slice(0,g),w=c.slice(g);this.rowAtlas.writeToAtlasIfNeeded(d,(t,e)=>{const r=this.configSpaceBoundsForKey(e);this.layers[e.stackDepth].forEachLeafNodeWithinBounds(r,s=>{this.canvasContext.drawRectangleBatch({batch:s.getBatch(),configSpaceSrcRect:r,physicalSpaceDstRect:t,parityMin:e.stackDepth%2==0?2:0,parityOffset:s.getParity()})})}),this.framebuffer.resize(s.width(),s.height()),this.framebuffer.use(e=>{this.canvasContext.gl.clear({color:[0,0,0,0]});const s=new t.Rect(t.Vec2.zero,new t.Vec2(e.viewportWidth,e.viewportHeight)),c=t.AffineTransform.betweenRects(r,s);for(let t of d){const e=this.configSpaceBoundsForKey(t);this.rowAtlas.renderViaAtlas(t,c.transformRect(e))}for(let t of w){const e=this.configSpaceBoundsForKey(t),s=c.transformRect(e);this.layers[t.stackDepth].forEachLeafNodeWithinBounds(e,e=>{this.canvasContext.drawRectangleBatch({batch:e.getBatch(),configSpaceSrcRect:r,physicalSpaceDstRect:s,parityMin:t.stackDepth%2==0?2:0,parityOffset:e.getParity()})})}}),this.canvasContext.drawFlamechartColorPass({rectInfoTexture:this.rectInfoTexture,srcRect:new t.Rect(t.Vec2.zero,new t.Vec2(this.rectInfoTexture.width,this.rectInfoTexture.height)),dstRect:s,renderOutlines:e.renderOutlines})}}exports.FlamechartRenderer=h;
},{"./math":29,"./lru-cache":53,"./color":54,"./utils":52}],35:[function(require,module,exports) {
var global = (1,eval)("this");
var e=(0,eval)("this");!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.createREGL=t()}(this,function(){"use strict";var e={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},t=function(t){return Object.prototype.toString.call(t)in e},r=function(e,t){for(var r=Object.keys(t),n=0;n<r.length;++n)e[r[n]]=t[r[n]];return e};function n(e){var t=new Error("(regl) "+e);throw t}function a(e,t){e||n(t)}function i(e){return e?": "+e:""}function o(e,t,r){t.indexOf(e)<0&&n("invalid value"+i(r)+". must be one of: "+t)}var f=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function u(e,t){for(e+="";e.length<t;)e=" "+e;return e}function s(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function c(e,t){this.number=e,this.line=t,this.errors=[]}function l(e,t,r){this.file=e,this.line=t,this.message=r}function d(){var e=new Error,t=(e.stack||e).toString(),r=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(r)return r[1];var n=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return n?n[1]:"unknown"}function m(){var e=new Error,t=(e.stack||e).toString(),r=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(r)return r[1];var n=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return n?n[1]:"unknown"}function p(e,t){var r=e.split("\n"),n=1,a=0,i={unknown:new s,0:new s};i.unknown.name=i[0].name=t||d(),i.unknown.lines.push(new c(0,""));for(var o=0;o<r.length;++o){var f=r[o],u=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(f);if(u)switch(u[1]){case"line":var l=/(\d+)(\s+\d+)?/.exec(u[2]);l&&(n=0|l[1],l[2]&&((a=0|l[2])in i||(i[a]=new s)));break;case"define":var m=/SHADER_NAME(_B64)?\s+(.*)$/.exec(u[2]);m&&(i[a].name=m[1]?(p=m[2],"undefined"!=typeof btoa?btoa(p):"base64:"+p):m[2])}i[a].lines.push(new c(n++,f))}var p;return Object.keys(i).forEach(function(e){var t=i[e];t.lines.forEach(function(e){t.index[e.number]=e})}),i}function h(e){e._commandRef=d()}function b(e,t){var r=m();n(e+" in command "+(t||d())+("unknown"===r?"":" called from "+r))}function g(e,t,r,n){typeof e!==t&&b("invalid parameter type"+i(r)+". expected "+t+", got "+typeof e,n||d())}var v=33071,y=9728,x=9984,w=9985,k=9986,A=9987,S=5126,_=32819,E=32820,T=33635,D=34042,j={};j[5120]=j[5121]=1,j[5122]=j[5123]=j[36193]=j[T]=j[_]=j[E]=2,j[5124]=j[5125]=j[S]=j[D]=4;function O(e,t){return e===E||e===_||e===T?2:e===D?4:j[e]*t}function C(e){return!(e&e-1||!e)}var F=r(a,{optional:function(e){e()},raise:n,commandRaise:b,command:function(e,t,r){e||b(t,r||d())},parameter:function(e,t,r){e in t||n("unknown parameter ("+e+")"+i(r)+". possible values: "+Object.keys(t).join())},commandParameter:function(e,t,r,n){e in t||b("unknown parameter ("+e+")"+i(r)+". possible values: "+Object.keys(t).join(),n||d())},constructor:function(e){Object.keys(e).forEach(function(e){f.indexOf(e)<0&&n('invalid regl constructor argument "'+e+'". must be one of '+f)})},type:function(e,t,r){typeof e!==t&&n("invalid parameter type"+i(r)+". expected "+t+", got "+typeof e)},commandType:g,isTypedArray:function(e,r){t(e)||n("invalid parameter type"+i(r)+". must be a typed array")},nni:function(e,t){e>=0&&(0|e)===e||n("invalid parameter type, ("+e+")"+i(t)+". must be a nonnegative integer")},oneOf:o,shaderError:function(e,t,r,n,i){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var o=e.getShaderInfoLog(t),f=n===e.FRAGMENT_SHADER?"fragment":"vertex";g(r,"string",f+" shader source must be a string",i);var s=p(r,i),c=function(e){var t=[];return e.split("\n").forEach(function(e){if(!(e.length<5)){var r=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(e);r?t.push(new l(0|r[1],0|r[2],r[3].trim())):e.length>0&&t.push(new l("unknown",0,e))}}),t}(o);d=s,c.forEach(function(e){var t=d[e.file];if(t){var r=t.index[e.line];if(r)return r.errors.push(e),void(t.hasErrors=!0)}d.unknown.hasErrors=!0,d.unknown.lines[0].errors.push(e)}),Object.keys(s).forEach(function(e){var t=s[e];if(t.hasErrors){var r=[""],n=[""];a("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach(function(e){if(e.errors.length>0){a(u(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),a(e.line+"\n","color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach(function(r){var n=r.message,i=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(n);if(i){var o=i[1];switch(n=i[2],o){case"assign":o="="}t=Math.max(e.line.indexOf(o,t),0)}else t=0;a(u("| ",6)),a(u("^^^",t+3)+"\n","font-weight:bold"),a(u("| ",6)),a(n+"\n","font-weight:bold")}),a(u("| ",6)+"\n")}else a(u(e.number,4)+"|  "),a(e.line+"\n","color:red")}),"undefined"!=typeof document&&(n[0]=r.join("%c"))}function a(e,t){r.push(e),n.push(t||"")}}),a.raise("Error compiling "+f+" shader, "+s[0].name)}var d},linkError:function(e,t,r,n,i){if(!e.getProgramParameter(t,e.LINK_STATUS)){e.getProgramInfoLog(t);var o=p(r,i),f='Error linking program with vertex shader, "'+p(n,i)[0].name+'", and fragment shader "'+o[0].name+'"';a.raise(f)}},callSite:m,saveCommandRef:h,saveDrawInfo:function(e,t,r,n){h(e);function a(e){return e?n.id(e):0}e._fragId=a(e.static.frag),e._vertId=a(e.static.vert);function i(e,t){Object.keys(t).forEach(function(t){e[n.id(t)]=!0})}var o=e._uniformSet={};i(o,t.static),i(o,t.dynamic);var f=e._attributeSet={};i(f,r.static),i(f,r.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic},framebufferFormat:function(e,t,r){e.texture?o(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):o(e.renderbuffer._renderbuffer.format,r,"unsupported renderbuffer format for attachment")},guessCommand:d,texture2D:function(e,t,r){var n,i=t.width,o=t.height,f=t.channels;a(i>0&&i<=r.maxTextureSize&&o>0&&o<=r.maxTextureSize,"invalid texture shape"),e.wrapS===v&&e.wrapT===v||a(C(i)&&C(o),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==i&&1!==o&&a(e.minFilter!==x&&e.minFilter!==k&&e.minFilter!==w&&e.minFilter!==A,"min filter requires mipmap"):(a(C(i)&&C(o),"texture must be a square power of 2 to support mipmapping"),a(t.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),t.type===S&&(r.extensions.indexOf("oes_texture_float_linear")<0&&a(e.minFilter===y&&e.magFilter===y,"filter not supported, must enable oes_texture_float_linear"),a(!e.genMipmaps,"mipmap generation not supported with float textures"));var u=t.images;for(n=0;n<16;++n)if(u[n]){var s=i>>n,c=o>>n;a(t.mipmask&1<<n,"missing mipmap data");var l=u[n];if(a(l.width===s&&l.height===c,"invalid shape for mip images"),a(l.format===t.format&&l.internalformat===t.internalformat&&l.type===t.type,"incompatible type for mip image"),l.compressed);else if(l.data){var d=Math.ceil(O(l.type,f)*s/l.unpackAlignment)*l.unpackAlignment;a(l.data.byteLength===d*c,"invalid data for image, buffer size is inconsistent with image format")}else l.element||l.copy}else e.genMipmaps||a(0==(t.mipmask&1<<n),"extra mipmap data");t.compressed&&a(!e.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(e,t,r,n){var i=e.width,o=e.height,f=e.channels;a(i>0&&i<=n.maxTextureSize&&o>0&&o<=n.maxTextureSize,"invalid texture shape"),a(i===o,"cube map must be square"),a(t.wrapS===v&&t.wrapT===v,"wrap mode not supported by cube map");for(var u=0;u<r.length;++u){var s=r[u];a(s.width===i&&s.height===o,"inconsistent cube map face shape"),t.genMipmaps&&(a(!s.compressed,"can not generate mipmap for compressed textures"),a(1===s.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=s.images,l=0;l<16;++l){var d=c[l];if(d){var m=i>>l,p=o>>l;a(s.mipmask&1<<l,"missing mipmap data"),a(d.width===m&&d.height===p,"invalid shape for mip images"),a(d.format===e.format&&d.internalformat===e.internalformat&&d.type===e.type,"incompatible type for mip image"),d.compressed||(d.data?a(d.data.byteLength===m*p*Math.max(O(d.type,f),d.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):d.element||d.copy)}}}}}),z=0,B=0;function P(e,t){this.id=z++,this.type=e,this.data=t}function R(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function L(e){if(0===e.length)return[];var t=e.charAt(0),r=e.charAt(e.length-1);if(e.length>1&&t===r&&('"'===t||"'"===t))return['"'+R(e.substr(1,e.length-2))+'"'];var n=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(n)return L(e.substr(0,n.index)).concat(L(n[1])).concat(L(e.substr(n.index+n[0].length)));var a=e.split(".");if(1===a.length)return['"'+R(e)+'"'];for(var i=[],o=0;o<a.length;++o)i=i.concat(L(a[o]));return i}function I(e){return"["+L(e).join("][")+"]"}var M={DynamicVariable:P,define:function(e,t){return new P(e,I(t+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof P},unbox:function(e,t){return"function"==typeof e?new P(B,e):e},accessor:I},W={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},H="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function G(e){return"string"==typeof e?e.split():(F(Array.isArray(e),"invalid extension array"),e)}function U(e){return"string"==typeof e?(F("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function N(e){var t,n,a,i,o=e||{},f={},u=[],s=[],c="undefined"==typeof window?1:window.devicePixelRatio,l=!1,d=function(e){e&&F.raise(e)},m=function(){};"string"==typeof o?(F("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),t=document.querySelector(o),F(t,"invalid query string for element")):"object"==typeof o?"string"==typeof(h=o).nodeName&&"function"==typeof h.appendChild&&"function"==typeof h.getBoundingClientRect?t=o:"function"==typeof(p=o).drawArrays||"function"==typeof p.drawElements?a=(i=o).canvas:(F.constructor(o),"gl"in o?i=o.gl:"canvas"in o?a=U(o.canvas):"container"in o&&(n=U(o.container)),"attributes"in o&&(f=o.attributes,F.type(f,"object","invalid context attributes")),"extensions"in o&&(u=G(o.extensions)),"optionalExtensions"in o&&(s=G(o.optionalExtensions)),"onDone"in o&&(F.type(o.onDone,"function","invalid or missing onDone callback"),d=o.onDone),"profile"in o&&(l=!!o.profile),"pixelRatio"in o&&F((c=+o.pixelRatio)>0,"invalid pixel ratio")):F.raise("invalid arguments to regl");var p,h;if(t&&("canvas"===t.nodeName.toLowerCase()?a=t:n=t),!i){if(!a){F("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var b=function(e,t,n){var a=document.createElement("canvas");r(a.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(a),e===document.body&&(a.style.position="absolute",r(e.style,{margin:0,padding:0}));function i(){var t=window.innerWidth,i=window.innerHeight;if(e!==document.body){var o=e.getBoundingClientRect();t=o.right-o.left,i=o.bottom-o.top}a.width=n*t,a.height=n*i,r(a.style,{width:t+"px",height:i+"px"})}return window.addEventListener("resize",i,!1),i(),{canvas:a,onDestroy:function(){window.removeEventListener("resize",i),e.removeChild(a)}}}(n||document.body,0,c);if(!b)return null;a=b.canvas,m=b.onDestroy}i=function(e,t){function r(r){try{return e.getContext(r,t)}catch(e){return null}}return r("webgl")||r("experimental-webgl")||r("webgl-experimental")}(a,f)}return i?{gl:i,canvas:a,container:n,extensions:u,optionalExtensions:s,pixelRatio:c,profile:l,onDone:d,onDestroy:m}:(m(),d("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}var q=function(e,t){var r=1;t.ext_texture_filter_anisotropic&&(r=e.getParameter(34047));var n=1,a=1;return t.webgl_draw_buffers&&(n=e.getParameter(34852),a=e.getParameter(36063)),{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter(function(e){return!!t[e]}),maxAnisotropic:r,maxDrawbuffers:n,maxColorAttachments:a,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938)}};function Q(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||t(e.data))}var V=function(e){return Object.keys(e).map(function(t){return e[t]})};function Y(e,t){for(var r=Array(e),n=0;n<e;++n)r[n]=t(n);return r}var X=5120,$=5121,K=5122,J=5123,Z=5124,ee=5125,te=5126,re=Y(8,function(){return[]});function ne(e){var t,r;return t=(e>65535)<<4,t|=r=((e>>>=t)>255)<<3,t|=r=((e>>>=r)>15)<<2,(t|=r=((e>>>=r)>3)<<1)|(e>>>=r)>>1}function ae(e){var t=function(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}(e),r=re[ne(t)>>2];return r.length>0?r.pop():new ArrayBuffer(t)}function ie(e){re[ne(e.byteLength)>>2].push(e)}var oe={alloc:ae,free:ie,allocType:function(e,t){var r=null;switch(e){case X:r=new Int8Array(ae(t),0,t);break;case $:r=new Uint8Array(ae(t),0,t);break;case K:r=new Int16Array(ae(2*t),0,t);break;case J:r=new Uint16Array(ae(2*t),0,t);break;case Z:r=new Int32Array(ae(4*t),0,t);break;case ee:r=new Uint32Array(ae(4*t),0,t);break;case te:r=new Float32Array(ae(4*t),0,t);break;default:return null}return r.length!==t?r.subarray(0,t):r},freeType:function(e){ie(e.buffer)}},fe={shape:function(e){for(var t=[],r=e;r.length;r=r[0])t.push(r.length);return t},flatten:function(e,t,r,n){var a=1;if(t.length)for(var i=0;i<t.length;++i)a*=t[i];else a=0;var o=n||oe.allocType(r,a);switch(t.length){case 0:break;case 1:!function(e,t,r){for(var n=0;n<t;++n)r[n]=e[n]}(e,t[0],o);break;case 2:!function(e,t,r,n){for(var a=0,i=0;i<t;++i)for(var o=e[i],f=0;f<r;++f)n[a++]=o[f]}(e,t[0],t[1],o);break;case 3:ue(e,t[0],t[1],t[2],o,0);break;default:se(e,t,0,o,0)}return o}};function ue(e,t,r,n,a,i){for(var o=i,f=0;f<t;++f)for(var u=e[f],s=0;s<r;++s)for(var c=u[s],l=0;l<n;++l)a[o++]=c[l]}function se(e,t,r,n,a){for(var i=1,o=r+1;o<t.length;++o)i*=t[o];var f=t[r];if(t.length-r==4){var u=t[r+1],s=t[r+2],c=t[r+3];for(o=0;o<f;++o)ue(e[o],u,s,c,n,a),a+=i}else for(o=0;o<f;++o)se(e[o],t,r+1,n,a),a+=i}var ce={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},le={dynamic:35048,stream:35040,static:35044},de=fe.flatten,me=fe.shape,pe=35044,he=35040,be=5121,ge=5126,ve=[];ve[5120]=1,ve[5122]=2,ve[5124]=4,ve[5121]=1,ve[5123]=2,ve[5125]=4,ve[5126]=4;function ye(t){return 0|e[Object.prototype.toString.call(t)]}function xe(e,t){for(var r=0;r<t.length;++r)e[r]=t[r]}function we(e,t,r,n,a,i,o){for(var f=0,u=0;u<r;++u)for(var s=0;s<n;++s)e[f++]=t[a*u+i*s+o]}var ke={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Ae=0,Se=1,_e=4,Ee=5120,Te=5121,De=5122,je=5123,Oe=5124,Ce=5125,Fe=34963,ze=35040,Be=35044;var Pe=new Float32Array(1),Re=new Uint32Array(Pe.buffer),Le=5123;function Ie(e){for(var t=oe.allocType(Le,e.length),r=0;r<e.length;++r)if(isNaN(e[r]))t[r]=65535;else if(e[r]===1/0)t[r]=31744;else if(e[r]===-1/0)t[r]=64512;else{Pe[0]=e[r];var n=Re[0],a=n>>>31<<15,i=(n<<1>>>24)-127,o=n>>13&1023;if(i<-24)t[r]=a;else if(i<-14){var f=-14-i;t[r]=a+(o+1024>>f)}else t[r]=i>15?a+31744:a+(i+15<<10)+o}return t}function Me(e){return Array.isArray(e)||t(e)}var We=34467,He=3553,Ge=34067,Ue=34069,Ne=6408,qe=6406,Qe=6407,Ve=6409,Ye=6410,Xe=32854,$e=32855,Ke=36194,Je=32819,Ze=32820,et=33635,tt=34042,rt=6402,nt=34041,at=35904,it=35906,ot=36193,ft=33776,ut=33777,st=33778,ct=33779,lt=35986,dt=35987,mt=34798,pt=35840,ht=35841,bt=35842,gt=35843,vt=36196,yt=5121,xt=5123,wt=5125,kt=5126,At=10242,St=10243,_t=10497,Et=33071,Tt=33648,Dt=10240,jt=10241,Ot=9728,Ct=9729,Ft=9984,zt=9985,Bt=9986,Pt=9987,Rt=33170,Lt=4352,It=4353,Mt=4354,Wt=34046,Ht=3317,Gt=37440,Ut=37441,Nt=37443,qt=37444,Qt=33984,Vt=[Ft,Bt,zt,Pt],Yt=[0,Ve,Ye,Qe,Ne],Xt={};Xt[Ve]=Xt[qe]=Xt[rt]=1,Xt[nt]=Xt[Ye]=2,Xt[Qe]=Xt[at]=3,Xt[Ne]=Xt[it]=4;function $t(e){return"[object "+e+"]"}var Kt=$t("HTMLCanvasElement"),Jt=$t("CanvasRenderingContext2D"),Zt=$t("HTMLImageElement"),er=$t("HTMLVideoElement"),tr=Object.keys(e).concat([Kt,Jt,Zt,er]),rr=[];rr[yt]=1,rr[kt]=4,rr[ot]=2,rr[xt]=2,rr[wt]=4;var nr=[];nr[Xe]=2,nr[$e]=2,nr[Ke]=2,nr[nt]=4,nr[ft]=.5,nr[ut]=.5,nr[st]=1,nr[ct]=1,nr[lt]=.5,nr[dt]=1,nr[mt]=1,nr[pt]=.5,nr[ht]=.25,nr[bt]=.5,nr[gt]=.25,nr[vt]=.5;function ar(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function ir(e){if(!Array.isArray(e))return!1;return!(0===e.length||!Me(e[0]))}function or(e){return Object.prototype.toString.call(e)}function fr(e){return or(e)===Kt}function ur(e){if(!e)return!1;var t=or(e);return tr.indexOf(t)>=0||(ar(e)||ir(e)||Q(e))}function sr(t){return 0|e[Object.prototype.toString.call(t)]}function cr(e,t){return oe.allocType(e.type===ot?kt:e.type,t)}function lr(e,t){e.type===ot?(e.data=Ie(t),oe.freeType(t)):e.data=t}function dr(e,t,r,n,a,i){var o;if(o=void 0!==nr[e]?nr[e]:Xt[e]*rr[t],i&&(o*=6),a){for(var f=0,u=r;u>=1;)f+=o*u*u,u/=2;return f}return o*r*n}function mr(e,n,a,i,o,f,u){var s={"don't care":Lt,"dont care":Lt,nice:Mt,fast:It},c={repeat:_t,clamp:Et,mirror:Tt},l={nearest:Ot,linear:Ct},d=r({mipmap:Pt,"nearest mipmap nearest":Ft,"linear mipmap nearest":zt,"nearest mipmap linear":Bt,"linear mipmap linear":Pt},l),m={none:0,browser:qt},p={uint8:yt,rgba4:Je,rgb565:et,"rgb5 a1":Ze},h={alpha:qe,luminance:Ve,"luminance alpha":Ye,rgb:Qe,rgba:Ne,rgba4:Xe,"rgb5 a1":$e,rgb565:Ke},b={};n.ext_srgb&&(h.srgb=at,h.srgba=it),n.oes_texture_float&&(p.float32=p.float=kt),n.oes_texture_half_float&&(p.float16=p["half float"]=ot),n.webgl_depth_texture&&(r(h,{depth:rt,"depth stencil":nt}),r(p,{uint16:xt,uint32:wt,"depth stencil":tt})),n.webgl_compressed_texture_s3tc&&r(b,{"rgb s3tc dxt1":ft,"rgba s3tc dxt1":ut,"rgba s3tc dxt3":st,"rgba s3tc dxt5":ct}),n.webgl_compressed_texture_atc&&r(b,{"rgb atc":lt,"rgba atc explicit alpha":dt,"rgba atc interpolated alpha":mt}),n.webgl_compressed_texture_pvrtc&&r(b,{"rgb pvrtc 4bppv1":pt,"rgb pvrtc 2bppv1":ht,"rgba pvrtc 4bppv1":bt,"rgba pvrtc 2bppv1":gt}),n.webgl_compressed_texture_etc1&&(b["rgb etc1"]=vt);var g=Array.prototype.slice.call(e.getParameter(We));Object.keys(b).forEach(function(e){var t=b[e];g.indexOf(t)>=0&&(h[e]=t)});var v=Object.keys(h);a.textureFormats=v;var y=[];Object.keys(h).forEach(function(e){var t=h[e];y[t]=e});var x=[];Object.keys(p).forEach(function(e){var t=p[e];x[t]=e});var w=[];Object.keys(l).forEach(function(e){var t=l[e];w[t]=e});var k=[];Object.keys(d).forEach(function(e){var t=d[e];k[t]=e});var A=[];Object.keys(c).forEach(function(e){var t=c[e];A[t]=e});var S=v.reduce(function(e,t){var r=h[t];return r===Ve||r===qe||r===Ve||r===Ye||r===rt||r===nt?e[r]=r:r===$e||t.indexOf("rgba")>=0?e[r]=Ne:e[r]=Qe,e},{});function _(){this.internalformat=Ne,this.format=Ne,this.type=yt,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=0,this.width=0,this.height=0,this.channels=0}function E(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function T(e,t){if("object"==typeof t&&t){if("premultiplyAlpha"in t&&(F.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(F.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(F.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(F.parameter(t.colorSpace,m,"invalid colorSpace"),e.colorSpace=m[t.colorSpace]),"type"in t){var r=t.type;F(n.oes_texture_float||!("float"===r||"float32"===r),"you must enable the OES_texture_float extension in order to use floating point textures."),F(n.oes_texture_half_float||!("half float"===r||"float16"===r),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),F(n.webgl_depth_texture||!("uint16"===r||"uint32"===r||"depth stencil"===r),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),F.parameter(r,p,"invalid texture type"),e.type=p[r]}var i=e.width,o=e.height,f=e.channels,u=!1;"shape"in t?(F(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),i=t.shape[0],o=t.shape[1],3===t.shape.length&&(f=t.shape[2],F(f>0&&f<=4,"invalid number of channels"),u=!0),F(i>=0&&i<=a.maxTextureSize,"invalid width"),F(o>=0&&o<=a.maxTextureSize,"invalid height")):("radius"in t&&(i=o=t.radius,F(i>=0&&i<=a.maxTextureSize,"invalid radius")),"width"in t&&(i=t.width,F(i>=0&&i<=a.maxTextureSize,"invalid width")),"height"in t&&(o=t.height,F(o>=0&&o<=a.maxTextureSize,"invalid height")),"channels"in t&&(f=t.channels,F(f>0&&f<=4,"invalid number of channels"),u=!0)),e.width=0|i,e.height=0|o,e.channels=0|f;var s=!1;if("format"in t){var c=t.format;F(n.webgl_depth_texture||!("depth"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),F.parameter(c,h,"invalid texture format");var l=e.internalformat=h[c];e.format=S[l],c in p&&("type"in t||(e.type=p[c])),c in b&&(e.compressed=!0),s=!0}!u&&s?e.channels=Xt[e.format]:u&&!s?e.channels!==Yt[e.format]&&(e.format=e.internalformat=Yt[e.channels]):s&&u&&F(e.channels===Xt[e.format],"number of channels inconsistent with specified format")}}function D(t){e.pixelStorei(Gt,t.flipY),e.pixelStorei(Ut,t.premultiplyAlpha),e.pixelStorei(Nt,t.colorSpace),e.pixelStorei(Ht,t.unpackAlignment)}function j(){_.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function O(e,r){var n=null;if(ur(r)?n=r:r&&(F.type(r,"object","invalid pixel data type"),T(e,r),"x"in r&&(e.xOffset=0|r.x),"y"in r&&(e.yOffset=0|r.y),ur(r.data)&&(n=r.data)),F(!e.compressed||n instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),r.copy){F(!n,"can not specify copy and data field for the same texture");var i=o.viewportWidth,f=o.viewportHeight;e.width=e.width||i-e.xOffset,e.height=e.height||f-e.yOffset,e.needsCopy=!0,F(e.xOffset>=0&&e.xOffset<i&&e.yOffset>=0&&e.yOffset<f&&e.width>0&&e.width<=i&&e.height>0&&e.height<=f,"copy texture read out of bounds")}else if(n){if(t(n))e.channels=e.channels||4,e.data=n,"type"in r||e.type!==yt||(e.type=sr(n));else if(ar(n))e.channels=e.channels||4,function(e,t){var r=t.length;switch(e.type){case yt:case xt:case wt:case kt:var n=oe.allocType(e.type,r);n.set(t),e.data=n;break;case ot:e.data=Ie(t);break;default:F.raise("unsupported texture type, must specify a typed array")}}(e,n),e.alignment=1,e.needsFree=!0;else if(Q(n)){var u=n.data;Array.isArray(u)||e.type!==yt||(e.type=sr(u));var s,c,l,d,m,p,h=n.shape,b=n.stride;3===h.length?(l=h[2],p=b[2]):(F(2===h.length,"invalid ndarray pixel data, must be 2 or 3D"),l=1,p=1),s=h[0],c=h[1],d=b[0],m=b[1],e.alignment=1,e.width=s,e.height=c,e.channels=l,e.format=e.internalformat=Yt[l],e.needsFree=!0,function(e,t,r,n,a,i){for(var o=e.width,f=e.height,u=e.channels,s=cr(e,o*f*u),c=0,l=0;l<f;++l)for(var d=0;d<o;++d)for(var m=0;m<u;++m)s[c++]=t[r*d+n*l+a*m+i];lr(e,s)}(e,u,d,m,p,n.offset)}else if(fr(n)||(E=n,or(E)===Jt))fr(n)?e.element=n:e.element=n.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(_=n,or(_)===Zt)e.element=n,e.width=n.naturalWidth,e.height=n.naturalHeight,e.channels=4;else if(S=n,or(S)===er)e.element=n,e.width=n.videoWidth,e.height=n.videoHeight,e.channels=4;else if(ir(n)){var g=e.width||n[0].length,v=e.height||n.length,y=e.channels;y=Me(n[0][0])?y||n[0][0].length:y||1;for(var x=fe.shape(n),w=1,k=0;k<x.length;++k)w*=x[k];var A=cr(e,w);fe.flatten(n,x,"",A),lr(e,A),e.alignment=1,e.width=g,e.height=v,e.channels=y,e.format=e.internalformat=Yt[y],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4;var S,_,E;e.type===kt?F(a.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):e.type===ot&&F(a.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function C(t,r,n){var a=t.element,o=t.data,f=t.internalformat,u=t.format,s=t.type,c=t.width,l=t.height;D(t),a?e.texImage2D(r,n,u,u,s,a):t.compressed?e.compressedTexImage2D(r,n,f,c,l,0,o):t.needsCopy?(i(),e.copyTexImage2D(r,n,u,t.xOffset,t.yOffset,c,l,0)):e.texImage2D(r,n,u,c,l,0,u,s,o)}function z(t,r,n,a,o){var f=t.element,u=t.data,s=t.internalformat,c=t.format,l=t.type,d=t.width,m=t.height;D(t),f?e.texSubImage2D(r,o,n,a,c,l,f):t.compressed?e.compressedTexSubImage2D(r,o,n,a,s,d,m,u):t.needsCopy?(i(),e.copyTexSubImage2D(r,o,n,a,t.xOffset,t.yOffset,d,m)):e.texSubImage2D(r,o,n,a,d,m,c,l,u)}var B=[];function P(){return B.pop()||new j}function R(e){e.needsFree&&oe.freeType(e.data),j.call(e),B.push(e)}function L(e,t,r){var n=e.images[0]=P();e.mipmask=1,n.width=e.width=t,n.height=e.height=r,n.channels=e.channels=4}function I(e,t){var r=null;if(ur(t))E(r=e.images[0]=P(),e),O(r,t),e.mipmask=1;else if(T(e,t),Array.isArray(t.mipmap))for(var n=t.mipmap,a=0;a<n.length;++a)E(r=e.images[a]=P(),e),r.width>>=a,r.height>>=a,O(r,n[a]),e.mipmask|=1<<a;else E(r=e.images[0]=P(),e),O(r,t),e.mipmask=1;E(e,e.images[0]),(e.compressed&&e.internalformat===ft||e.internalformat===ut||e.internalformat===st||e.internalformat===ct)&&F(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function M(e,t){for(var r=e.images,n=0;n<r.length;++n){if(!r[n])return;C(r[n],t,n)}}var W=[];function H(){var e=W.pop()||new function(){_.call(this),this.genMipmaps=!1,this.mipmapHint=Lt,this.mipmask=0,this.images=Array(16)};_.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function G(e){for(var t=e.images,r=0;r<t.length;++r)t[r]&&R(t[r]),t[r]=null;W.push(e)}function U(){this.minFilter=Ot,this.magFilter=Ot,this.wrapS=Et,this.wrapT=Et,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Lt}function N(e,t){if("min"in t){var r=t.min;F.parameter(r,d),e.minFilter=d[r],Vt.indexOf(e.minFilter)>=0&&(e.genMipmaps=!0)}if("mag"in t){var n=t.mag;F.parameter(n,l),e.magFilter=l[n]}var i=e.wrapS,o=e.wrapT;if("wrap"in t){var f=t.wrap;"string"==typeof f?(F.parameter(f,c),i=o=c[f]):Array.isArray(f)&&(F.parameter(f[0],c),F.parameter(f[1],c),i=c[f[0]],o=c[f[1]])}else{if("wrapS"in t){var u=t.wrapS;F.parameter(u,c),i=c[u]}if("wrapT"in t){var m=t.wrapT;F.parameter(m,c),o=c[m]}}if(e.wrapS=i,e.wrapT=o,"anisotropic"in t){var p=t.anisotropic;F("number"==typeof p&&p>=1&&p<=a.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var h=!1;switch(typeof t.mipmap){case"string":F.parameter(t.mipmap,s,"invalid mipmap hint"),e.mipmapHint=s[t.mipmap],e.genMipmaps=!0,h=!0;break;case"boolean":h=e.genMipmaps=t.mipmap;break;case"object":F(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,h=!0;break;default:F.raise("invalid mipmap type")}!h||"min"in t||(e.minFilter=Ft)}}function q(t,r){e.texParameteri(r,jt,t.minFilter),e.texParameteri(r,Dt,t.magFilter),e.texParameteri(r,At,t.wrapS),e.texParameteri(r,St,t.wrapT),n.ext_texture_filter_anisotropic&&e.texParameteri(r,Wt,t.anisotropic),t.genMipmaps&&(e.hint(Rt,t.mipmapHint),e.generateMipmap(r))}var Y=0,X={},$=a.maxTextureUnits,K=Array($).map(function(){return null});function J(t){_.call(this),this.mipmask=0,this.internalformat=Ne,this.id=Y++,this.refCount=1,this.target=t,this.texture=e.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new U,u.profile&&(this.stats={size:0})}function Z(t){e.activeTexture(Qt),e.bindTexture(t.target,t.texture)}function ee(){var t=K[0];t?e.bindTexture(t.target,t.texture):e.bindTexture(He,null)}function te(t){var r=t.texture;F(r,"must not double destroy texture");var n=t.unit,a=t.target;n>=0&&(e.activeTexture(Qt+n),e.bindTexture(a,null),K[n]=null),e.deleteTexture(r),t.texture=null,t.params=null,t.pixels=null,t.refCount=0,delete X[t.id],f.textureCount--}r(J.prototype,{bind:function(){this.bindCount+=1;var t=this.unit;if(t<0){for(var r=0;r<$;++r){var n=K[r];if(n){if(n.bindCount>0)continue;n.unit=-1}K[r]=this,t=r;break}t>=$&&F.raise("insufficient number of texture units"),u.profile&&f.maxTextureUnits<t+1&&(f.maxTextureUnits=t+1),this.unit=t,e.activeTexture(Qt+t),e.bindTexture(this.target,this.texture)}return t},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&te(this)}});u.profile&&(f.getTotalTextureSize=function(){var e=0;return Object.keys(X).forEach(function(t){e+=X[t].stats.size}),e});return{create2D:function(t,r){var n=new J(He);X[n.id]=n,f.textureCount++;function i(e,t){var r=n.texInfo;U.call(r);var o=H();return"number"==typeof e?L(o,0|e,"number"==typeof t?0|t:0|e):e?(F.type(e,"object","invalid arguments to regl.texture"),N(r,e),I(o,e)):L(o,1,1),r.genMipmaps&&(o.mipmask=(o.width<<1)-1),n.mipmask=o.mipmask,E(n,o),F.texture2D(r,o,a),n.internalformat=o.internalformat,i.width=o.width,i.height=o.height,Z(n),M(o,He),q(r,He),ee(),G(o),u.profile&&(n.stats.size=dr(n.internalformat,n.type,o.width,o.height,r.genMipmaps,!1)),i.format=y[n.internalformat],i.type=x[n.type],i.mag=w[r.magFilter],i.min=k[r.minFilter],i.wrapS=A[r.wrapS],i.wrapT=A[r.wrapT],i}return i(t,r),i.subimage=function(e,t,r,a){F(!!e,"must specify image data");var o=0|t,f=0|r,u=0|a,s=P();return E(s,n),s.width=0,s.height=0,O(s,e),s.width=s.width||(n.width>>u)-o,s.height=s.height||(n.height>>u)-f,F(n.type===s.type&&n.format===s.format&&n.internalformat===s.internalformat,"incompatible format for texture.subimage"),F(o>=0&&f>=0&&o+s.width<=n.width&&f+s.height<=n.height,"texture.subimage write out of bounds"),F(n.mipmask&1<<u,"missing mipmap data"),F(s.data||s.element||s.needsCopy,"missing image data"),Z(n),z(s,He,o,f,u),ee(),R(s),i},i.resize=function(t,r){var a=0|t,o=0|r||a;if(a===n.width&&o===n.height)return i;i.width=n.width=a,i.height=n.height=o,Z(n);for(var f=0;n.mipmask>>f;++f)e.texImage2D(He,f,n.format,a>>f,o>>f,0,n.format,n.type,null);return ee(),u.profile&&(n.stats.size=dr(n.internalformat,n.type,a,o,!1,!1)),i},i._reglType="texture2d",i._texture=n,u.profile&&(i.stats=n.stats),i.destroy=function(){n.decRef()},i},createCube:function(t,r,n,i,o,s){var c=new J(Ge);X[c.id]=c,f.cubeCount++;var l=new Array(6);function d(e,t,r,n,i,o){var f,s=c.texInfo;for(U.call(s),f=0;f<6;++f)l[f]=H();if("number"!=typeof e&&e)if("object"==typeof e)if(t)I(l[0],e),I(l[1],t),I(l[2],r),I(l[3],n),I(l[4],i),I(l[5],o);else if(N(s,e),T(c,e),"faces"in e){var m=e.faces;for(F(Array.isArray(m)&&6===m.length,"cube faces must be a length 6 array"),f=0;f<6;++f)F("object"==typeof m[f]&&!!m[f],"invalid input for cube map face"),E(l[f],c),I(l[f],m[f])}else for(f=0;f<6;++f)I(l[f],e);else F.raise("invalid arguments to cube map");else{var p=0|e||1;for(f=0;f<6;++f)L(l[f],p,p)}for(E(c,l[0]),s.genMipmaps?c.mipmask=(l[0].width<<1)-1:c.mipmask=l[0].mipmask,F.textureCube(c,s,l,a),c.internalformat=l[0].internalformat,d.width=l[0].width,d.height=l[0].height,Z(c),f=0;f<6;++f)M(l[f],Ue+f);for(q(s,Ge),ee(),u.profile&&(c.stats.size=dr(c.internalformat,c.type,d.width,d.height,s.genMipmaps,!0)),d.format=y[c.internalformat],d.type=x[c.type],d.mag=w[s.magFilter],d.min=k[s.minFilter],d.wrapS=A[s.wrapS],d.wrapT=A[s.wrapT],f=0;f<6;++f)G(l[f]);return d}return d(t,r,n,i,o,s),d.subimage=function(e,t,r,n,a){F(!!t,"must specify image data"),F("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var i=0|r,o=0|n,f=0|a,u=P();return E(u,c),u.width=0,u.height=0,O(u,t),u.width=u.width||(c.width>>f)-i,u.height=u.height||(c.height>>f)-o,F(c.type===u.type&&c.format===u.format&&c.internalformat===u.internalformat,"incompatible format for texture.subimage"),F(i>=0&&o>=0&&i+u.width<=c.width&&o+u.height<=c.height,"texture.subimage write out of bounds"),F(c.mipmask&1<<f,"missing mipmap data"),F(u.data||u.element||u.needsCopy,"missing image data"),Z(c),z(u,Ue+e,i,o,f),ee(),R(u),d},d.resize=function(t){var r=0|t;if(r!==c.width){d.width=c.width=r,d.height=c.height=r,Z(c);for(var n=0;n<6;++n)for(var a=0;c.mipmask>>a;++a)e.texImage2D(Ue+n,a,c.format,r>>a,r>>a,0,c.format,c.type,null);return ee(),u.profile&&(c.stats.size=dr(c.internalformat,c.type,d.width,d.height,!1,!0)),d}},d._reglType="textureCube",d._texture=c,u.profile&&(d.stats=c.stats),d.destroy=function(){c.decRef()},d},clear:function(){for(var t=0;t<$;++t)e.activeTexture(Qt+t),e.bindTexture(He,null),K[t]=null;V(X).forEach(te),f.cubeCount=0,f.textureCount=0},getTexture:function(e){return null},restore:function(){V(X).forEach(function(t){t.texture=e.createTexture(),e.bindTexture(t.target,t.texture);for(var r=0;r<32;++r)if(0!=(t.mipmask&1<<r))if(t.target===He)e.texImage2D(He,r,t.internalformat,t.width>>r,t.height>>r,0,t.internalformat,t.type,null);else for(var n=0;n<6;++n)e.texImage2D(Ue+n,r,t.internalformat,t.width>>r,t.height>>r,0,t.internalformat,t.type,null);q(t.texInfo,t.target)})}}}var pr=36161,hr=32854,br=[];br[hr]=2,br[32855]=2,br[36194]=2,br[33189]=2,br[36168]=1,br[34041]=4,br[35907]=4,br[34836]=16,br[34842]=8,br[34843]=6;function gr(e,t,r){return br[e]*t*r}var vr=function(e,t,r,n,a){var i={rgba4:hr,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(i.srgba=35907),t.ext_color_buffer_half_float&&(i.rgba16f=34842,i.rgb16f=34843),t.webgl_color_buffer_float&&(i.rgba32f=34836);var o=[];Object.keys(i).forEach(function(e){var t=i[e];o[t]=e});var f=0,u={};function s(e){this.id=f++,this.refCount=1,this.renderbuffer=e,this.format=hr,this.width=0,this.height=0,a.profile&&(this.stats={size:0})}s.prototype.decRef=function(){--this.refCount<=0&&c(this)};function c(t){var r=t.renderbuffer;F(r,"must not double destroy renderbuffer"),e.bindRenderbuffer(pr,null),e.deleteRenderbuffer(r),t.renderbuffer=null,t.refCount=0,delete u[t.id],n.renderbufferCount--}a.profile&&(n.getTotalRenderbufferSize=function(){var e=0;return Object.keys(u).forEach(function(t){e+=u[t].stats.size}),e});return{create:function(t,f){var c=new s(e.createRenderbuffer());u[c.id]=c,n.renderbufferCount++;function l(t,n){var f=0,u=0,s=hr;if("object"==typeof t&&t){var d=t;if("shape"in d){var m=d.shape;F(Array.isArray(m)&&m.length>=2,"invalid renderbuffer shape"),f=0|m[0],u=0|m[1]}else"radius"in d&&(f=u=0|d.radius),"width"in d&&(f=0|d.width),"height"in d&&(u=0|d.height);"format"in d&&(F.parameter(d.format,i,"invalid renderbuffer format"),s=i[d.format])}else"number"==typeof t?(f=0|t,u="number"==typeof n?0|n:f):t?F.raise("invalid arguments to renderbuffer constructor"):f=u=1;if(F(f>0&&u>0&&f<=r.maxRenderbufferSize&&u<=r.maxRenderbufferSize,"invalid renderbuffer size"),f!==c.width||u!==c.height||s!==c.format)return l.width=c.width=f,l.height=c.height=u,c.format=s,e.bindRenderbuffer(pr,c.renderbuffer),e.renderbufferStorage(pr,s,f,u),a.profile&&(c.stats.size=gr(c.format,c.width,c.height)),l.format=o[c.format],l}return l(t,f),l.resize=function(t,n){var i=0|t,o=0|n||i;return i===c.width&&o===c.height?l:(F(i>0&&o>0&&i<=r.maxRenderbufferSize&&o<=r.maxRenderbufferSize,"invalid renderbuffer size"),l.width=c.width=i,l.height=c.height=o,e.bindRenderbuffer(pr,c.renderbuffer),e.renderbufferStorage(pr,c.format,i,o),a.profile&&(c.stats.size=gr(c.format,c.width,c.height)),l)},l._reglType="renderbuffer",l._renderbuffer=c,a.profile&&(l.stats=c.stats),l.destroy=function(){c.decRef()},l},clear:function(){V(u).forEach(c)},restore:function(){V(u).forEach(function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(pr,t.renderbuffer),e.renderbufferStorage(pr,t.format,t.width,t.height)}),e.bindRenderbuffer(pr,null)}}},yr=36160,xr=36161,wr=3553,kr=34069,Ar=36064,Sr=36096,_r=36128,Er=33306,Tr=36053,Dr=6402,jr=[6408],Or=[];Or[6408]=4;var Cr=[];Cr[5121]=1,Cr[5126]=4,Cr[36193]=2;var Fr=33189,zr=36168,Br=34041,Pr=[32854,32855,36194,35907,34842,34843,34836],Rr={};Rr[Tr]="complete",Rr[36054]="incomplete attachment",Rr[36057]="incomplete dimensions",Rr[36055]="incomplete, missing attachment",Rr[36061]="unsupported";var Lr=5126;function Ir(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Lr,this.offset=0,this.stride=0,this.divisor=0}var Mr=35632,Wr=35633,Hr=35718,Gr=35721;function Ur(e,t,r,n){var a={},i={};function o(e,t,r,n){this.name=e,this.id=t,this.location=r,this.info=n}function f(e,t){for(var r=0;r<e.length;++r)if(e[r].id===t.id)return void(e[r].location=t.location);e.push(t)}function u(r,n,o){var f=r===Mr?a:i,u=f[n];if(!u){var s=t.str(n);u=e.createShader(r),e.shaderSource(u,s),e.compileShader(u),F.shaderError(e,u,s,r,o),f[n]=u}return u}var s={},c=[],l=0;function d(r,a){var i,s,c=u(Mr,r.fragId),l=u(Wr,r.vertId),d=r.program=e.createProgram();e.attachShader(d,c),e.attachShader(d,l),e.linkProgram(d),F.linkError(e,d,t.str(r.fragId),t.str(r.vertId),a);var m=e.getProgramParameter(d,Hr);n.profile&&(r.stats.uniformsCount=m);var p=r.uniforms;for(i=0;i<m;++i)if(s=e.getActiveUniform(d,i))if(s.size>1)for(var h=0;h<s.size;++h){var b=s.name.replace("[0]","["+h+"]");f(p,new o(b,t.id(b),e.getUniformLocation(d,b),s))}else f(p,new o(s.name,t.id(s.name),e.getUniformLocation(d,s.name),s));var g=e.getProgramParameter(d,Gr);n.profile&&(r.stats.attributesCount=g);var v=r.attributes;for(i=0;i<g;++i)(s=e.getActiveAttrib(d,i))&&f(v,new o(s.name,t.id(s.name),e.getAttribLocation(d,s.name),s))}n.profile&&(r.getMaxUniformsCount=function(){var e=0;return c.forEach(function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)}),e},r.getMaxAttributesCount=function(){var e=0;return c.forEach(function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)}),e});return{clear:function(){var t=e.deleteShader.bind(e);V(a).forEach(t),a={},V(i).forEach(t),i={},c.forEach(function(t){e.deleteProgram(t.program)}),c.length=0,s={},r.shaderCount=0},program:function(e,t,a){F.command(e>=0,"missing vertex shader",a),F.command(t>=0,"missing fragment shader",a);var i=s[t];i||(i=s[t]={});var o=i[e];return o||(o=new function(e,t){this.id=l++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],n.profile&&(this.stats={uniformsCount:0,attributesCount:0})}(t,e),r.shaderCount++,d(o,a),i[e]=o,c.push(o)),o},restore:function(){a={},i={};for(var e=0;e<c.length;++e)d(c[e])},shader:u,frag:-1,vert:-1}}var Nr=6408,qr=5121,Qr=3333,Vr=5126;function Yr(e,r,n,a,i,o){function f(f){var u;null===r.next?(F(i.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),u=qr):(F(null!==r.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),u=r.next.colorAttachments[0].texture._texture.type,o.oes_texture_float?F(u===qr||u===Vr,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"):F(u===qr,"Reading from a framebuffer is only allowed for the type 'uint8'"));var s=0,c=0,l=a.framebufferWidth,d=a.framebufferHeight,m=null;t(f)?m=f:f&&(F.type(f,"object","invalid arguments to regl.read()"),s=0|f.x,c=0|f.y,F(s>=0&&s<a.framebufferWidth,"invalid x offset for regl.read"),F(c>=0&&c<a.framebufferHeight,"invalid y offset for regl.read"),l=0|(f.width||a.framebufferWidth-s),d=0|(f.height||a.framebufferHeight-c),m=f.data||null),m&&(u===qr?F(m instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):u===Vr&&F(m instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),F(l>0&&l+s<=a.framebufferWidth,"invalid width for read pixels"),F(d>0&&d+c<=a.framebufferHeight,"invalid height for read pixels"),n();var p=l*d*4;return m||(u===qr?m=new Uint8Array(p):u===Vr&&(m=m||new Float32Array(p))),F.isTypedArray(m,"data buffer for regl.read() must be a typedarray"),F(m.byteLength>=p,"data buffer for regl.read() too small"),e.pixelStorei(Qr,4),e.readPixels(s,c,l,d,Nr,u,m),m}return function(e){return e&&"framebuffer"in e?function(e){var t;return r.setFBO({framebuffer:e.framebuffer},function(){t=f(e)}),t}(e):f(e)}}function Xr(e){return Array.prototype.slice.call(e)}function $r(e){return Xr(e).join("")}var Kr="xyzw".split(""),Jr=5121,Zr=1,en=2,tn=0,rn=1,nn=2,an=3,on=4,fn="dither",un="blend.enable",sn="blend.color",cn="blend.equation",ln="blend.func",dn="depth.enable",mn="depth.func",pn="depth.range",hn="depth.mask",bn="colorMask",gn="cull.enable",vn="cull.face",yn="frontFace",xn="lineWidth",wn="polygonOffset.enable",kn="polygonOffset.offset",An="sample.alpha",Sn="sample.enable",_n="sample.coverage",En="stencil.enable",Tn="stencil.mask",Dn="stencil.func",jn="stencil.opFront",On="stencil.opBack",Cn="scissor.enable",Fn="scissor.box",zn="viewport",Bn="profile",Pn="framebuffer",Rn="vert",Ln="frag",In="elements",Mn="primitive",Wn="count",Hn="offset",Gn="instances",Un=Pn+"Width",Nn=Pn+"Height",qn=zn+"Width",Qn=zn+"Height",Vn="drawingBufferWidth",Yn="drawingBufferHeight",Xn=[ln,cn,Dn,jn,On,_n,zn,Fn,kn],$n=34962,Kn=34963,Jn=3553,Zn=34067,ea=2884,ta=3042,ra=3024,na=2960,aa=2929,ia=3089,oa=32823,fa=32926,ua=32928,sa=5126,ca=35664,la=35665,da=35666,ma=5124,pa=35667,ha=35668,ba=35669,ga=35670,va=35671,ya=35672,xa=35673,wa=35674,ka=35675,Aa=35676,Sa=35678,_a=35680,Ea=4,Ta=1028,Da=1029,ja=2304,Oa=2305,Ca=32775,Fa=32776,za=519,Ba=7680,Pa=0,Ra=1,La=32774,Ia=513,Ma=36160,Wa=36064,Ha={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Ga=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Ua={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Na={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},qa={frag:35632,vert:35633},Qa={cw:ja,ccw:Oa};function Va(e){return Array.isArray(e)||t(e)||Q(e)}function Ya(e){return e.sort(function(e,t){return e===zn?-1:t===zn?1:e<t?-1:1})}function Xa(e,t,r,n){this.thisDep=e,this.contextDep=t,this.propDep=r,this.append=n}function $a(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function Ka(e){return new Xa(!1,!1,!1,e)}function Ja(e,t){var r=e.type;if(r===tn){var n=e.data.length;return new Xa(!0,n>=1,n>=2,t)}if(r===on){var a=e.data;return new Xa(a.thisDep,a.contextDep,a.propDep,t)}return new Xa(r===an,r===nn,r===rn,t)}var Za=new Xa(!1,!1,!1,function(){});function ei(e,t,n,a,i,o,f,u,s,c,l,d,m,p,h){var b=c.Record,g={add:32774,subtract:32778,"reverse subtract":32779};n.ext_blend_minmax&&(g.min=Ca,g.max=Fa);var v=n.angle_instanced_arrays,y=n.webgl_draw_buffers,x={dirty:!0,profile:h.profile},w={},k=[],A={},S={};function _(e){return e.replace(".","_")}function E(e,t,r){var n=_(e);k.push(e),w[n]=x[n]=!!r,A[n]=t}function T(e,t,r){var n=_(e);k.push(e),Array.isArray(r)?(x[n]=r.slice(),w[n]=r.slice()):x[n]=w[n]=r,S[n]=t}E(fn,ra),E(un,ta),T(sn,"blendColor",[0,0,0,0]),T(cn,"blendEquationSeparate",[La,La]),T(ln,"blendFuncSeparate",[Ra,Pa,Ra,Pa]),E(dn,aa,!0),T(mn,"depthFunc",Ia),T(pn,"depthRange",[0,1]),T(hn,"depthMask",!0),T(bn,bn,[!0,!0,!0,!0]),E(gn,ea),T(vn,"cullFace",Da),T(yn,yn,Oa),T(xn,xn,1),E(wn,oa),T(kn,"polygonOffset",[0,0]),E(An,fa),E(Sn,ua),T(_n,"sampleCoverage",[1,!1]),E(En,na),T(Tn,"stencilMask",-1),T(Dn,"stencilFunc",[za,0,-1]),T(jn,"stencilOpSeparate",[Ta,Ba,Ba,Ba]),T(On,"stencilOpSeparate",[Da,Ba,Ba,Ba]),E(Cn,ia),T(Fn,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),T(zn,zn,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var D={gl:e,context:m,strings:t,next:w,current:x,draw:d,elements:o,buffer:i,shader:l,attributes:c.state,uniforms:s,framebuffer:u,extensions:n,timer:p,isBufferArgs:Va},j={primTypes:ke,compareFuncs:Ua,blendFuncs:Ha,blendEquations:g,stencilOps:Na,glTypes:ce,orientationType:Qa};F.optional(function(){D.isArrayLike=Me}),y&&(j.backBuffer=[Da],j.drawBuffer=Y(a.maxDrawbuffers,function(e){return 0===e?[0]:Y(e,function(e){return Wa+e})}));var O=0;function C(){var e=function(){var e=0,t=[],n=[];function a(){var t=[],n=[];return r(function(){t.push.apply(t,Xr(arguments))},{def:function(){var r="v"+e++;return n.push(r),arguments.length>0&&(t.push(r,"="),t.push.apply(t,Xr(arguments)),t.push(";")),r},toString:function(){return $r([n.length>0?"var "+n+";":"",$r(t)])}})}function i(){var e=a(),t=a(),n=e.toString,i=t.toString;function o(r,n){t(r,n,"=",e.def(r,n),";")}return r(function(){e.apply(e,Xr(arguments))},{def:e.def,entry:e,exit:t,save:o,set:function(t,r,n){o(t,r),e(t,r,"=",n,";")},toString:function(){return n()+i()}})}var o=a(),f={};return{global:o,link:function(r){for(var a=0;a<n.length;++a)if(n[a]===r)return t[a];var i="g"+e++;return t.push(i),n.push(r),i},block:a,proc:function(e,t){var n=[];function a(){var e="a"+n.length;return n.push(e),e}t=t||0;for(var o=0;o<t;++o)a();var u=i(),s=u.toString;return f[e]=r(u,{arg:a,toString:function(){return $r(["function(",n.join(),"){",s(),"}"])}})},scope:i,cond:function(){var e=$r(arguments),t=i(),n=i(),a=t.toString,o=n.toString;return r(t,{then:function(){return t.apply(t,Xr(arguments)),this},else:function(){return n.apply(n,Xr(arguments)),this},toString:function(){var t=o();return t&&(t="else{"+t+"}"),$r(["if(",e,"){",a(),"}",t])}})},compile:function(){var e=['"use strict";',o,"return {"];Object.keys(f).forEach(function(t){e.push('"',t,'":',f[t].toString(),",")}),e.push("}");var r=$r(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,t.concat(r)).apply(null,n)}}}(),n=e.link,a=e.global;e.id=O++,e.batchId="0";var i=n(D),o=e.shared={props:"a0"};Object.keys(D).forEach(function(e){o[e]=a.def(i,".",e)}),F.optional(function(){e.CHECK=n(F),e.commandStr=F.guessCommand(),e.command=n(e.commandStr),e.assert=function(e,t,r){e("if(!(",t,"))",this.CHECK,".commandRaise(",n(r),",",this.command,");")},j.invalidBlendCombinations=Ga});var f=e.next={},u=e.current={};Object.keys(S).forEach(function(e){Array.isArray(x[e])&&(f[e]=a.def(o.next,".",e),u[e]=a.def(o.current,".",e))});var s=e.constants={};Object.keys(j).forEach(function(e){s[e]=a.def(JSON.stringify(j[e]))}),e.invoke=function(t,r){switch(r.type){case tn:var a=["this",o.context,o.props,e.batchId];return t.def(n(r.data),".call(",a.slice(0,Math.max(r.data.length+1,4)),")");case rn:return t.def(o.props,r.data);case nn:return t.def(o.context,r.data);case an:return t.def("this",r.data);case on:return r.data.append(e,t),r.data.ref}},e.attribCache={};var l={};return e.scopeAttrib=function(e){var r=t.id(e);if(r in l)return l[r];var a=c.scope[r];a||(a=c.scope[r]=new b);return l[r]=n(a)},e}function z(e,r,n,f,s){var c=e.static,d=e.dynamic;F.optional(function(){var e=[Pn,Rn,Ln,In,Mn,Hn,Wn,Gn,Bn].concat(k);function t(t){Object.keys(t).forEach(function(t){F.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',s.commandStr)})}t(c),t(d)});var m=function(e,t){var r=e.static,n=e.dynamic;if(Pn in r){var a=r[Pn];return a?(a=u.getFramebuffer(a),F.command(a,"invalid framebuffer object"),Ka(function(e,t){var r=e.link(a),n=e.shared;t.set(n.framebuffer,".next",r);var i=n.context;return t.set(i,"."+Un,r+".width"),t.set(i,"."+Nn,r+".height"),r})):Ka(function(e,t){var r=e.shared;t.set(r.framebuffer,".next","null");var n=r.context;return t.set(n,"."+Un,n+"."+Vn),t.set(n,"."+Nn,n+"."+Yn),"null"})}if(Pn in n){var i=n[Pn];return Ja(i,function(e,t){var r=e.invoke(t,i),n=e.shared,a=n.framebuffer,o=t.def(a,".getFramebuffer(",r,")");F.optional(function(){e.assert(t,"!"+r+"||"+o,"invalid framebuffer object")}),t.set(a,".next",o);var f=n.context;return t.set(f,"."+Un,o+"?"+o+".width:"+f+"."+Vn),t.set(f,"."+Nn,o+"?"+o+".height:"+f+"."+Yn),o})}return null}(e),p=function(e,t,r){var n=e.static,a=e.dynamic;function i(e){if(e in n){var i=n[e];F.commandType(i,"object","invalid "+e,r.commandStr);var o,f,u=!0,s=0|i.x,c=0|i.y;return"width"in i?(o=0|i.width,F.command(o>=0,"invalid "+e,r.commandStr)):u=!1,"height"in i?(f=0|i.height,F.command(f>=0,"invalid "+e,r.commandStr)):u=!1,new Xa(!u&&t&&t.thisDep,!u&&t&&t.contextDep,!u&&t&&t.propDep,function(e,t){var r=e.shared.context,n=o;"width"in i||(n=t.def(r,".",Un,"-",s));var a=f;return"height"in i||(a=t.def(r,".",Nn,"-",c)),[s,c,n,a]})}if(e in a){var l=a[e],d=Ja(l,function(t,r){var n=t.invoke(r,l);F.optional(function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+e)});var a=t.shared.context,i=r.def(n,".x|0"),o=r.def(n,".y|0"),f=r.def('"width" in ',n,"?",n,".width|0:","(",a,".",Un,"-",i,")"),u=r.def('"height" in ',n,"?",n,".height|0:","(",a,".",Nn,"-",o,")");return F.optional(function(){t.assert(r,f+">=0&&"+u+">=0","invalid "+e)}),[i,o,f,u]});return t&&(d.thisDep=d.thisDep||t.thisDep,d.contextDep=d.contextDep||t.contextDep,d.propDep=d.propDep||t.propDep),d}return t?new Xa(t.thisDep,t.contextDep,t.propDep,function(e,t){var r=e.shared.context;return[0,0,t.def(r,".",Un),t.def(r,".",Nn)]}):null}var o=i(zn);if(o){var f=o;o=new Xa(o.thisDep,o.contextDep,o.propDep,function(e,t){var r=f.append(e,t),n=e.shared.context;return t.set(n,"."+qn,r[2]),t.set(n,"."+Qn,r[3]),r})}return{viewport:o,scissor_box:i(Fn)}}(e,m,s),h=function(e,t){var r=e.static,n=e.dynamic,a=function(){if(In in r){var e=r[In];Va(e)?e=o.getElements(o.create(e,!0)):e&&(e=o.getElements(e),F.command(e,"invalid elements",t.commandStr));var a=Ka(function(t,r){if(e){var n=t.link(e);return t.ELEMENTS=n,n}return t.ELEMENTS=null,null});return a.value=e,a}if(In in n){var i=n[In];return Ja(i,function(e,t){var r=e.shared,n=r.isBufferArgs,a=r.elements,o=e.invoke(t,i),f=t.def("null"),u=t.def(n,"(",o,")"),s=e.cond(u).then(f,"=",a,".createStream(",o,");").else(f,"=",a,".getElements(",o,");");return F.optional(function(){e.assert(s.else,"!"+o+"||"+f,"invalid elements")}),t.entry(s),t.exit(e.cond(u).then(a,".destroyStream(",f,");")),e.ELEMENTS=f,f})}return null}();function i(e,i){if(e in r){var o=0|r[e];return F.command(!i||o>=0,"invalid "+e,t.commandStr),Ka(function(e,t){return i&&(e.OFFSET=o),o})}if(e in n){var f=n[e];return Ja(f,function(t,r){var n=t.invoke(r,f);return i&&(t.OFFSET=n,F.optional(function(){t.assert(r,n+">=0","invalid "+e)})),n})}return i&&a?Ka(function(e,t){return e.OFFSET="0",0}):null}var f=i(Hn,!0);return{elements:a,primitive:function(){if(Mn in r){var e=r[Mn];return F.commandParameter(e,ke,"invalid primitve",t.commandStr),Ka(function(t,r){return ke[e]})}if(Mn in n){var i=n[Mn];return Ja(i,function(e,t){var r=e.constants.primTypes,n=e.invoke(t,i);return F.optional(function(){e.assert(t,n+" in "+r,"invalid primitive, must be one of "+Object.keys(ke))}),t.def(r,"[",n,"]")})}return a?$a(a)?a.value?Ka(function(e,t){return t.def(e.ELEMENTS,".primType")}):Ka(function(){return Ea}):new Xa(a.thisDep,a.contextDep,a.propDep,function(e,t){var r=e.ELEMENTS;return t.def(r,"?",r,".primType:",Ea)}):null}(),count:function(){if(Wn in r){var e=0|r[Wn];return F.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),Ka(function(){return e})}if(Wn in n){var i=n[Wn];return Ja(i,function(e,t){var r=e.invoke(t,i);return F.optional(function(){e.assert(t,"typeof "+r+'==="number"&&'+r+">=0&&"+r+"===("+r+"|0)","invalid vertex count")}),r})}if(a){if($a(a)){if(a)return f?new Xa(f.thisDep,f.contextDep,f.propDep,function(e,t){var r=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return F.optional(function(){e.assert(t,r+">=0","invalid vertex offset/element buffer too small")}),r}):Ka(function(e,t){return t.def(e.ELEMENTS,".vertCount")});var o=Ka(function(){return-1});return F.optional(function(){o.MISSING=!0}),o}var u=new Xa(a.thisDep||f.thisDep,a.contextDep||f.contextDep,a.propDep||f.propDep,function(e,t){var r=e.ELEMENTS;return e.OFFSET?t.def(r,"?",r,".vertCount-",e.OFFSET,":-1"):t.def(r,"?",r,".vertCount:-1")});return F.optional(function(){u.DYNAMIC=!0}),u}return null}(),instances:i(Gn,!1),offset:f}}(e,s),y=function(e,t){var r=e.static,n=e.dynamic,i={};return k.forEach(function(e){var o=_(e);function f(t,a){if(e in r){var f=t(r[e]);i[o]=Ka(function(){return f})}else if(e in n){var u=n[e];i[o]=Ja(u,function(e,t){return a(e,t,e.invoke(t,u))})}}switch(e){case gn:case un:case fn:case En:case dn:case Cn:case wn:case An:case Sn:case hn:return f(function(r){return F.commandType(r,"boolean",e,t.commandStr),r},function(t,r,n){return F.optional(function(){t.assert(r,"typeof "+n+'==="boolean"',"invalid flag "+e,t.commandStr)}),n});case mn:return f(function(r){return F.commandParameter(r,Ua,"invalid "+e,t.commandStr),Ua[r]},function(t,r,n){var a=t.constants.compareFuncs;return F.optional(function(){t.assert(r,n+" in "+a,"invalid "+e+", must be one of "+Object.keys(Ua))}),r.def(a,"[",n,"]")});case pn:return f(function(e){return F.command(Me(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e},function(e,t,r){return F.optional(function(){e.assert(t,e.shared.isArrayLike+"("+r+")&&"+r+".length===2&&typeof "+r+'[0]==="number"&&typeof '+r+'[1]==="number"&&'+r+"[0]<="+r+"[1]","depth range must be a 2d array")}),[t.def("+",r,"[0]"),t.def("+",r,"[1]")]});case ln:return f(function(e){F.commandType(e,"object","blend.func",t.commandStr);var r="srcRGB"in e?e.srcRGB:e.src,n="srcAlpha"in e?e.srcAlpha:e.src,a="dstRGB"in e?e.dstRGB:e.dst,i="dstAlpha"in e?e.dstAlpha:e.dst;return F.commandParameter(r,Ha,o+".srcRGB",t.commandStr),F.commandParameter(n,Ha,o+".srcAlpha",t.commandStr),F.commandParameter(a,Ha,o+".dstRGB",t.commandStr),F.commandParameter(i,Ha,o+".dstAlpha",t.commandStr),F.command(-1===Ga.indexOf(r+", "+a),"unallowed blending combination (srcRGB, dstRGB) = ("+r+", "+a+")",t.commandStr),[Ha[r],Ha[a],Ha[n],Ha[i]]},function(t,r,n){var a=t.constants.blendFuncs;F.optional(function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid blend func, must be an object")});function i(i,o){var f=r.def('"',i,o,'" in ',n,"?",n,".",i,o,":",n,".",i);return F.optional(function(){t.assert(r,f+" in "+a,"invalid "+e+"."+i+o+", must be one of "+Object.keys(Ha))}),f}var o=i("src","RGB"),f=i("dst","RGB");F.optional(function(){var e=t.constants.invalidBlendCombinations;t.assert(r,e+".indexOf("+o+'+", "+'+f+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var u=r.def(a,"[",o,"]"),s=r.def(a,"[",i("src","Alpha"),"]");return[u,r.def(a,"[",f,"]"),s,r.def(a,"[",i("dst","Alpha"),"]")]});case cn:return f(function(r){return"string"==typeof r?(F.commandParameter(r,g,"invalid "+e,t.commandStr),[g[r],g[r]]):"object"==typeof r?(F.commandParameter(r.rgb,g,e+".rgb",t.commandStr),F.commandParameter(r.alpha,g,e+".alpha",t.commandStr),[g[r.rgb],g[r.alpha]]):void F.commandRaise("invalid blend.equation",t.commandStr)},function(t,r,n){var a=t.constants.blendEquations,i=r.def(),o=r.def(),f=t.cond("typeof ",n,'==="string"');return F.optional(function(){function r(e,r,n){t.assert(e,n+" in "+a,"invalid "+r+", must be one of "+Object.keys(g))}r(f.then,e,n),t.assert(f.else,n+"&&typeof "+n+'==="object"',"invalid "+e),r(f.else,e+".rgb",n+".rgb"),r(f.else,e+".alpha",n+".alpha")}),f.then(i,"=",o,"=",a,"[",n,"];"),f.else(i,"=",a,"[",n,".rgb];",o,"=",a,"[",n,".alpha];"),r(f),[i,o]});case sn:return f(function(e){return F.command(Me(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),Y(4,function(t){return+e[t]})},function(e,t,r){return F.optional(function(){e.assert(t,e.shared.isArrayLike+"("+r+")&&"+r+".length===4","blend.color must be a 4d array")}),Y(4,function(e){return t.def("+",r,"[",e,"]")})});case Tn:return f(function(e){return F.commandType(e,"number",o,t.commandStr),0|e},function(e,t,r){return F.optional(function(){e.assert(t,"typeof "+r+'==="number"',"invalid stencil.mask")}),t.def(r,"|0")});case Dn:return f(function(r){F.commandType(r,"object",o,t.commandStr);var n=r.cmp||"keep",a=r.ref||0,i="mask"in r?r.mask:-1;return F.commandParameter(n,Ua,e+".cmp",t.commandStr),F.commandType(a,"number",e+".ref",t.commandStr),F.commandType(i,"number",e+".mask",t.commandStr),[Ua[n],a,i]},function(e,t,r){var n=e.constants.compareFuncs;return F.optional(function(){function a(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}a(r+"&&typeof ",r,'==="object"'),a('!("cmp" in ',r,")||(",r,".cmp in ",n,")")}),[t.def('"cmp" in ',r,"?",n,"[",r,".cmp]",":",Ba),t.def(r,".ref|0"),t.def('"mask" in ',r,"?",r,".mask|0:-1")]});case jn:case On:return f(function(r){F.commandType(r,"object",o,t.commandStr);var n=r.fail||"keep",a=r.zfail||"keep",i=r.zpass||"keep";return F.commandParameter(n,Na,e+".fail",t.commandStr),F.commandParameter(a,Na,e+".zfail",t.commandStr),F.commandParameter(i,Na,e+".zpass",t.commandStr),[e===On?Da:Ta,Na[n],Na[a],Na[i]]},function(t,r,n){var a=t.constants.stencilOps;F.optional(function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+e)});function i(i){return F.optional(function(){t.assert(r,'!("'+i+'" in '+n+")||("+n+"."+i+" in "+a+")","invalid "+e+"."+i+", must be one of "+Object.keys(Na))}),r.def('"',i,'" in ',n,"?",a,"[",n,".",i,"]:",Ba)}return[e===On?Da:Ta,i("fail"),i("zfail"),i("zpass")]});case kn:return f(function(e){F.commandType(e,"object",o,t.commandStr);var r=0|e.factor,n=0|e.units;return F.commandType(r,"number",o+".factor",t.commandStr),F.commandType(n,"number",o+".units",t.commandStr),[r,n]},function(t,r,n){return F.optional(function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+e)}),[r.def(n,".factor|0"),r.def(n,".units|0")]});case vn:return f(function(e){var r=0;return"front"===e?r=Ta:"back"===e&&(r=Da),F.command(!!r,o,t.commandStr),r},function(e,t,r){return F.optional(function(){e.assert(t,r+'==="front"||'+r+'==="back"',"invalid cull.face")}),t.def(r,'==="front"?',Ta,":",Da)});case xn:return f(function(e){return F.command("number"==typeof e&&e>=a.lineWidthDims[0]&&e<=a.lineWidthDims[1],"invalid line width, must positive number between "+a.lineWidthDims[0]+" and "+a.lineWidthDims[1],t.commandStr),e},function(e,t,r){return F.optional(function(){e.assert(t,"typeof "+r+'==="number"&&'+r+">="+a.lineWidthDims[0]+"&&"+r+"<="+a.lineWidthDims[1],"invalid line width")}),r});case yn:return f(function(e){return F.commandParameter(e,Qa,o,t.commandStr),Qa[e]},function(e,t,r){return F.optional(function(){e.assert(t,r+'==="cw"||'+r+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),t.def(r+'==="cw"?'+ja+":"+Oa)});case bn:return f(function(e){return F.command(Me(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map(function(e){return!!e})},function(e,t,r){return F.optional(function(){e.assert(t,e.shared.isArrayLike+"("+r+")&&"+r+".length===4","invalid color.mask")}),Y(4,function(e){return"!!"+r+"["+e+"]"})});case _n:return f(function(e){F.command("object"==typeof e&&e,o,t.commandStr);var r="value"in e?e.value:1,n=!!e.invert;return F.command("number"==typeof r&&r>=0&&r<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[r,n]},function(e,t,r){return F.optional(function(){e.assert(t,r+"&&typeof "+r+'==="object"',"invalid sample.coverage")}),[t.def('"value" in ',r,"?+",r,".value:1"),t.def("!!",r,".invert")]})}}),i}(e,s),x=function(e){var r=e.static,n=e.dynamic;function a(e){if(e in r){var a=t.id(r[e]);F.optional(function(){l.shader(qa[e],a,F.guessCommand())});var i=Ka(function(){return a});return i.id=a,i}if(e in n){var o=n[e];return Ja(o,function(t,r){var n=t.invoke(r,o),a=r.def(t.shared.strings,".id(",n,")");return F.optional(function(){r(t.shared.shader,".shader(",qa[e],",",a,",",t.command,");")}),a})}return null}var i,o=a(Ln),f=a(Rn),u=null;return $a(o)&&$a(f)?(u=l.program(f.id,o.id),i=Ka(function(e,t){return e.link(u)})):i=new Xa(o&&o.thisDep||f&&f.thisDep,o&&o.contextDep||f&&f.contextDep,o&&o.propDep||f&&f.propDep,function(e,t){var r,n=e.shared.shader;r=o?o.append(e,t):t.def(n,".",Ln);var a=n+".program("+(f?f.append(e,t):t.def(n,".",Rn))+","+r;return F.optional(function(){a+=","+e.command}),t.def(a+")")}),{frag:o,vert:f,progVar:i,program:u}}(e);function w(e){var t=p[e];t&&(y[e]=t)}w(zn),w(_(Fn));var A=Object.keys(y).length>0,S={framebuffer:m,draw:h,shader:x,state:y,dirty:A};return S.profile=function(e){var t,r=e.static,n=e.dynamic;if(Bn in r){var a=!!r[Bn];(t=Ka(function(e,t){return a})).enable=a}else if(Bn in n){var i=n[Bn];t=Ja(i,function(e,t){return e.invoke(t,i)})}return t}(e),S.uniforms=function(e,t){var r=e.static,n=e.dynamic,a={};return Object.keys(r).forEach(function(e){var n,i=r[e];if("number"==typeof i||"boolean"==typeof i)n=Ka(function(){return i});else if("function"==typeof i){var o=i._reglType;"texture2d"===o||"textureCube"===o?n=Ka(function(e){return e.link(i)}):"framebuffer"===o||"framebufferCube"===o?(F.command(i.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),n=Ka(function(e){return e.link(i.color[0])})):F.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else Me(i)?n=Ka(function(t){return t.global.def("[",Y(i.length,function(r){return F.command("number"==typeof i[r]||"boolean"==typeof i[r],"invalid uniform "+e,t.commandStr),i[r]}),"]")}):F.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);n.value=i,a[e]=n}),Object.keys(n).forEach(function(e){var t=n[e];a[e]=Ja(t,function(e,r){return e.invoke(r,t)})}),a}(n,s),S.attributes=function(e,r){var n=e.static,a=e.dynamic,o={};return Object.keys(n).forEach(function(e){var a=n[e],f=t.id(e),u=new b;if(Va(a))u.state=Zr,u.buffer=i.getBuffer(i.create(a,$n,!1,!0)),u.type=0;else{var s=i.getBuffer(a);if(s)u.state=Zr,u.buffer=s,u.type=0;else if(F.command("object"==typeof a&&a,"invalid data for attribute "+e,r.commandStr),a.constant){var c=a.constant;u.buffer="null",u.state=en,"number"==typeof c?u.x=c:(F.command(Me(c)&&c.length>0&&c.length<=4,"invalid constant for attribute "+e,r.commandStr),Kr.forEach(function(e,t){t<c.length&&(u[e]=c[t])}))}else{s=Va(a.buffer)?i.getBuffer(i.create(a.buffer,$n,!1,!0)):i.getBuffer(a.buffer),F.command(!!s,'missing buffer for attribute "'+e+'"',r.commandStr);var l=0|a.offset;F.command(l>=0,'invalid offset for attribute "'+e+'"',r.commandStr);var d=0|a.stride;F.command(d>=0&&d<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',r.commandStr);var m=0|a.size;F.command(!("size"in a)||m>0&&m<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',r.commandStr);var p=!!a.normalized,h=0;"type"in a&&(F.commandParameter(a.type,ce,"invalid type for attribute "+e,r.commandStr),h=ce[a.type]);var g=0|a.divisor;"divisor"in a&&(F.command(0===g||v,'cannot specify divisor for attribute "'+e+'", instancing not supported',r.commandStr),F.command(g>=0,'invalid divisor for attribute "'+e+'"',r.commandStr)),F.optional(function(){var t=r.commandStr,n=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(a).forEach(function(r){F.command(n.indexOf(r)>=0,'unknown parameter "'+r+'" for attribute pointer "'+e+'" (valid parameters are '+n+")",t)})}),u.buffer=s,u.state=Zr,u.size=m,u.normalized=p,u.type=h||s.dtype,u.offset=l,u.stride=d,u.divisor=g}}o[e]=Ka(function(e,t){var r=e.attribCache;if(f in r)return r[f];var n={isStream:!1};return Object.keys(u).forEach(function(e){n[e]=u[e]}),u.buffer&&(n.buffer=e.link(u.buffer),n.type=n.type||n.buffer+".dtype"),r[f]=n,n})}),Object.keys(a).forEach(function(e){var t=a[e];o[e]=Ja(t,function(r,n){var a=r.invoke(n,t),i=r.shared,o=i.isBufferArgs,f=i.buffer;F.optional(function(){r.assert(n,a+"&&(typeof "+a+'==="object"||typeof '+a+'==="function")&&('+o+"("+a+")||"+f+".getBuffer("+a+")||"+f+".getBuffer("+a+".buffer)||"+o+"("+a+'.buffer)||("constant" in '+a+"&&(typeof "+a+'.constant==="number"||'+i.isArrayLike+"("+a+".constant))))",'invalid dynamic attribute "'+e+'"')});var u={isStream:n.def(!1)},s=new b;s.state=Zr,Object.keys(s).forEach(function(e){u[e]=n.def(""+s[e])});var c=u.buffer,l=u.type;n("if(",o,"(",a,")){",u.isStream,"=true;",c,"=",f,".createStream(",$n,",",a,");",l,"=",c,".dtype;","}else{",c,"=",f,".getBuffer(",a,");","if(",c,"){",l,"=",c,".dtype;",'}else if("constant" in ',a,"){",u.state,"=",en,";","if(typeof "+a+'.constant === "number"){',u[Kr[0]],"=",a,".constant;",Kr.slice(1).map(function(e){return u[e]}).join("="),"=0;","}else{",Kr.map(function(e,t){return u[e]+"="+a+".constant.length>="+t+"?"+a+".constant["+t+"]:0;"}).join(""),"}}else{","if(",o,"(",a,".buffer)){",c,"=",f,".createStream(",$n,",",a,".buffer);","}else{",c,"=",f,".getBuffer(",a,".buffer);","}",l,'="type" in ',a,"?",i.glTypes,"[",a,".type]:",c,".dtype;",u.normalized,"=!!",a,".normalized;");function d(e){n(u[e],"=",a,".",e,"|0;")}return d("size"),d("offset"),d("stride"),d("divisor"),n("}}"),n.exit("if(",u.isStream,"){",f,".destroyStream(",c,");","}"),u})}),o}(r,s),S.context=function(e){var t=e.static,r=e.dynamic,n={};return Object.keys(t).forEach(function(e){var r=t[e];n[e]=Ka(function(e,t){return"number"==typeof r||"boolean"==typeof r?""+r:e.link(r)})}),Object.keys(r).forEach(function(e){var t=r[e];n[e]=Ja(t,function(e,r){return e.invoke(r,t)})}),n}(f),S}function B(e,t,r){var n=e.shared.context,a=e.scope();Object.keys(r).forEach(function(i){t.save(n,"."+i);var o=r[i];a(n,".",i,"=",o.append(e,t),";")}),t(a)}function P(e,t,r,n){var a,i=e.shared,o=i.gl,f=i.framebuffer;y&&(a=t.def(i.extensions,".webgl_draw_buffers"));var u,s=e.constants,c=s.drawBuffer,l=s.backBuffer;u=r?r.append(e,t):t.def(f,".next"),n||t("if(",u,"!==",f,".cur){"),t("if(",u,"){",o,".bindFramebuffer(",Ma,",",u,".framebuffer);"),y&&t(a,".drawBuffersWEBGL(",c,"[",u,".colorAttachments.length]);"),t("}else{",o,".bindFramebuffer(",Ma,",null);"),y&&t(a,".drawBuffersWEBGL(",l,");"),t("}",f,".cur=",u,";"),n||t("}")}function R(e,t,r){var n=e.shared,a=n.gl,i=e.current,o=e.next,f=n.current,u=n.next,s=e.cond(f,".dirty");k.forEach(function(t){var n=_(t);if(!(n in r.state)){var c,l;if(n in o){c=o[n],l=i[n];var d=Y(x[n].length,function(e){return s.def(c,"[",e,"]")});s(e.cond(d.map(function(e,t){return e+"!=="+l+"["+t+"]"}).join("||")).then(a,".",S[n],"(",d,");",d.map(function(e,t){return l+"["+t+"]="+e}).join(";"),";"))}else{c=s.def(u,".",n);var m=e.cond(c,"!==",f,".",n);s(m),n in A?m(e.cond(c).then(a,".enable(",A[n],");").else(a,".disable(",A[n],");"),f,".",n,"=",c,";"):m(a,".",S[n],"(",c,");",f,".",n,"=",c,";")}}}),0===Object.keys(r.state).length&&s(f,".dirty=false;"),t(s)}function L(e,t,r,n){var a=e.shared,i=e.current,o=a.current,f=a.gl;Ya(Object.keys(r)).forEach(function(a){var u=r[a];if(!n||n(u)){var s=u.append(e,t);if(A[a]){var c=A[a];$a(u)?t(f,s?".enable(":".disable(",c,");"):t(e.cond(s).then(f,".enable(",c,");").else(f,".disable(",c,");")),t(o,".",a,"=",s,";")}else if(Me(s)){var l=i[a];t(f,".",S[a],"(",s,");",s.map(function(e,t){return l+"["+t+"]="+e}).join(";"),";")}else t(f,".",S[a],"(",s,");",o,".",a,"=",s,";")}})}function I(e,t){v&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function W(e,t,r,n,a){var i=e.shared,o=e.stats,f=i.current,u=i.timer,s=r.profile;function c(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}var l,d;function m(e){e(l=t.def(),"=",c(),";"),"string"==typeof a?e(o,".count+=",a,";"):e(o,".count++;"),p&&(n?e(d=t.def(),"=",u,".getNumPendingQueries();"):e(u,".beginQuery(",o,");"))}function h(e){e(o,".cpuTime+=",c(),"-",l,";"),p&&(n?e(u,".pushScopeStats(",d,",",u,".getNumPendingQueries(),",o,");"):e(u,".endQuery();"))}function b(e){var r=t.def(f,".profile");t(f,".profile=",e,";"),t.exit(f,".profile=",r,";")}var g;if(s){if($a(s))return void(s.enable?(m(t),h(t.exit),b("true")):b("false"));b(g=s.append(e,t))}else g=t.def(f,".profile");var v=e.block();m(v),t("if(",g,"){",v,"}");var y=e.block();h(y),t.exit("if(",g,"){",y,"}")}function H(e,t,r,n,a){var i=e.shared;n.forEach(function(n){var o,f=n.name,u=r.attributes[f];if(u){if(!a(u))return;o=u.append(e,t)}else{if(!a(Za))return;var s=e.scopeAttrib(f);F.optional(function(){e.assert(t,s+".state","missing attribute "+f)}),o={},Object.keys(new b).forEach(function(e){o[e]=t.def(s,".",e)})}!function(r,n,a){var o=i.gl,f=t.def(r,".location"),u=t.def(i.attributes,"[",f,"]"),s=a.state,c=a.buffer,l=[a.x,a.y,a.z,a.w],d=["buffer","normalized","offset","stride"];function m(){t("if(!",u,".buffer){",o,".enableVertexAttribArray(",f,");}");var r,i=a.type;if(r=a.size?t.def(a.size,"||",n):n,t("if(",u,".type!==",i,"||",u,".size!==",r,"||",d.map(function(e){return u+"."+e+"!=="+a[e]}).join("||"),"){",o,".bindBuffer(",$n,",",c,".buffer);",o,".vertexAttribPointer(",[f,r,i,a.normalized,a.stride,a.offset],");",u,".type=",i,";",u,".size=",r,";",d.map(function(e){return u+"."+e+"="+a[e]+";"}).join(""),"}"),v){var s=a.divisor;t("if(",u,".divisor!==",s,"){",e.instancing,".vertexAttribDivisorANGLE(",[f,s],");",u,".divisor=",s,";}")}}function p(){t("if(",u,".buffer){",o,".disableVertexAttribArray(",f,");","}if(",Kr.map(function(e,t){return u+"."+e+"!=="+l[t]}).join("||"),"){",o,".vertexAttrib4f(",f,",",l,");",Kr.map(function(e,t){return u+"."+e+"="+l[t]+";"}).join(""),"}")}s===Zr?m():s===en?p():(t("if(",s,"===",Zr,"){"),m(),t("}else{"),p(),t("}"))}(e.link(n),function(e){switch(e){case ca:case pa:case va:return 2;case la:case ha:case ya:return 3;case da:case ba:case xa:return 4;default:return 1}}(n.info.type),o)})}function G(e,r,n,a,i){for(var o,f=e.shared,u=f.gl,s=0;s<a.length;++s){var c,l=a[s],d=l.name,m=l.info.type,p=n.uniforms[d],h=e.link(l)+".location";if(p){if(!i(p))continue;if($a(p)){var b=p.value;if(F.command(null!==b&&void 0!==b,'missing uniform "'+d+'"',e.commandStr),m===Sa||m===_a){F.command("function"==typeof b&&(m===Sa&&("texture2d"===b._reglType||"framebuffer"===b._reglType)||m===_a&&("textureCube"===b._reglType||"framebufferCube"===b._reglType)),"invalid texture for uniform "+d,e.commandStr);var g=e.link(b._texture||b.color[0]._texture);r(u,".uniform1i(",h,",",g+".bind());"),r.exit(g,".unbind();")}else if(m===wa||m===ka||m===Aa){F.optional(function(){F.command(Me(b),"invalid matrix for uniform "+d,e.commandStr),F.command(m===wa&&4===b.length||m===ka&&9===b.length||m===Aa&&16===b.length,"invalid length for matrix uniform "+d,e.commandStr)});var v=e.global.def("new Float32Array(["+Array.prototype.slice.call(b)+"])"),y=2;m===ka?y=3:m===Aa&&(y=4),r(u,".uniformMatrix",y,"fv(",h,",false,",v,");")}else{switch(m){case sa:F.commandType(b,"number","uniform "+d,e.commandStr),o="1f";break;case ca:F.command(Me(b)&&2===b.length,"uniform "+d,e.commandStr),o="2f";break;case la:F.command(Me(b)&&3===b.length,"uniform "+d,e.commandStr),o="3f";break;case da:F.command(Me(b)&&4===b.length,"uniform "+d,e.commandStr),o="4f";break;case ga:F.commandType(b,"boolean","uniform "+d,e.commandStr),o="1i";break;case ma:F.commandType(b,"number","uniform "+d,e.commandStr),o="1i";break;case va:case pa:F.command(Me(b)&&2===b.length,"uniform "+d,e.commandStr),o="2i";break;case ya:case ha:F.command(Me(b)&&3===b.length,"uniform "+d,e.commandStr),o="3i";break;case xa:case ba:F.command(Me(b)&&4===b.length,"uniform "+d,e.commandStr),o="4i"}r(u,".uniform",o,"(",h,",",Me(b)?Array.prototype.slice.call(b):b,");")}continue}c=p.append(e,r)}else{if(!i(Za))continue;c=r.def(f.uniforms,"[",t.id(d),"]")}m===Sa?r("if(",c,"&&",c,'._reglType==="framebuffer"){',c,"=",c,".color[0];","}"):m===_a&&r("if(",c,"&&",c,'._reglType==="framebufferCube"){',c,"=",c,".color[0];","}"),F.optional(function(){function t(t,n){e.assert(r,t,'bad data or missing for uniform "'+d+'".  '+n)}function n(e){t("typeof "+c+'==="'+e+'"',"invalid type, expected "+e)}function a(r,n){t(f.isArrayLike+"("+c+")&&"+c+".length==="+r,"invalid vector, should have length "+r,e.commandStr)}function i(r){t("typeof "+c+'==="function"&&'+c+'._reglType==="texture'+(r===Jn?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(m){case ma:n("number");break;case pa:a(2);break;case ha:a(3);break;case ba:a(4);break;case sa:n("number");break;case ca:a(2);break;case la:a(3);break;case da:a(4);break;case ga:n("boolean");break;case va:a(2);break;case ya:a(3);break;case xa:case wa:a(4);break;case ka:a(9);break;case Aa:a(16);break;case Sa:i(Jn);break;case _a:i(Zn)}});var x=1;switch(m){case Sa:case _a:var w=r.def(c,"._texture");r(u,".uniform1i(",h,",",w,".bind());"),r.exit(w,".unbind();");continue;case ma:case ga:o="1i";break;case pa:case va:o="2i",x=2;break;case ha:case ya:o="3i",x=3;break;case ba:case xa:o="4i",x=4;break;case sa:o="1f";break;case ca:o="2f",x=2;break;case la:o="3f",x=3;break;case da:o="4f",x=4;break;case wa:o="Matrix2fv";break;case ka:o="Matrix3fv";break;case Aa:o="Matrix4fv"}if(r(u,".uniform",o,"(",h,","),"M"===o.charAt(0)){var k=Math.pow(m-wa+2,2),A=e.global.def("new Float32Array(",k,")");r("false,(Array.isArray(",c,")||",c," instanceof Float32Array)?",c,":(",Y(k,function(e){return A+"["+e+"]="+c+"["+e+"]"}),",",A,")")}else r(x>1?Y(x,function(e){return c+"["+e+"]"}):c);r(");")}}function U(e,t,r,n){var a=e.shared,i=a.gl,o=a.draw,f=n.draw;var u=function(){var a,u=f.elements,s=t;return u?((u.contextDep&&n.contextDynamic||u.propDep)&&(s=r),a=u.append(e,s)):a=s.def(o,".",In),a&&s("if("+a+")"+i+".bindBuffer("+Kn+","+a+".buffer.buffer);"),a}();function s(a){var i=f[a];return i?i.contextDep&&n.contextDynamic||i.propDep?i.append(e,r):i.append(e,t):t.def(o,".",a)}var c=s(Mn),l=s(Hn),d=function(){var a,i=f.count,u=t;return i?((i.contextDep&&n.contextDynamic||i.propDep)&&(u=r),a=i.append(e,u),F.optional(function(){i.MISSING&&e.assert(t,"false","missing vertex count"),i.DYNAMIC&&e.assert(u,a+">=0","missing vertex count")})):(a=u.def(o,".",Wn),F.optional(function(){e.assert(u,a+">=0","missing vertex count")})),a}();if("number"==typeof d){if(0===d)return}else r("if(",d,"){"),r.exit("}");var m,p;v&&(m=s(Gn),p=e.instancing);var h=u+".type",b=f.elements&&$a(f.elements);function g(){function e(){r(p,".drawElementsInstancedANGLE(",[c,d,h,l+"<<(("+h+"-"+Jr+")>>1)",m],");")}function t(){r(p,".drawArraysInstancedANGLE(",[c,l,d,m],");")}u?b?e():(r("if(",u,"){"),e(),r("}else{"),t(),r("}")):t()}function y(){function e(){r(i+".drawElements("+[c,d,h,l+"<<(("+h+"-"+Jr+")>>1)"]+");")}function t(){r(i+".drawArrays("+[c,l,d]+");")}u?b?e():(r("if(",u,"){"),e(),r("}else{"),t(),r("}")):t()}v&&("number"!=typeof m||m>=0)?"string"==typeof m?(r("if(",m,">0){"),g(),r("}else if(",m,"<0){"),y(),r("}")):g():y()}function N(e,t,r,n,a){var i=C(),o=i.proc("body",a);return F.optional(function(){i.commandStr=t.commandStr,i.command=i.link(t.commandStr)}),v&&(i.instancing=o.def(i.shared.extensions,".angle_instanced_arrays")),e(i,o,r,n),i.compile().body}function q(e,t,r,n){I(e,t),H(e,t,r,n.attributes,function(){return!0}),G(e,t,r,n.uniforms,function(){return!0}),U(e,t,t,r)}function Q(e,t,r,n){e.batchId="a1",I(e,t);function a(){return!0}H(e,t,r,n.attributes,a),G(e,t,r,n.uniforms,a),U(e,t,t,r)}function V(e,t,r,n){I(e,t);var a=r.contextDep,i=t.def(),o=t.def();e.shared.props=o,e.batchId=i;var f=e.scope(),u=e.scope();t(f.entry,"for(",i,"=0;",i,"<","a1",";++",i,"){",o,"=","a0","[",i,"];",u,"}",f.exit);function s(e){return e.contextDep&&a||e.propDep}function c(e){return!s(e)}if(r.needsContext&&B(e,u,r.context),r.needsFramebuffer&&P(e,u,r.framebuffer),L(e,u,r.state,s),r.profile&&s(r.profile)&&W(e,u,r,!1,!0),n)H(e,f,r,n.attributes,c),H(e,u,r,n.attributes,s),G(e,f,r,n.uniforms,c),G(e,u,r,n.uniforms,s),U(e,f,u,r);else{var l=e.global.def("{}"),d=r.shader.progVar.append(e,u),m=u.def(d,".id"),p=u.def(l,"[",m,"]");u(e.shared.gl,".useProgram(",d,".program);","if(!",p,"){",p,"=",l,"[",m,"]=",e.link(function(t){return N(Q,e,r,t,2)}),"(",d,");}",p,".call(this,a0[",i,"],",i,");")}}function X(e,t,r){var n=t.static[r];if(n&&function(e){if("object"==typeof e&&!Me(e)){for(var t=Object.keys(e),r=0;r<t.length;++r)if(M.isDynamic(e[t[r]]))return!0;return!1}}(n)){var a=e.global,i=Object.keys(n),o=!1,f=!1,u=!1,s=e.global.def("{}");i.forEach(function(t){var r=n[t];if(M.isDynamic(r)){"function"==typeof r&&(r=n[t]=M.unbox(r));var i=Ja(r,null);o=o||i.thisDep,u=u||i.propDep,f=f||i.contextDep}else{switch(a(s,".",t,"="),typeof r){case"number":a(r);break;case"string":a('"',r,'"');break;case"object":Array.isArray(r)&&a("[",r.join(),"]");break;default:a(e.link(r))}a(";")}}),t.dynamic[r]=new M.DynamicVariable(on,{thisDep:o,contextDep:f,propDep:u,ref:s,append:function(e,t){i.forEach(function(r){var a=n[r];if(M.isDynamic(a)){var i=e.invoke(t,a);t(s,".",r,"=",i,";")}})}}),delete t.static[r]}}return{next:w,current:x,procs:function(){var t=C(),r=t.proc("poll"),n=t.proc("refresh"),i=t.block();r(i),n(i);var o=t.shared,f=o.gl,u=o.next,s=o.current;i(s,".dirty=false;"),P(t,r),P(t,n,null,!0);var c,l=e.getExtension("angle_instanced_arrays");l&&(c=t.link(l));for(var d=0;d<a.maxAttributes;++d){var m=n.def(o.attributes,"[",d,"]"),p=t.cond(m,".buffer");p.then(f,".enableVertexAttribArray(",d,");",f,".bindBuffer(",$n,",",m,".buffer.buffer);",f,".vertexAttribPointer(",d,",",m,".size,",m,".type,",m,".normalized,",m,".stride,",m,".offset);").else(f,".disableVertexAttribArray(",d,");",f,".vertexAttrib4f(",d,",",m,".x,",m,".y,",m,".z,",m,".w);",m,".buffer=null;"),n(p),l&&n(c,".vertexAttribDivisorANGLE(",d,",",m,".divisor);")}return Object.keys(A).forEach(function(e){var a=A[e],o=i.def(u,".",e),c=t.block();c("if(",o,"){",f,".enable(",a,")}else{",f,".disable(",a,")}",s,".",e,"=",o,";"),n(c),r("if(",o,"!==",s,".",e,"){",c,"}")}),Object.keys(S).forEach(function(e){var a,o,c=S[e],l=x[e],d=t.block();if(d(f,".",c,"("),Me(l)){var m=l.length;a=t.global.def(u,".",e),o=t.global.def(s,".",e),d(Y(m,function(e){return a+"["+e+"]"}),");",Y(m,function(e){return o+"["+e+"]="+a+"["+e+"];"}).join("")),r("if(",Y(m,function(e){return a+"["+e+"]!=="+o+"["+e+"]"}).join("||"),"){",d,"}")}else a=i.def(u,".",e),o=i.def(s,".",e),d(a,");",s,".",e,"=",a,";"),r("if(",a,"!==",o,"){",d,"}");n(d)}),t.compile()}(),compile:function(e,r,n,a,i){var o=C();o.stats=o.link(i),Object.keys(r.static).forEach(function(e){X(o,r,e)}),Xn.forEach(function(t){X(o,e,t)});var f=z(e,r,n,a,o);return function(e,t){var r=e.proc("draw",1);I(e,r),B(e,r,t.context),P(e,r,t.framebuffer),R(e,r,t),L(e,r,t.state),W(e,r,t,!1,!0);var n=t.shader.progVar.append(e,r);if(r(e.shared.gl,".useProgram(",n,".program);"),t.shader.program)q(e,r,t,t.shader.program);else{var a=e.global.def("{}"),i=r.def(n,".id"),o=r.def(a,"[",i,"]");r(e.cond(o).then(o,".call(this,a0);").else(o,"=",a,"[",i,"]=",e.link(function(r){return N(q,e,t,r,1)}),"(",n,");",o,".call(this,a0);"))}Object.keys(t.state).length>0&&r(e.shared.current,".dirty=true;")}(o,f),function(e,r){var n=e.proc("scope",3);e.batchId="a2";var a=e.shared,i=a.current;B(e,n,r.context),r.framebuffer&&r.framebuffer.append(e,n),Ya(Object.keys(r.state)).forEach(function(t){var i=r.state[t].append(e,n);Me(i)?i.forEach(function(r,a){n.set(e.next[t],"["+a+"]",r)}):n.set(a.next,"."+t,i)}),W(e,n,r,!0,!0),[In,Hn,Wn,Gn,Mn].forEach(function(t){var i=r.draw[t];i&&n.set(a.draw,"."+t,""+i.append(e,n))}),Object.keys(r.uniforms).forEach(function(i){n.set(a.uniforms,"["+t.id(i)+"]",r.uniforms[i].append(e,n))}),Object.keys(r.attributes).forEach(function(t){var a=r.attributes[t].append(e,n),i=e.scopeAttrib(t);Object.keys(new b).forEach(function(e){n.set(i,"."+e,a[e])})});function o(t){var i=r.shader[t];i&&n.set(a.shader,"."+t,i.append(e,n))}o(Rn),o(Ln),Object.keys(r.state).length>0&&(n(i,".dirty=true;"),n.exit(i,".dirty=true;")),n("a1(",e.shared.context,",a0,",e.batchId,");")}(o,f),function(e,t){var r=e.proc("batch",2);e.batchId="0",I(e,r);var n=!1,a=!0;Object.keys(t.context).forEach(function(e){n=n||t.context[e].propDep}),n||(B(e,r,t.context),a=!1);var i=t.framebuffer,o=!1;i?(i.propDep?n=o=!0:i.contextDep&&n&&(o=!0),o||P(e,r,i)):P(e,r,null),t.state.viewport&&t.state.viewport.propDep&&(n=!0);function f(e){return e.contextDep&&n||e.propDep}R(e,r,t),L(e,r,t.state,function(e){return!f(e)}),t.profile&&f(t.profile)||W(e,r,t,!1,"a1"),t.contextDep=n,t.needsContext=a,t.needsFramebuffer=o;var u=t.shader.progVar;if(u.contextDep&&n||u.propDep)V(e,r,t,null);else{var s=u.append(e,r);if(r(e.shared.gl,".useProgram(",s,".program);"),t.shader.program)V(e,r,t,t.shader.program);else{var c=e.global.def("{}"),l=r.def(s,".id"),d=r.def(c,"[",l,"]");r(e.cond(d).then(d,".call(this,a0,a1);").else(d,"=",c,"[",l,"]=",e.link(function(r){return N(V,e,t,r,2)}),"(",s,");",d,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&r(e.shared.current,".dirty=true;")}(o,f),o.compile()}}}var ti=34918,ri=34919,ni=35007,ai=function(e,t){var r=t.ext_disjoint_timer_query;if(!r)return null;var n=[];var a=[];var i=[];var o=[];function f(e,t,r){var n=i.pop()||new function(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null};n.startQueryIndex=e,n.endQueryIndex=t,n.sum=0,n.stats=r,o.push(n)}var u=[],s=[];return{beginQuery:function(e){var t=n.pop()||r.createQueryEXT();r.beginQueryEXT(ni,t),a.push(t),f(a.length-1,a.length,e)},endQuery:function(){r.endQueryEXT(ni)},pushScopeStats:f,update:function(){var e,t,f=a.length;if(0!==f){s.length=Math.max(s.length,f+1),u.length=Math.max(u.length,f+1),u[0]=0,s[0]=0;var c=0;for(e=0,t=0;t<a.length;++t){var l=a[t];r.getQueryObjectEXT(l,ri)?(c+=r.getQueryObjectEXT(l,ti),d=l,n.push(d)):a[e++]=l,u[t+1]=c,s[t+1]=e}var d;for(a.length=e,e=0,t=0;t<o.length;++t){var m=o[t],p=m.startQueryIndex,h=m.endQueryIndex;m.sum+=u[h]-u[p];var b=s[p],g=s[h];g===b?(m.stats.gpuTime+=m.sum/1e6,v=m,i.push(v)):(m.startQueryIndex=b,m.endQueryIndex=g,o[e++]=m)}var v;o.length=e}},getNumPendingQueries:function(){return a.length},clear:function(){n.push.apply(n,a);for(var e=0;e<n.length;e++)r.deleteQueryEXT(n[e]);a.length=0,n.length=0},restore:function(){a.length=0,n.length=0}}},ii=16384,oi=256,fi=1024,ui=34962,si="webglcontextlost",ci="webglcontextrestored",li=1,di=2,mi=3;function pi(e,t){for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}return function(e){var n=N(e);if(!n)return null;var a=n.gl,i=a.getContextAttributes(),o=a.isContextLost(),f=function(e,t){var r={};function n(t){F.type(t,"string","extension name must be string");var n,a=t.toLowerCase();try{n=r[a]=e.getExtension(a)}catch(e){}return!!n}for(var a=0;a<t.extensions.length;++a){var i=t.extensions[a];if(!n(i))return t.onDestroy(),t.onDone('"'+i+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(n),{extensions:r,restore:function(){Object.keys(r).forEach(function(e){if(!n(e))throw new Error("(regl): error restoring extension "+e)})}}}(a,n);if(!f)return null;var u=function(){var e={"":0},t=[""];return{id:function(r){var n=e[r];return n||(n=e[r]=t.length,t.push(r),n)},str:function(e){return t[e]}}}(),s={bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},c=f.extensions,l=ai(a,c),d=H(),m=a.drawingBufferWidth,p=a.drawingBufferHeight,h={tick:0,time:0,viewportWidth:m,viewportHeight:p,framebufferWidth:m,framebufferHeight:p,drawingBufferWidth:m,drawingBufferHeight:p,pixelRatio:n.pixelRatio},b=q(a,c),g=function(e,r,n){var a=0,i={};function o(t){this.id=a++,this.buffer=e.createBuffer(),this.type=t,this.usage=pe,this.byteLength=0,this.dimension=1,this.dtype=be,this.persistentData=null,n.profile&&(this.stats={size:0})}o.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},o.prototype.destroy=function(){c(this)};var f=[];function u(t,r,n){t.byteLength=r.byteLength,e.bufferData(t.type,r,n)}function s(e,r,n,a,i,o){var f;if(e.usage=n,Array.isArray(r)){if(e.dtype=a||ge,r.length>0){var s;if(Array.isArray(r[0])){f=me(r);for(var c=1,l=1;l<f.length;++l)c*=f[l];e.dimension=c,u(e,s=de(r,f,e.dtype),n),o?e.persistentData=s:oe.freeType(s)}else if("number"==typeof r[0]){e.dimension=i;var d=oe.allocType(e.dtype,r.length);xe(d,r),u(e,d,n),o?e.persistentData=d:oe.freeType(d)}else t(r[0])?(e.dimension=r[0].length,e.dtype=a||ye(r[0])||ge,u(e,s=de(r,[r.length,r[0].length],e.dtype),n),o?e.persistentData=s:oe.freeType(s)):F.raise("invalid buffer data")}}else if(t(r))e.dtype=a||ye(r),e.dimension=i,u(e,r,n),o&&(e.persistentData=new Uint8Array(new Uint8Array(r.buffer)));else if(Q(r)){f=r.shape;var m=r.stride,p=r.offset,h=0,b=0,g=0,v=0;1===f.length?(h=f[0],b=1,g=m[0],v=0):2===f.length?(h=f[0],b=f[1],g=m[0],v=m[1]):F.raise("invalid shape"),e.dtype=a||ye(r.data)||ge,e.dimension=b;var y=oe.allocType(e.dtype,h*b);we(y,r.data,h,b,g,v,p),u(e,y,n),o?e.persistentData=y:oe.freeType(y)}else F.raise("invalid buffer data")}function c(t){r.bufferCount--;var n=t.buffer;F(n,"buffer must not be deleted already"),e.deleteBuffer(n),t.buffer=null,delete i[t.id]}return n.profile&&(r.getTotalBufferSize=function(){var e=0;return Object.keys(i).forEach(function(t){e+=i[t].stats.size}),e}),{create:function(a,f,u,l){r.bufferCount++;var d=new o(f);i[d.id]=d;function m(r){var a=pe,i=null,o=0,f=0,u=1;return Array.isArray(r)||t(r)||Q(r)?i=r:"number"==typeof r?o=0|r:r&&(F.type(r,"object","buffer arguments must be an object, a number or an array"),"data"in r&&(F(null===i||Array.isArray(i)||t(i)||Q(i),"invalid data for buffer"),i=r.data),"usage"in r&&(F.parameter(r.usage,le,"invalid buffer usage"),a=le[r.usage]),"type"in r&&(F.parameter(r.type,ce,"invalid buffer type"),f=ce[r.type]),"dimension"in r&&(F.type(r.dimension,"number","invalid dimension"),u=0|r.dimension),"length"in r&&(F.nni(o,"buffer length must be a nonnegative integer"),o=0|r.length)),d.bind(),i?s(d,i,a,f,u,l):(e.bufferData(d.type,o,a),d.dtype=f||be,d.usage=a,d.dimension=u,d.byteLength=o),n.profile&&(d.stats.size=d.byteLength*ve[d.dtype]),m}function p(t,r){F(r+t.byteLength<=d.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+t.byteLength+" starting from offset "+r+" to a buffer of size "+d.byteLength),e.bufferSubData(d.type,r,t)}return u||m(a),m._reglType="buffer",m._buffer=d,m.subdata=function(e,r){var n,a=0|(r||0);if(d.bind(),Array.isArray(e)){if(e.length>0)if("number"==typeof e[0]){var i=oe.allocType(d.dtype,e.length);xe(i,e),p(i,a),oe.freeType(i)}else if(Array.isArray(e[0])||t(e[0])){n=me(e);var o=de(e,n,d.dtype);p(o,a),oe.freeType(o)}else F.raise("invalid buffer data")}else if(t(e))p(e,a);else if(Q(e)){n=e.shape;var f=e.stride,u=0,s=0,c=0,l=0;1===n.length?(u=n[0],s=1,c=f[0],l=0):2===n.length?(u=n[0],s=n[1],c=f[0],l=f[1]):F.raise("invalid shape");var h=Array.isArray(e.data)?d.dtype:ye(e.data),b=oe.allocType(h,u*s);we(b,e.data,u,s,c,l,e.offset),p(b,a),oe.freeType(b)}else F.raise("invalid data for buffer subdata");return m},n.profile&&(m.stats=d.stats),m.destroy=function(){c(d)},m},createStream:function(e,t){var r=f.pop();return r||(r=new o(e)),r.bind(),s(r,t,he,0,1,!1),r},destroyStream:function(e){f.push(e)},clear:function(){V(i).forEach(c),f.forEach(c)},getBuffer:function(e){return e&&e._buffer instanceof o?e._buffer:null},restore:function(){V(i).forEach(function(t){t.buffer=e.createBuffer(),e.bindBuffer(t.type,t.buffer),e.bufferData(t.type,t.persistentData||t.byteLength,t.usage)})},_initBuffer:s}}(a,s,n),v=function(e,r,n,a){var i={},o=0,f={uint8:Te,uint16:je};r.oes_element_index_uint&&(f.uint32=Ce);function u(e){this.id=o++,i[this.id]=this,this.buffer=e,this.primType=_e,this.vertCount=0,this.type=0}u.prototype.bind=function(){this.buffer.bind()};var s=[];function c(a,i,o,f,u,s,c){if(a.buffer.bind(),i){var l=c;c||t(i)&&(!Q(i)||t(i.data))||(l=r.oes_element_index_uint?Ce:je),n._initBuffer(a.buffer,i,o,l,3)}else e.bufferData(Fe,s,o),a.buffer.dtype=d||Te,a.buffer.usage=o,a.buffer.dimension=3,a.buffer.byteLength=s;var d=c;if(!c){switch(a.buffer.dtype){case Te:case Ee:d=Te;break;case je:case De:d=je;break;case Ce:case Oe:d=Ce;break;default:F.raise("unsupported type for element array")}a.buffer.dtype=d}a.type=d,F(d!==Ce||!!r.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var m=u;m<0&&(m=a.buffer.byteLength,d===je?m>>=1:d===Ce&&(m>>=2)),a.vertCount=m;var p=f;if(f<0){p=_e;var h=a.buffer.dimension;1===h&&(p=Ae),2===h&&(p=Se),3===h&&(p=_e)}a.primType=p}function l(e){a.elementsCount--,F(null!==e.buffer,"must not double destroy elements"),delete i[e.id],e.buffer.destroy(),e.buffer=null}return{create:function(e,r){var i=n.create(null,Fe,!0),o=new u(i._buffer);a.elementsCount++;function s(e){if(e)if("number"==typeof e)i(e),o.primType=_e,o.vertCount=0|e,o.type=Te;else{var r=null,n=Be,a=-1,u=-1,l=0,d=0;Array.isArray(e)||t(e)||Q(e)?r=e:(F.type(e,"object","invalid arguments for elements"),"data"in e&&(r=e.data,F(Array.isArray(r)||t(r)||Q(r),"invalid data for element buffer")),"usage"in e&&(F.parameter(e.usage,le,"invalid element buffer usage"),n=le[e.usage]),"primitive"in e&&(F.parameter(e.primitive,ke,"invalid element buffer primitive"),a=ke[e.primitive]),"count"in e&&(F("number"==typeof e.count&&e.count>=0,"invalid vertex count for elements"),u=0|e.count),"type"in e&&(F.parameter(e.type,f,"invalid buffer type"),d=f[e.type]),"length"in e?l=0|e.length:(l=u,d===je||d===De?l*=2:d!==Ce&&d!==Oe||(l*=4))),c(o,r,n,a,u,l,d)}else i(),o.primType=_e,o.vertCount=0,o.type=Te;return s}return s(e),s._reglType="elements",s._elements=o,s.subdata=function(e,t){return i.subdata(e,t),s},s.destroy=function(){l(o)},s},createStream:function(e){var t=s.pop();return t||(t=new u(n.create(null,Fe,!0,!1)._buffer)),c(t,e,ze,-1,-1,0,0),t},destroyStream:function(e){s.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof u?e._elements:null},clear:function(){V(i).forEach(l)}}}(a,c,g,s),y=function(e,t,r,n,a){for(var i=r.maxAttributes,o=new Array(i),f=0;f<i;++f)o[f]=new Ir;return{Record:Ir,scope:{},state:o}}(0,0,b),x=Ur(a,u,s,n),w=mr(a,c,b,function(){S.procs.poll()},h,s,n),k=vr(a,c,b,s,n),A=function(e,t,n,a,i,o){var f={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],s=["rgba4","rgb565","rgb5 a1"];t.ext_srgb&&s.push("srgba"),t.ext_color_buffer_half_float&&s.push("rgba16f","rgb16f"),t.webgl_color_buffer_float&&s.push("rgba32f");var c=["uint8"];t.oes_texture_half_float&&c.push("half float","float16"),t.oes_texture_float&&c.push("float","float32");function l(e,t,r){this.target=e,this.texture=t,this.renderbuffer=r;var n=0,a=0;t?(n=t.width,a=t.height):r&&(n=r.width,a=r.height),this.width=n,this.height=a}function d(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function m(e,t,r){if(e)if(e.texture){var n=e.texture._texture,a=Math.max(1,n.width),i=Math.max(1,n.height);F(a===t&&i===r,"inconsistent width/height for supplied texture"),n.refCount+=1}else{var o=e.renderbuffer._renderbuffer;F(o.width===t&&o.height===r,"inconsistent width/height for renderbuffer"),o.refCount+=1}}function p(t,r){r&&(r.texture?e.framebufferTexture2D(yr,t,r.target,r.texture._texture.texture,0):e.framebufferRenderbuffer(yr,t,xr,r.renderbuffer._renderbuffer.renderbuffer))}function h(e){var t=wr,r=null,n=null,a=e;"object"==typeof e&&(a=e.data,"target"in e&&(t=0|e.target)),F.type(a,"function","invalid attachment data");var i=a._reglType;return"texture2d"===i?(r=a,F(t===wr)):"textureCube"===i?(r=a,F(t>=kr&&t<kr+6,"invalid cube map target")):"renderbuffer"===i?(n=a,t=xr):F.raise("invalid regl object for attachment"),new l(t,r,n)}function b(e,t,r,n,o){if(r){var f=a.create2D({width:e,height:t,format:n,type:o});return f._texture.refCount=0,new l(wr,f,null)}var u=i.create({width:e,height:t,format:n});return u._renderbuffer.refCount=0,new l(xr,null,u)}function g(e){return e&&(e.texture||e.renderbuffer)}function v(e,t,r){e&&(e.texture?e.texture.resize(t,r):e.renderbuffer&&e.renderbuffer.resize(t,r))}var y=0,x={};function w(){this.id=y++,x[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function k(e){e.colorAttachments.forEach(d),d(e.depthAttachment),d(e.stencilAttachment),d(e.depthStencilAttachment)}function A(t){var r=t.framebuffer;F(r,"must not double destroy framebuffer"),e.deleteFramebuffer(r),t.framebuffer=null,o.framebufferCount--,delete x[t.id]}function S(t){var r;e.bindFramebuffer(yr,t.framebuffer);var a=t.colorAttachments;for(r=0;r<a.length;++r)p(Ar+r,a[r]);for(r=a.length;r<n.maxColorAttachments;++r)e.framebufferTexture2D(yr,Ar+r,wr,null,0);e.framebufferTexture2D(yr,Er,wr,null,0),e.framebufferTexture2D(yr,Sr,wr,null,0),e.framebufferTexture2D(yr,_r,wr,null,0),p(Sr,t.depthAttachment),p(_r,t.stencilAttachment),p(Er,t.depthStencilAttachment);var i=e.checkFramebufferStatus(yr);i!==Tr&&F.raise("framebuffer configuration not supported, status = "+Rr[i]),e.bindFramebuffer(yr,f.next),f.cur=f.next,e.getError()}function _(e,a){var i=new w;o.framebufferCount++;function l(e,r){var a;F(f.next!==i,"can not update framebuffer which is currently in use");var o=t.webgl_draw_buffers,d=0,p=0,v=!0,y=!0,x=null,w=!0,A="rgba",_="uint8",E=1,T=null,D=null,j=null,O=!1;if("number"==typeof e)d=0|e,p=0|r||d;else if(e){F.type(e,"object","invalid arguments for framebuffer");var C=e;if("shape"in C){var z=C.shape;F(Array.isArray(z)&&z.length>=2,"invalid shape for framebuffer"),d=z[0],p=z[1]}else"radius"in C&&(d=p=C.radius),"width"in C&&(d=C.width),"height"in C&&(p=C.height);("color"in C||"colors"in C)&&(x=C.color||C.colors,Array.isArray(x)&&F(1===x.length||o,"multiple render targets not supported")),x||("colorCount"in C&&(E=0|C.colorCount,F(E>0,"invalid color buffer count")),"colorTexture"in C&&(w=!!C.colorTexture,A="rgba4"),"colorType"in C&&(_=C.colorType,w?(F(t.oes_texture_float||!("float"===_||"float32"===_),"you must enable OES_texture_float in order to use floating point framebuffer objects"),F(t.oes_texture_half_float||!("half float"===_||"float16"===_),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===_||"float16"===_?(F(t.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),A="rgba16f"):"float"!==_&&"float32"!==_||(F(t.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),A="rgba32f"),F.oneOf(_,c,"invalid color type")),"colorFormat"in C&&(A=C.colorFormat,u.indexOf(A)>=0?w=!0:s.indexOf(A)>=0?w=!1:w?F.oneOf(C.colorFormat,u,"invalid color format for texture"):F.oneOf(C.colorFormat,s,"invalid color format for renderbuffer"))),("depthTexture"in C||"depthStencilTexture"in C)&&(O=!(!C.depthTexture&&!C.depthStencilTexture),F(!O||t.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in C&&("boolean"==typeof C.depth?v=C.depth:(T=C.depth,y=!1)),"stencil"in C&&("boolean"==typeof C.stencil?y=C.stencil:(D=C.stencil,v=!1)),"depthStencil"in C&&("boolean"==typeof C.depthStencil?v=y=C.depthStencil:(j=C.depthStencil,v=!1,y=!1))}else d=p=1;var B=null,P=null,R=null,L=null;if(Array.isArray(x))B=x.map(h);else if(x)B=[h(x)];else for(B=new Array(E),a=0;a<E;++a)B[a]=b(d,p,w,A,_);F(t.webgl_draw_buffers||B.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),F(B.length<=n.maxColorAttachments,"too many color attachments, not supported"),d=d||B[0].width,p=p||B[0].height,T?P=h(T):v&&!y&&(P=b(d,p,O,"depth","uint32")),D?R=h(D):y&&!v&&(R=b(d,p,!1,"stencil","uint8")),j?L=h(j):!T&&!D&&y&&v&&(L=b(d,p,O,"depth stencil","depth stencil")),F(!!T+!!D+!!j<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var I=null;for(a=0;a<B.length;++a)if(m(B[a],d,p),F(!B[a]||B[a].texture&&jr.indexOf(B[a].texture._texture.format)>=0||B[a].renderbuffer&&Pr.indexOf(B[a].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+a+" is invalid"),B[a]&&B[a].texture){var M=Or[B[a].texture._texture.format]*Cr[B[a].texture._texture.type];null===I?I=M:F(I===M,"all color attachments much have the same number of bits per pixel.")}return m(P,d,p),F(!P||P.texture&&P.texture._texture.format===Dr||P.renderbuffer&&P.renderbuffer._renderbuffer.format===Fr,"invalid depth attachment for framebuffer object"),m(R,d,p),F(!R||R.renderbuffer&&R.renderbuffer._renderbuffer.format===zr,"invalid stencil attachment for framebuffer object"),m(L,d,p),F(!L||L.texture&&L.texture._texture.format===Br||L.renderbuffer&&L.renderbuffer._renderbuffer.format===Br,"invalid depth-stencil attachment for framebuffer object"),k(i),i.width=d,i.height=p,i.colorAttachments=B,i.depthAttachment=P,i.stencilAttachment=R,i.depthStencilAttachment=L,l.color=B.map(g),l.depth=g(P),l.stencil=g(R),l.depthStencil=g(L),l.width=i.width,l.height=i.height,S(i),l}return l(e,a),r(l,{resize:function(e,t){F(f.next!==i,"can not resize a framebuffer which is currently in use");var r=0|e,n=0|t||r;if(r===i.width&&n===i.height)return l;for(var a=i.colorAttachments,o=0;o<a.length;++o)v(a[o],r,n);return v(i.depthAttachment,r,n),v(i.stencilAttachment,r,n),v(i.depthStencilAttachment,r,n),i.width=l.width=r,i.height=l.height=n,S(i),l},_reglType:"framebuffer",_framebuffer:i,destroy:function(){A(i),k(i)},use:function(e){f.setFBO({framebuffer:l},e)}})}return r(f,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof w)return t}return null},create:_,createCube:function(e){var i=Array(6);function o(e){var n;F(i.indexOf(f.next)<0,"can not update framebuffer which is currently in use");var s=t.webgl_draw_buffers,l={color:null},d=0,m=null,p="rgba",h="uint8",b=1;if("number"==typeof e)d=0|e;else if(e){F.type(e,"object","invalid arguments for framebuffer");var g=e;if("shape"in g){var v=g.shape;F(Array.isArray(v)&&v.length>=2,"invalid shape for framebuffer"),F(v[0]===v[1],"cube framebuffer must be square"),d=v[0]}else"radius"in g&&(d=0|g.radius),"width"in g?(d=0|g.width,"height"in g&&F(g.height===d,"must be square")):"height"in g&&(d=0|g.height);("color"in g||"colors"in g)&&(m=g.color||g.colors,Array.isArray(m)&&F(1===m.length||s,"multiple render targets not supported")),m||("colorCount"in g&&(b=0|g.colorCount,F(b>0,"invalid color buffer count")),"colorType"in g&&(F.oneOf(g.colorType,c,"invalid color type"),h=g.colorType),"colorFormat"in g&&(p=g.colorFormat,F.oneOf(g.colorFormat,u,"invalid color format for texture"))),"depth"in g&&(l.depth=g.depth),"stencil"in g&&(l.stencil=g.stencil),"depthStencil"in g&&(l.depthStencil=g.depthStencil)}else d=1;var y;if(m)if(Array.isArray(m))for(y=[],n=0;n<m.length;++n)y[n]=m[n];else y=[m];else{y=Array(b);var x={radius:d,format:p,type:h};for(n=0;n<b;++n)y[n]=a.createCube(x)}for(l.color=Array(y.length),n=0;n<y.length;++n){var w=y[n];F("function"==typeof w&&"textureCube"===w._reglType,"invalid cube map"),d=d||w.width,F(w.width===d&&w.height===d,"invalid cube map shape"),l.color[n]={target:kr,data:y[n]}}for(n=0;n<6;++n){for(var k=0;k<y.length;++k)l.color[k].target=kr+n;n>0&&(l.depth=i[0].depth,l.stencil=i[0].stencil,l.depthStencil=i[0].depthStencil),i[n]?i[n](l):i[n]=_(l)}return r(o,{width:d,height:d,color:y})}return o(e),r(o,{faces:i,resize:function(e){var t,r=0|e;if(F(r>0&&r<=n.maxCubeMapSize,"invalid radius for cube fbo"),r===o.width)return o;var a=o.color;for(t=0;t<a.length;++t)a[t].resize(r);for(t=0;t<6;++t)i[t].resize(r);return o.width=o.height=r,o},_reglType:"framebufferCube",destroy:function(){i.forEach(function(e){e.destroy()})}})},clear:function(){V(x).forEach(A)},restore:function(){V(x).forEach(function(t){t.framebuffer=e.createFramebuffer(),S(t)})}})}(a,c,b,w,k,s),S=ei(a,u,c,b,g,v,0,A,{},y,x,{elements:null,primitive:4,count:-1,offset:0,instances:-1},h,l,n),_=Yr(a,A,S.procs.poll,h,i,c),E=S.next,T=a.canvas,D=[],j=[],O=[],C=[n.onDestroy],z=null;function B(){if(0===D.length)return l&&l.update(),void(z=null);z=W.next(B),K();for(var e=D.length-1;e>=0;--e){var t=D[e];t&&t(h,null,0)}a.flush(),l&&l.update()}function P(){!z&&D.length>0&&(z=W.next(B))}function R(){z&&(W.cancel(B),z=null)}function L(e){e.preventDefault(),o=!0,R(),j.forEach(function(e){e()})}function I(e){a.getError(),o=!1,f.restore(),x.restore(),g.restore(),w.restore(),k.restore(),A.restore(),l&&l.restore(),S.procs.refresh(),P(),O.forEach(function(e){e()})}T&&(T.addEventListener(si,L,!1),T.addEventListener(ci,I,!1));function G(e){F(!!e,"invalid args to regl({...})"),F.type(e,"object","invalid args to regl({...})");function t(e){var t={},r={};return Object.keys(e).forEach(function(n){var a=e[n];M.isDynamic(a)?r[n]=M.unbox(a,n):t[n]=a}),{dynamic:r,static:t}}var n=t(e.context||{}),a=t(e.uniforms||{}),i=t(e.attributes||{}),f=t(function(e){var t=r({},e);delete t.uniforms,delete t.attributes,delete t.context,"stencil"in t&&t.stencil.op&&(t.stencil.opBack=t.stencil.opFront=t.stencil.op,delete t.stencil.op);function n(e){if(e in t){var r=t[e];delete t[e],Object.keys(r).forEach(function(n){t[e+"."+n]=r[n]})}}return n("blend"),n("depth"),n("cull"),n("stencil"),n("polygonOffset"),n("scissor"),n("sample"),t}(e)),u={gpuTime:0,cpuTime:0,count:0},s=S.compile(f,i,a,n,u),c=s.draw,l=s.batch,d=s.scope,m=[];return r(function(e,t){var r;if(o&&F.raise("context lost"),"function"==typeof e)return d.call(this,null,e,0);if("function"==typeof t){if("number"==typeof e){for(r=0;r<e;++r)d.call(this,null,t,r);return}if(Array.isArray(e)){for(r=0;r<e.length;++r)d.call(this,e[r],t,r);return}return d.call(this,e,t,0)}if("number"==typeof e){if(e>0)return l.call(this,function(e){for(;m.length<e;)m.push(null);return m}(0|e),0|e)}else{if(!Array.isArray(e))return c.call(this,e);if(e.length)return l.call(this,e,e.length)}},{stats:u})}var U=A.setFBO=G({framebuffer:M.define.call(null,li,"framebuffer")});function Y(e,t){var r=0;S.procs.poll();var n=t.color;n&&(a.clearColor(+n[0]||0,+n[1]||0,+n[2]||0,+n[3]||0),r|=ii),"depth"in t&&(a.clearDepth(+t.depth),r|=oi),"stencil"in t&&(a.clearStencil(0|t.stencil),r|=fi),F(!!r,"called regl.clear with no buffer specified"),a.clear(r)}function X(e){return F.type(e,"function","regl.frame() callback must be a function"),D.push(e),P(),{cancel:function(){var t=pi(D,e);F(t>=0,"cannot cancel a frame twice");function r(){var e=pi(D,r);D[e]=D[D.length-1],D.length-=1,D.length<=0&&R()}D[t]=r}}}function $(){var e=E.viewport,t=E.scissor_box;e[0]=e[1]=t[0]=t[1]=0,h.viewportWidth=h.framebufferWidth=h.drawingBufferWidth=e[2]=t[2]=a.drawingBufferWidth,h.viewportHeight=h.framebufferHeight=h.drawingBufferHeight=e[3]=t[3]=a.drawingBufferHeight}function K(){h.tick+=1,h.time=Z(),$(),S.procs.poll()}function J(){$(),S.procs.refresh(),l&&l.update()}function Z(){return(H()-d)/1e3}J();var ee=r(G,{clear:function(e){if(F("object"==typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var t=0;t<6;++t)U(r({framebuffer:e.framebuffer.faces[t]},e),Y);else U(e,Y);else Y(0,e)},prop:M.define.bind(null,li),context:M.define.bind(null,di),this:M.define.bind(null,mi),draw:G({}),buffer:function(e){return g.create(e,ui,!1,!1)},elements:function(e){return v.create(e,!1)},texture:w.create2D,cube:w.createCube,renderbuffer:k.create,framebuffer:A.create,framebufferCube:A.createCube,attributes:i,frame:X,on:function(e,t){F.type(t,"function","listener callback must be a function");var r;switch(e){case"frame":return X(t);case"lost":r=j;break;case"restore":r=O;break;case"destroy":r=C;break;default:F.raise("invalid event, must be one of frame,lost,restore,destroy")}return r.push(t),{cancel:function(){for(var e=0;e<r.length;++e)if(r[e]===t)return r[e]=r[r.length-1],void r.pop()}}},limits:b,hasExtension:function(e){return b.extensions.indexOf(e.toLowerCase())>=0},read:_,destroy:function(){D.length=0,R(),T&&(T.removeEventListener(si,L),T.removeEventListener(ci,I)),x.clear(),A.clear(),k.clear(),w.clear(),v.clear(),g.clear(),l&&l.clear(),C.forEach(function(e){e()})},_gl:a,_refresh:J,poll:function(){K(),l&&l.update()},now:Z,stats:s});return n.onDone(null,ee),ee}});
},{}],25:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("./math");class t{constructor(e){this.gl=e,this.rectCapacity=1e3,this.rectCount=0,this.configSpaceOffsets=new Float32Array(2*this.rectCapacity),this.configSpaceSizes=new Float32Array(2*this.rectCapacity),this.colors=new Float32Array(3*this.rectCapacity),this.configSpaceOffsetBuffer=null,this.configSpaceSizeBuffer=null,this.colorBuffer=null}getRectCount(){return this.rectCount}getConfigSpaceOffsetBuffer(){return this.configSpaceOffsetBuffer||(this.configSpaceOffsetBuffer=this.gl.buffer(this.configSpaceOffsets)),this.configSpaceOffsetBuffer}getConfigSpaceSizeBuffer(){return this.configSpaceSizeBuffer||(this.configSpaceSizeBuffer=this.gl.buffer(this.configSpaceSizes)),this.configSpaceSizeBuffer}getColorBuffer(){return this.colorBuffer||(this.colorBuffer=this.gl.buffer(this.colors)),this.colorBuffer}uploadToGPU(){this.getConfigSpaceOffsetBuffer(),this.getConfigSpaceSizeBuffer(),this.getColorBuffer()}addRect(e,t){const i=this.rectCount++;if(i>=this.rectCapacity){this.rectCapacity*=2;const e=new Float32Array(2*this.rectCapacity),t=new Float32Array(2*this.rectCapacity),i=new Float32Array(3*this.rectCapacity);e.set(this.configSpaceOffsets),t.set(this.configSpaceSizes),i.set(this.colors),this.configSpaceOffsets=e,this.configSpaceSizes=t,this.colors=i}this.configSpaceOffsets[2*i]=e.origin.x,this.configSpaceOffsets[2*i+1]=e.origin.y,this.configSpaceSizes[2*i]=e.size.x,this.configSpaceSizes[2*i+1]=e.size.y,this.colors[3*i]=t.r,this.colors[3*i+1]=t.g,this.colors[3*i+2]=t.b}}exports.RectangleBatch=t;class i{constructor(t){this.command=t({vert:"\n      uniform mat3 configSpaceToNDC;\n\n      // Non-instanced\n      attribute vec2 corner;\n\n      // Instanced\n      attribute vec2 configSpaceOffset;\n      attribute vec2 configSpaceSize;\n      attribute vec3 color;\n      attribute float index;\n\n      varying vec3 vColor;\n\n      void main() {\n        vColor = color;\n        vec2 configSpacePos = configSpaceOffset + corner * configSpaceSize;\n        vec2 position = (configSpaceToNDC * vec3(configSpacePos, 1)).xy;\n        gl_Position = vec4(position, 1, 1);\n      }\n    ",depth:{enable:!1},frag:"\n      precision mediump float;\n      varying vec3 vColor;\n      varying float vParity;\n\n      void main() {\n        gl_FragColor = vec4(vColor.rgb, 1);\n      }\n    ",attributes:{corner:t.buffer([[0,0],[1,0],[0,1],[1,1]]),configSpaceOffset:(e,t)=>({buffer:t.batch.getConfigSpaceOffsetBuffer(),offset:0,stride:8,size:2,divisor:1}),configSpaceSize:(e,t)=>({buffer:t.batch.getConfigSpaceSizeBuffer(),offset:0,stride:8,size:2,divisor:1}),color:(e,t)=>({buffer:t.batch.getColorBuffer(),offset:0,stride:12,size:3,divisor:1})},uniforms:{configSpaceToNDC:(t,i)=>{const c=e.AffineTransform.betweenRects(i.configSpaceSrcRect,i.physicalSpaceDstRect),s=new e.Vec2(t.viewportWidth,t.viewportHeight);return e.AffineTransform.withTranslation(new e.Vec2(-1,1)).times(e.AffineTransform.withScale(new e.Vec2(2,-2).dividedByPointwise(s))).times(c).flatten()},parityOffset:(e,t)=>null==t.parityOffset?0:t.parityOffset,parityMin:(e,t)=>null==t.parityMin?0:1+t.parityMin},instances:(e,t)=>t.batch.getRectCount(),count:4,primitive:"triangle strip"})}render(e){this.command(e)}resetStats(){return Object.assign(this.command.stats,{cpuTime:0,gpuTime:0,count:0})}stats(){return this.command.stats}}exports.RectangleBatchRenderer=i;
},{"./math":29}],26:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class e{constructor(e){this.command=e({vert:"\n        attribute vec2 position;\n\n        void main() {\n          gl_Position = vec4(position, 0, 1);\n        }\n      ",frag:"\n        precision mediump float;\n\n        uniform mat3 configSpaceToPhysicalViewSpace;\n        uniform vec2 physicalSize;\n        uniform vec2 physicalOrigin;\n        uniform vec2 configSpaceViewportOrigin;\n        uniform vec2 configSpaceViewportSize;\n        uniform float framebufferHeight;\n\n        void main() {\n          vec2 origin = (configSpaceToPhysicalViewSpace * vec3(configSpaceViewportOrigin, 1.0)).xy;\n          vec2 size = (configSpaceToPhysicalViewSpace * vec3(configSpaceViewportSize, 0.0)).xy;\n\n          vec2 halfSize = physicalSize / 2.0;\n\n          float borderWidth = 2.0;\n\n          origin = floor(origin * halfSize) / halfSize + borderWidth * vec2(1.0, 1.0);\n          size = floor(size * halfSize) / halfSize - 2.0 * borderWidth * vec2(1.0, 1.0);\n\n          vec2 coord = gl_FragCoord.xy;\n          coord.x = coord.x - physicalOrigin.x;\n          coord.y = framebufferHeight - coord.y - physicalOrigin.y;\n          vec2 clamped = clamp(coord, origin, origin + size);\n          vec2 gap = clamped - coord;\n          float maxdist = max(abs(gap.x), abs(gap.y));\n\n          // TOOD(jlfwong): Could probably optimize this to use mix somehow.\n          if (maxdist == 0.0) {\n            // Inside viewport rectangle\n            gl_FragColor = vec4(0, 0, 0, 0);\n          } else if (maxdist < borderWidth) {\n            // Inside viewport rectangle at border\n            gl_FragColor = vec4(0.7, 0.7, 0.7, 0.8);\n          } else {\n            // Outside viewport rectangle\n            gl_FragColor = vec4(0.7, 0.7, 0.7, 0.5);\n          }\n        }\n      ",blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one"}},depth:{enable:!1},attributes:{position:[[-1,1],[1,1],[-1,-1],[1,-1]]},uniforms:{configSpaceToPhysicalViewSpace:(e,i)=>i.configSpaceToPhysicalViewSpace.flatten(),configSpaceViewportOrigin:(e,i)=>i.configSpaceViewportRect.origin.flatten(),configSpaceViewportSize:(e,i)=>i.configSpaceViewportRect.size.flatten(),physicalSize:(e,i)=>[e.viewportWidth,e.viewportHeight],physicalOrigin:(e,i)=>[e.viewportX,e.viewportY],framebufferHeight:(e,i)=>e.framebufferHeight},primitive:"triangle strip",count:4})}render(e){this.command(e)}resetStats(){return Object.assign(this.command.stats,{cpuTime:0,gpuTime:0,count:0})}stats(){return this.command.stats}}exports.ViewportRectangleRenderer=e;
},{}],27:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("./math");class t{}exports.TextureRendererProps=t;class r{constructor(t){this.command=t({vert:"\n        uniform mat3 uvTransform;\n        uniform mat3 positionTransform;\n\n        attribute vec2 position;\n        attribute vec2 uv;\n        varying vec2 vUv;\n\n        void main() {\n          vUv = (uvTransform * vec3(uv, 1)).xy;\n          gl_Position = vec4((positionTransform * vec3(position, 1)).xy, 0, 1);\n        }\n      ",frag:"\n        precision mediump float;\n\n        varying vec2 vUv;\n        uniform sampler2D texture;\n\n        void main() {\n          gl_FragColor = texture2D(texture, vUv);\n        }\n      ",depth:{enable:!1},attributes:{position:t.buffer([[-1,1],[1,1],[-1,-1],[1,-1]]),uv:t.buffer([[0,1],[1,1],[0,0],[1,0]])},uniforms:{texture:(e,t)=>t.texture,uvTransform:(t,r)=>{const{srcRect:i,texture:n}=r,s=e.AffineTransform.withTranslation(new e.Vec2(0,1)).times(e.AffineTransform.withScale(new e.Vec2(1,-1))).times(e.AffineTransform.betweenRects(new e.Rect(e.Vec2.zero,new e.Vec2(n.width,n.height)),e.Rect.unit)).transformRect(i);return e.AffineTransform.betweenRects(e.Rect.unit,s).flatten()},positionTransform:(t,r)=>{const{dstRect:i}=r,n=new e.Vec2(t.viewportWidth,t.viewportHeight),s=e.AffineTransform.withScale(new e.Vec2(1,-1)).times(e.AffineTransform.betweenRects(new e.Rect(e.Vec2.zero,n),e.Rect.NDC)).transformRect(i);return e.AffineTransform.betweenRects(e.Rect.NDC,s).flatten()}},primitive:"triangle strip",count:4})}render(e){this.command(e)}resetStats(){return Object.assign(this.command.stats,{cpuTime:0,gpuTime:0,count:0})}stats(){return this.command.stats}}exports.TextureRenderer=r;class i{constructor(e,t){this.gl=e,this.lastRenderProps=null,this.dirty=!1,this.renderUncached=t.render,this.shouldUpdate=t.shouldUpdate,this.textureRenderer=t.textureRenderer,this.texture=e.texture(1,1),this.framebuffer=e.framebuffer({color:[this.texture]}),this.withContext=e({})}setDirty(){this.dirty=!0}render(t){this.withContext(r=>{let i=!1;this.texture.width!==r.viewportWidth||this.texture.height!==r.viewportHeight?(this.texture({width:r.viewportWidth,height:r.viewportHeight}),this.framebuffer({color:[this.texture]}),i=!0):null==this.lastRenderProps?i=!0:this.shouldUpdate(this.lastRenderProps,t)?i=!0:this.dirty&&(i=!0),i&&this.gl({viewport:(e,t)=>({x:0,y:0,width:e.viewportWidth,height:e.viewportHeight}),framebuffer:this.framebuffer})(()=>{this.gl.clear({color:[0,0,0,0]}),this.renderUncached(t)});const n=new e.Rect(e.Vec2.zero,new e.Vec2(r.viewportWidth,r.viewportHeight));this.textureRenderer.render({texture:this.texture,srcRect:n,dstRect:n}),this.lastRenderProps=t,this.dirty=!1})}}exports.TextureCachedRenderer=i;
},{"./math":29}],28:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class t{constructor(){this.container=document.createElement("div"),this.shown=0,this.panels=[],this.msPanel=new s("MS","#0f0","#020"),this.fpsPanel=new s("FPS","#0ff","#002"),this.frames=0,this.prevTime=0,this.container.style.cssText="\n      position:fixed;\n      bottom:0;\n      right:0;\n      cursor:pointer;\n      opacity:0.9;\n      z-index:10000\n    ",this.container.addEventListener("click",()=>{this.showPanel((this.shown+1)%this.panels.length)}),this.addPanel(this.msPanel),this.addPanel(this.fpsPanel),document.body.appendChild(this.container)}addPanel(t){t.appendTo(this.container),this.panels.push(t),this.showPanel(this.panels.length-1)}showPanel(t){for(var i=0;i<this.container.children.length;i++)this.container.children[i].style.display=i===t?"block":"none";this.shown=t}begin(){this.beginTime=(performance||Date).now()}end(){this.frames++;var t=(performance||Date).now();this.msPanel.update(t-this.beginTime,200),t>=this.prevTime+1e3&&(this.fpsPanel.update(1e3*this.frames/(t-this.prevTime),100),this.prevTime=t,this.frames=0)}}exports.StatsPanel=t;const i=Math.round(window.devicePixelRatio||1);class s{constructor(t,s,h){this.name=t,this.fg=s,this.bg=h,this.min=1/0,this.max=0,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.WIDTH=80*i,this.HEIGHT=48*i,this.TEXT_X=3*i,this.TEXT_Y=2*i,this.GRAPH_X=3*i,this.GRAPH_Y=15*i,this.GRAPH_WIDTH=74*i,this.GRAPH_HEIGHT=30*i,this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.canvas.style.cssText="width:80px;height:48px",this.context.font="bold "+9*i+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.context.fillStyle=h,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=s,this.context.fillText(this.name,this.TEXT_X,this.TEXT_Y),this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT),this.context.fillStyle=h,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT)}appendTo(t){t.appendChild(this.canvas)}update(t,s){this.min=Math.min(this.min,t),this.max=Math.max(this.max,t),this.context.fillStyle=this.bg,this.context.globalAlpha=1,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(Math.round(t)+" "+name+" ("+Math.round(this.min)+"-"+Math.round(this.max)+")",this.TEXT_X,this.TEXT_Y),this.context.drawImage(this.canvas,this.GRAPH_X+i,this.GRAPH_Y,this.GRAPH_WIDTH-i,this.GRAPH_HEIGHT,this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH-i,this.GRAPH_HEIGHT),this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-i,this.GRAPH_Y,i,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-i,this.GRAPH_Y,i,Math.round((1-t/s)*this.GRAPH_HEIGHT))}}
},{}],30:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("./math");class n{}exports.FlamechartColorPassRenderProps=n;class t{constructor(n){this.command=n({vert:"\n        uniform mat3 uvTransform;\n        uniform mat3 positionTransform;\n\n        attribute vec2 position;\n        attribute vec2 uv;\n        varying vec2 vUv;\n\n        void main() {\n          vUv = (uvTransform * vec3(uv, 1)).xy;\n          gl_Position = vec4((positionTransform * vec3(position, 1)).xy, 0, 1);\n        }\n      ",frag:"\n        precision mediump float;\n\n        uniform vec2 uvSpacePixelSize;\n        uniform float renderOutlines;\n\n        varying vec2 vUv;\n        uniform sampler2D colorTexture;\n\n        // https://en.wikipedia.org/wiki/HSL_and_HSV#From_luma/chroma/hue\n        vec3 lch2rgb(float L, float C, float H) {\n          float hPrime = H / 60.0;\n          float X = C * (1.0 - abs(mod(hPrime, 2.0) - 1.0));\n          vec3 RGB =\n            hPrime < 1.0 ? vec3(C, X, 0) :\n            hPrime < 2.0 ? vec3(X, C, 0) :\n            hPrime < 3.0 ? vec3(0, C, X) :\n            hPrime < 4.0 ? vec3(0, X, C) :\n            hPrime < 5.0 ? vec3(X, 0, C) :\n            vec3(C, 0, X);\n\n          float m = L - dot(RGB, vec3(0.30, 0.59, 0.11));\n          return RGB + vec3(m, m, m);\n        }\n\n        vec3 colorForBucket(float bucket) {\n          float x = 2.0 * fract(100.0 * bucket) - 1.0;\n          float L = 0.85 - 0.1 * x;\n          float C = 0.20 + 0.1 * x;\n          float H = 360.0 * bucket;\n          return lch2rgb(L, C, H);\n        }\n\n        void main() {\n          vec4 here = texture2D(colorTexture, vUv);\n\n          if (here.z == 0.0) {\n            // Background color\n            gl_FragColor = vec4(0, 0, 0, 0);\n            return;\n          }\n\n          // Sample the 4 surrounding pixels in the depth texture to determine\n          // if we should draw a boundary here or not.\n          vec4 N = texture2D(colorTexture, vUv + vec2(0, uvSpacePixelSize.y));\n          vec4 E = texture2D(colorTexture, vUv + vec2(uvSpacePixelSize.x, 0));\n          vec4 S = texture2D(colorTexture, vUv + vec2(0, -uvSpacePixelSize.y));\n          vec4 W = texture2D(colorTexture, vUv + vec2(-uvSpacePixelSize.x, 0));\n\n          // NOTE: For outline checks, we intentionally check both the right\n          // and the left to determine if we're an edge. If a rectangle is a single\n          // pixel wide, we don't want to render it as an outline, so this method\n          // of checking ensures that we don't outline single physical-space\n          // pixel width rectangles.\n          if (\n            renderOutlines > 0.0 &&\n            (\n              here.y == N.y && here.y != S.y || // Top edge\n              here.y == S.y && here.y != N.y || // Bottom edge\n              here.x == E.x && here.x != W.x || // Left edge\n              here.x == W.x && here.x != E.x\n            )\n          ) {\n            // We're on an edge! Draw white.\n            gl_FragColor = vec4(1, 1, 1, 1);\n          } else {\n            // Not on an edge. Draw the appropriate color;\n            gl_FragColor = vec4(colorForBucket(here.z), here.a);\n          }\n        }\n      ",depth:{enable:!1},attributes:{position:n.buffer([[-1,1],[1,1],[-1,-1],[1,-1]]),uv:n.buffer([[0,1],[1,1],[0,0],[1,0]])},count:4,primitive:"triangle strip",uniforms:{colorTexture:(e,n)=>n.rectInfoTexture,uvTransform:(n,t)=>{const{srcRect:r,rectInfoTexture:o}=t,i=e.AffineTransform.withTranslation(new e.Vec2(0,1)).times(e.AffineTransform.withScale(new e.Vec2(1,-1))).times(e.AffineTransform.betweenRects(new e.Rect(e.Vec2.zero,new e.Vec2(o.width,o.height)),e.Rect.unit)).transformRect(r);return e.AffineTransform.betweenRects(e.Rect.unit,i).flatten()},renderOutlines:(e,n)=>n.renderOutlines?1:0,uvSpacePixelSize:(n,t)=>e.Vec2.unit.dividedByPointwise(new e.Vec2(t.rectInfoTexture.width,t.rectInfoTexture.height)).flatten(),positionTransform:(n,t)=>{const{dstRect:r}=t,o=new e.Vec2(n.viewportWidth,n.viewportHeight),i=e.AffineTransform.withScale(new e.Vec2(1,-1)).times(e.AffineTransform.betweenRects(new e.Rect(e.Vec2.zero,o),e.Rect.NDC)).transformRect(r);return e.AffineTransform.betweenRects(e.Rect.NDC,i).flatten()}}})}render(e){this.command(e)}}exports.FlamechartColorPassRenderer=t;
},{"./math":29}],7:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("regl"),t=require("./rectangle-batch-renderer"),r=require("./overlay-rectangle-renderer"),i=require("./texture-catched-renderer"),s=require("./stats"),n=require("./math"),a=require("./flamechart-color-pass-renderer");class h{constructor(n){this.tick=null,this.tickNeeded=!1,this.beforeFrameHandlers=new Set,this.perfDebug=-1!==window.location.href.indexOf("perf-debug=1"),this.statsPanel=this.perfDebug?new s.StatsPanel:null,this.onBeforeFrame=(e=>{this.setScissor(()=>{this.gl.clear({color:[0,0,0,0]})}),this.tickNeeded=!1,this.statsPanel&&this.statsPanel.begin();for(const e of this.beforeFrameHandlers)e();this.statsPanel&&this.statsPanel.end(),this.tick&&!this.tickNeeded&&(this.perfDebug||(this.tick.cancel(),this.tick=null))}),this.gl=e({canvas:n,attributes:{antialias:!1},extensions:["ANGLE_instanced_arrays","WEBGL_depth_texture"],optionalExtensions:["EXT_disjoint_timer_query"],profile:!0}),window.CanvasContext=this,this.rectangleBatchRenderer=new t.RectangleBatchRenderer(this.gl),this.viewportRectangleRenderer=new r.ViewportRectangleRenderer(this.gl),this.textureRenderer=new i.TextureRenderer(this.gl),this.flamechartColorPassRenderer=new a.FlamechartColorPassRenderer(this.gl),this.setScissor=this.gl({scissor:{enable:!0}}),this.setViewportScope=this.gl({context:{viewportX:(e,t)=>t.physicalBounds.left(),viewportY:(e,t)=>t.physicalBounds.top()},viewport:(e,t)=>{const{physicalBounds:r}=t;return{x:r.left(),y:window.devicePixelRatio*window.innerHeight-r.top()-r.height(),width:r.width(),height:r.height()}},scissor:(e,t)=>{const{physicalBounds:r}=t;return{enable:!0,box:{x:r.left(),y:window.devicePixelRatio*window.innerHeight-r.top()-r.height(),width:r.width(),height:r.height()}}}})}addBeforeFrameHandler(e){this.beforeFrameHandlers.add(e)}removeBeforeFrameHandler(e){this.beforeFrameHandlers.delete(e)}requestFrame(){this.tickNeeded=!0,this.tick||(this.tick=this.gl.frame(this.onBeforeFrame))}drawRectangleBatch(e){this.rectangleBatchRenderer.render(e)}drawTexture(e){this.textureRenderer.render(e)}drawFlamechartColorPass(e){this.flamechartColorPassRenderer.render(e)}createRectangleBatch(){return new t.RectangleBatch(this.gl)}createTextureCachedRenderer(e){return new i.TextureCachedRenderer(this.gl,Object.assign({},e,{textureRenderer:this.textureRenderer}))}drawViewportRectangle(e){this.viewportRectangleRenderer.render(e)}renderInto(e,t){const r=e.getBoundingClientRect(),i=new n.Rect(new n.Vec2(r.left*window.devicePixelRatio,r.top*window.devicePixelRatio),new n.Vec2(r.width*window.devicePixelRatio,r.height*window.devicePixelRatio));this.setViewportScope({physicalBounds:i},t)}setViewport(e,t){this.setViewportScope({physicalBounds:e},t)}getMaxTextureSize(){return this.gl.limits.maxTextureSize}}exports.CanvasContext=h;
},{"regl":35,"./rectangle-batch-renderer":25,"./overlay-rectangle-renderer":26,"./texture-catched-renderer":27,"./stats":28,"./math":29,"./flamechart-color-pass-renderer":30}],8:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t=require("./utils");class e{constructor(e){this.source=e,this.layers=[],this.totalWeight=0,this.minFrameWidth=1;const r=[],s=(e,s)=>{const i=t.lastOf(r),h={node:e,parent:i,children:[],start:s,end:s};i&&i.children.push(h),r.push(h)};this.minFrameWidth=1/0;const i=t=>{const e=r.pop();if(e.end=t,e.end-e.start==0)return;const s=r.length;for(;this.layers.length<=s;)this.layers.push([]);this.layers[s].push(e),this.minFrameWidth=Math.min(this.minFrameWidth,e.end-e.start)};this.totalWeight=e.getTotalWeight(),e.forEachCall(s,i),isFinite(this.minFrameWidth)||(this.minFrameWidth=1)}getTotalWeight(){return this.totalWeight}getLayers(){return this.layers}getColorBucketForFrame(t){return this.source.getColorBucketForFrame(t)}getMinFrameWidth(){return this.minFrameWidth}formatValue(t){return this.source.formatValue(t)}}exports.Flamechart=e;
},{"./utils":52}],9:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var o;(o=exports.FontFamily||(exports.FontFamily={})).MONOSPACE="Courier, monospace";var e;!function(o){o[o.LABEL=10]="LABEL",o[o.TITLE=12]="TITLE",o[o.BIG_BUTTON=36]="BIG_BUTTON"}(e=exports.FontSize||(exports.FontSize={}));var r;!function(o){o.LIGHT_GRAY="#C4C4C4",o.MEDIUM_GRAY="#BDBDBD",o.GRAY="#666666",o.DARK_GRAY="#333333",o.LIGHT_BLUE="#56CCF2",o.DARK_BLUE="#2F80ED"}(r=exports.Colors||(exports.Colors={}));
},{}],56:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("aphrodite"),o=require("./style"),i=2;var t;!function(e){e.MINIMAP_HEIGHT=100,e.TOOLTIP_WIDTH_MAX=300,e.TOOLTIP_HEIGHT_MAX=75,e.SEPARATOR_HEIGHT=2,e.FRAME_HEIGHT=16}(t=exports.Sizes||(exports.Sizes={})),exports.style=e.StyleSheet.create({hoverTip:{position:"absolute",background:"white",border:"1px solid black",maxWidth:t.TOOLTIP_WIDTH_MAX,paddingTop:2,paddingBottom:2,pointerEvents:"none",userSelect:"none",fontSize:o.FontSize.LABEL,fontFamily:o.FontFamily.MONOSPACE},hoverTipRow:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflowX:"hidden",paddingLeft:2,paddingRight:2,maxWidth:t.TOOLTIP_WIDTH_MAX},hoverCount:{color:"#6FCF97"},clip:{overflow:"hidden"},vbox:{display:"flex",flexDirection:"column",position:"relative"},fill:{width:"100%",height:"100%",position:"absolute",left:0,top:0},minimap:{height:t.MINIMAP_HEIGHT,borderBottom:`${t.SEPARATOR_HEIGHT}px solid ${o.Colors.MEDIUM_GRAY}`},panZoomView:{flex:1}});
},{"aphrodite":13,"./style":9}],55:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("preact"),t=require("aphrodite"),i=require("./math"),s=require("./utils"),n=require("./flamechart-style"),o=require("./style"),r=window.devicePixelRatio;var a;!function(e){e[e.DRAW_NEW_VIEWPORT=0]="DRAW_NEW_VIEWPORT",e[e.TRANSLATE_VIEWPORT=1]="TRANSLATE_VIEWPORT"}(a||(a={}));class c extends e.Component{constructor(){super(...arguments),this.container=null,this.containerRef=(e=>{this.container=e||null}),this.overlayCanvas=null,this.overlayCtx=null,this.cachedRenderer=null,this.onBeforeFrame=(()=>{this.maybeClearInteractionLock(),this.renderRects(),this.renderOverlays()}),this.renderCanvas=(()=>{this.props.canvasContext.requestFrame()}),this.frameHadWheelEvent=!1,this.framesWithoutWheelEvents=0,this.interactionLock=null,this.maybeClearInteractionLock=(()=>{this.interactionLock&&(this.frameHadWheelEvent||(this.framesWithoutWheelEvents++,this.framesWithoutWheelEvents>=2&&(this.interactionLock=null,this.framesWithoutWheelEvents=0)),this.props.canvasContext.requestFrame()),this.frameHadWheelEvent=!1}),this.onWheel=(e=>{e.preventDefault(),this.frameHadWheelEvent=!0;if((e.metaKey||e.ctrlKey)&&"pan"!==this.interactionLock){let t=1+e.deltaY/100;e.ctrlKey&&(t=1+e.deltaY/40),t=i.clamp(t,.1,10),this.zoom(t)}else"zoom"!==this.interactionLock&&this.pan(new i.Vec2(e.deltaX,e.deltaY));this.renderCanvas()}),this.dragStartConfigSpaceMouse=null,this.dragConfigSpaceViewportOffset=null,this.draggingMode=null,this.onMouseDown=(e=>{const t=this.configSpaceMouse(e);t&&(this.props.configSpaceViewportRect.contains(t)?(this.draggingMode=a.TRANSLATE_VIEWPORT,this.dragConfigSpaceViewportOffset=t.minus(this.props.configSpaceViewportRect.origin)):this.draggingMode=a.DRAW_NEW_VIEWPORT,this.dragStartConfigSpaceMouse=t,window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp),this.updateCursor(t))}),this.onWindowMouseMove=(e=>{if(!this.dragStartConfigSpaceMouse)return;let t=this.configSpaceMouse(e);if(t)if(this.updateCursor(t),t=new i.Rect(new i.Vec2(0,0),this.configSpaceSize()).closestPointTo(t),this.draggingMode===a.DRAW_NEW_VIEWPORT){const e=this.dragStartConfigSpaceMouse;let s=t;if(!e||!s)return;const n=Math.min(e.x,s.x),o=Math.max(e.x,s.x)-n,r=this.props.configSpaceViewportRect.height();this.props.setConfigSpaceViewportRect(new i.Rect(new i.Vec2(n,s.y-r/2),new i.Vec2(o,r)))}else if(this.draggingMode===a.TRANSLATE_VIEWPORT){if(!this.dragConfigSpaceViewportOffset)return;const e=t.minus(this.dragConfigSpaceViewportOffset);this.props.setConfigSpaceViewportRect(this.props.configSpaceViewportRect.withOrigin(e))}}),this.updateCursor=(e=>{this.draggingMode===a.TRANSLATE_VIEWPORT?(document.body.style.cursor="grabbing",document.body.style.cursor="-webkit-grabbing"):this.draggingMode===a.DRAW_NEW_VIEWPORT?document.body.style.cursor="col-resize":this.props.configSpaceViewportRect.contains(e)?(document.body.style.cursor="grab",document.body.style.cursor="-webkit-grab"):document.body.style.cursor="col-resize"}),this.onMouseMove=(e=>{const t=this.configSpaceMouse(e);t&&this.updateCursor(t)}),this.onWindowMouseUp=(e=>{this.draggingMode=null,window.removeEventListener("mousemove",this.onWindowMouseMove),window.removeEventListener("mouseup",this.onWindowMouseUp);const t=this.configSpaceMouse(e);t&&this.updateCursor(t)}),this.overlayCanvasRef=(e=>{e?(this.overlayCanvas=e,this.overlayCtx=this.overlayCanvas.getContext("2d"),this.renderCanvas()):(this.overlayCanvas=null,this.overlayCtx=null)})}physicalViewSize(){return new i.Vec2(this.overlayCanvas?this.overlayCanvas.width:0,this.overlayCanvas?this.overlayCanvas.height:0)}minimapOrigin(){return new i.Vec2(0,n.Sizes.FRAME_HEIGHT*r)}configSpaceSize(){return new i.Vec2(this.props.flamechart.getTotalWeight(),this.props.flamechart.getLayers().length)}configSpaceToPhysicalViewSpace(){const e=this.minimapOrigin();return i.AffineTransform.betweenRects(new i.Rect(new i.Vec2(0,0),this.configSpaceSize()),new i.Rect(e,this.physicalViewSize().minus(e)))}logicalToPhysicalViewSpace(){return i.AffineTransform.withScale(new i.Vec2(r,r))}windowToLogicalViewSpace(){if(!this.container)return new i.AffineTransform;const e=this.container.getBoundingClientRect();return i.AffineTransform.withTranslation(new i.Vec2(-e.left,-e.top))}renderRects(){this.container&&(this.physicalViewSize().x<2||(this.cachedRenderer||(this.cachedRenderer=this.props.canvasContext.createTextureCachedRenderer({shouldUpdate:(e,t)=>!e.physicalSize.equals(t.physicalSize),render:e=>{this.props.flamechartRenderer.render({physicalSpaceDstRect:new i.Rect(this.minimapOrigin(),this.physicalViewSize().minus(this.minimapOrigin())),configSpaceSrcRect:new i.Rect(new i.Vec2(0,0),this.configSpaceSize()),renderOutlines:!1})}})),this.props.canvasContext.renderInto(this.container,e=>{this.props.flamechartRenderer.render({configSpaceSrcRect:new i.Rect(new i.Vec2(0,0),this.configSpaceSize()),physicalSpaceDstRect:new i.Rect(this.minimapOrigin(),this.physicalViewSize().minus(this.minimapOrigin())),renderOutlines:!1}),this.props.canvasContext.drawViewportRectangle({configSpaceViewportRect:this.props.configSpaceViewportRect,configSpaceToPhysicalViewSpace:this.configSpaceToPhysicalViewSpace()})})))}renderOverlays(){const e=this.overlayCtx;if(!e)return;const t=this.physicalViewSize();e.clearRect(0,0,t.x,t.y),this.resizeOverlayCanvasIfNeeded();const a=this.configSpaceToPhysicalViewSpace(),c=this.configSpaceSize().x,h=(this.configSpaceToPhysicalViewSpace().inverted()||new i.AffineTransform).times(this.logicalToPhysicalViewSpace()),l=h.transformVector(new i.Vec2(200,1)).x,p=n.Sizes.FRAME_HEIGHT*r,f=o.FontSize.LABEL*r,d=(p-f)/2;e.font=`${f}px/${p}px ${o.FontFamily.MONOSPACE}`,e.textBaseline="top";const u=Math.pow(10,Math.floor(Math.log10(l)));let g=u;l/g>5?g*=5:l/g>2&&(g*=2),e.fillStyle="rgba(255, 255, 255, 0.8)",e.fillRect(0,0,t.x,p),e.fillStyle=o.Colors.GRAY;for(let n=Math.ceil(0/g)*g;n<c;n+=g){const o=Math.round(a.transformPosition(new i.Vec2(n,0)).x),r=this.props.flamechart.formatValue(n),c=Math.ceil(s.cachedMeasureTextWidth(e,r));e.fillText(r,o-c-d,d),e.fillRect(o,0,1,t.y)}}componentWillReceiveProps(e){this.props.flamechart!==e.flamechart?(this.cachedRenderer&&this.cachedRenderer.setDirty(),this.renderCanvas()):this.props.configSpaceViewportRect!=e.configSpaceViewportRect&&this.renderCanvas()}componentDidMount(){this.props.canvasContext.addBeforeFrameHandler(this.onBeforeFrame)}componentWillUnmount(){this.props.canvasContext.removeBeforeFrameHandler(this.onBeforeFrame)}resizeOverlayCanvasIfNeeded(){if(!this.overlayCanvas)return;let{width:e,height:t}=this.overlayCanvas.getBoundingClientRect();if(e=Math.floor(e),t=Math.floor(t),0===e||0===t)return;const i=e*r,s=t*r;i===this.overlayCanvas.width&&s===this.overlayCanvas.height||(this.overlayCanvas.width=i,this.overlayCanvas.height=s)}pan(e){this.interactionLock="pan";const t=this.logicalToPhysicalViewSpace().transformVector(e),s=this.configSpaceToPhysicalViewSpace().inverseTransformVector(t);s&&this.props.transformViewport(i.AffineTransform.withTranslation(s))}zoom(e){this.interactionLock="zoom";const t=this.props.configSpaceViewportRect,s=t.origin.plus(t.size.times(.5));if(!s)return;const n=i.AffineTransform.withTranslation(s.times(-1)).scaledBy(new i.Vec2(e,1)).translatedBy(s);this.props.transformViewport(n)}configSpaceMouse(e){const t=this.windowToLogicalViewSpace().transformPosition(new i.Vec2(e.clientX,e.clientY)),s=this.logicalToPhysicalViewSpace().transformPosition(t);return this.configSpaceToPhysicalViewSpace().inverseTransformPosition(s)}render(){return e.h("div",{ref:this.containerRef,onWheel:this.onWheel,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,className:t.css(n.style.minimap,n.style.vbox)},e.h("canvas",{width:1,height:1,ref:this.overlayCanvasRef,className:t.css(n.style.fill)}))}}exports.FlamechartMinimapView=c;
},{"preact":3,"aphrodite":13,"./math":29,"./utils":52,"./flamechart-style":56,"./style":9}],5:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("preact"),t=require("aphrodite"),i=require("./reloadable"),o=require("./math"),s=require("./utils"),n=require("./flamechart-minimap-view"),r=require("./flamechart-style"),a=require("./style");function h(e,t,i,o,s=1){for(;;){if(t-e<=s)return[e,t];const n=(t+e)/2;i(n)<o?e=n:t=n}}const c="…";function l(e,t){const i=Math.floor(t/2),o=e.substr(0,i),s=e.substr(e.length-i,i);return o+c+s}function p(e,t,i){if(s.cachedMeasureTextWidth(e,t)<=i)return t;const[o]=h(0,t.length,i=>s.cachedMeasureTextWidth(e,l(t,i)),i);return l(t,o)}const f=window.devicePixelRatio;class w extends i.ReloadableComponent{constructor(){super(...arguments),this.container=null,this.containerRef=(e=>{this.container=e||null}),this.overlayCanvas=null,this.overlayCtx=null,this.hoveredLabel=null,this.overlayCanvasRef=(e=>{e?(this.overlayCanvas=e,this.overlayCtx=this.overlayCanvas.getContext("2d"),this.renderCanvas()):(this.overlayCanvas=null,this.overlayCtx=null)}),this.LOGICAL_VIEW_SPACE_FRAME_HEIGHT=16,this.lastBounds=null,this.onWindowResize=(()=>{this.updateConfigSpaceViewport(!0),this.onBeforeFrame()}),this.frameHadWheelEvent=!1,this.framesWithoutWheelEvents=0,this.interactionLock=null,this.maybeClearInteractionLock=(()=>{this.interactionLock&&(this.frameHadWheelEvent||(this.framesWithoutWheelEvents++,this.framesWithoutWheelEvents>=2&&(this.interactionLock=null,this.framesWithoutWheelEvents=0)),this.props.canvasContext.requestFrame()),this.frameHadWheelEvent=!1}),this.onBeforeFrame=(()=>{this.renderRects(),this.renderOverlays(),this.maybeClearInteractionLock()}),this.renderCanvas=(()=>{this.props.canvasContext.requestFrame()}),this.lastDragPos=null,this.onMouseDown=(e=>{this.lastDragPos=new o.Vec2(e.offsetX,e.offsetY),this.updateCursor(),window.addEventListener("mouseup",this.onWindowMouseUp)}),this.onMouseDrag=(e=>{if(!this.lastDragPos)return;const t=new o.Vec2(e.offsetX,e.offsetY);this.pan(this.lastDragPos.minus(t)),this.lastDragPos=t,this.hoveredLabel&&this.props.setNodeHover(this.hoveredLabel.node,t)}),this.onDblClick=(e=>{if(this.hoveredLabel){const e=this.hoveredLabel.configSpaceBounds,t=new o.Rect(e.origin.minus(new o.Vec2(0,1)),e.size.withY(this.props.configSpaceViewportRect.height()));this.props.setConfigSpaceViewportRect(t)}}),this.onWindowMouseUp=(e=>{this.lastDragPos=null,this.updateCursor(),window.removeEventListener("mouseup",this.onWindowMouseUp)}),this.onMouseMove=(e=>{if(this.updateCursor(),this.lastDragPos)return e.preventDefault(),void this.onMouseDrag(e);this.hoveredLabel=null;const t=new o.Vec2(e.offsetX,e.offsetY),i=this.logicalToPhysicalViewSpace().transformPosition(t),s=this.configSpaceToPhysicalViewSpace().inverseTransformPosition(i);if(!s)return;const n=(e,t=0)=>{const i=e.end-e.start,r=new o.Rect(new o.Vec2(e.start,t),new o.Vec2(i,1));if(s.x<r.left())return null;if(s.x>r.right())return null;r.contains(s)&&(this.hoveredLabel={configSpaceBounds:r,node:e.node});for(let i of e.children)n(i,t+1)};for(let e of this.props.flamechart.getLayers()[0]||[])n(e);this.hoveredLabel?this.props.setNodeHover(this.hoveredLabel.node,t):this.props.setNodeHover(null,t),this.renderCanvas()}),this.onMouseLeave=(e=>{this.hoveredLabel=null,this.props.setNodeHover(null,o.Vec2.zero),this.renderCanvas()}),this.onWheel=(e=>{e.preventDefault(),this.frameHadWheelEvent=!0;if((e.metaKey||e.ctrlKey)&&"pan"!==this.interactionLock){let t=1+e.deltaY/100;e.ctrlKey&&(t=1+e.deltaY/40),t=o.clamp(t,.1,10),this.zoom(new o.Vec2(e.offsetX,e.offsetY),t)}else"zoom"!==this.interactionLock&&this.pan(new o.Vec2(e.deltaX,e.deltaY));this.renderCanvas()}),this.onWindowKeyPress=(e=>{if(!this.container)return;const{width:t,height:i}=this.container.getBoundingClientRect();"="===e.key||"+"===e.key?(this.zoom(new o.Vec2(t/2,i/2),.5),e.preventDefault()):"-"===e.key||"_"===e.key?(this.zoom(new o.Vec2(t/2,i/2),2),e.preventDefault()):"0"===e.key?this.zoom(new o.Vec2(t/2,i/2),1e9):"ArrowRight"===e.key||"d"===e.key?this.pan(new o.Vec2(100,0)):"ArrowLeft"===e.key||"a"===e.key?this.pan(new o.Vec2(-100,0)):"ArrowUp"===e.key||"w"===e.key?this.pan(new o.Vec2(0,-100)):"ArrowDown"!==e.key&&"s"!==e.key||this.pan(new o.Vec2(0,100))})}setConfigSpaceViewportRect(e){this.props.setConfigSpaceViewportRect(e)}configSpaceSize(){return new o.Vec2(this.props.flamechart.getTotalWeight(),this.props.flamechart.getLayers().length)}physicalViewSize(){return new o.Vec2(this.overlayCanvas?this.overlayCanvas.width:0,this.overlayCanvas?this.overlayCanvas.height:0)}configSpaceToPhysicalViewSpace(){return o.AffineTransform.betweenRects(this.props.configSpaceViewportRect,new o.Rect(new o.Vec2(0,0),this.physicalViewSize()))}logicalToPhysicalViewSpace(){return o.AffineTransform.withScale(new o.Vec2(f,f))}resizeOverlayCanvasIfNeeded(){if(!this.overlayCanvas)return;let{width:e,height:t}=this.overlayCanvas.getBoundingClientRect();if(e=Math.floor(e),t=Math.floor(t),0===e||0===t)return;const i=e*f,o=t*f;i===this.overlayCanvas.width&&o===this.overlayCanvas.height||(this.overlayCanvas.width=i,this.overlayCanvas.height=o)}renderOverlays(){const e=this.overlayCtx;if(!e)return;if(this.resizeOverlayCanvasIfNeeded(),this.props.configSpaceViewportRect.isEmpty())return;const t=this.configSpaceToPhysicalViewSpace(),i=a.FontSize.LABEL*f,n=this.LOGICAL_VIEW_SPACE_FRAME_HEIGHT*f,r=this.physicalViewSize();if(e.clearRect(0,0,r.x,r.y),e.strokeStyle="rgba(15, 10, 5, 0.5)",e.lineWidth=2,this.hoveredLabel){const i=t.transformRect(this.hoveredLabel.configSpaceBounds);e.strokeRect(Math.floor(i.left()),Math.floor(i.top()),Math.floor(i.width()),Math.floor(i.height()))}e.font=`${i}px/${n}px ${a.FontFamily.MONOSPACE}`,e.fillStyle=a.Colors.GRAY,e.textBaseline="top";const h=s.cachedMeasureTextWidth(e,"M"+c+"M"),l=(t.inverseTransformVector(new o.Vec2(h,0))||new o.Vec2(0,0)).x,w=(n-i)/2,d=new o.Vec2(w,w),u=new o.Vec2(2*w,2*w),m=(i,s=0)=>{const n=i.end-i.start,a=new o.Rect(new o.Vec2(i.start,s),new o.Vec2(n,1));if(!(n<l||a.left()>this.props.configSpaceViewportRect.right()||a.right()<this.props.configSpaceViewportRect.left()||a.top()>this.props.configSpaceViewportRect.bottom())){if(a.hasIntersectionWith(this.props.configSpaceViewportRect)){let o=t.transformRect(a);o.left()<0&&(o=o.withOrigin(o.origin.withX(0)).withSize(o.size.withX(o.size.x+o.left()))),o.right()>r.x&&(o=o.withSize(o.size.withX(r.x-o.left()))),o=o.withOrigin(o.origin.plus(d)).withSize(o.size.minus(u));const s=p(e,i.node.frame.name,o.width());e.fillText(s,o.left(),o.top())}for(let e of i.children)m(e,s+1)}};for(let e of this.props.flamechart.getLayers()[0]||[])m(e);const g=this.props.configSpaceViewportRect.left(),v=this.props.configSpaceViewportRect.right(),V=(this.configSpaceToPhysicalViewSpace().inverted()||new o.AffineTransform).times(this.logicalToPhysicalViewSpace()),y=V.transformVector(new o.Vec2(200,1)).x,S=Math.pow(10,Math.floor(Math.log10(y)));let R=S;y/R>5?R*=5:y/R>2&&(R*=2),e.fillStyle="rgba(255, 255, 255, 0.8)",e.fillRect(0,0,r.x,n),e.fillStyle=a.Colors.GRAY;for(let i=Math.ceil(g/R)*R;i<v;i+=R){const n=Math.round(t.transformPosition(new o.Vec2(i,0)).x),a=this.props.flamechart.formatValue(i),h=s.cachedMeasureTextWidth(e,a);e.fillText(a,n-h-5,2),e.fillRect(n,0,1,r.y)}}updateConfigSpaceViewport(e=!1){if(!this.container)return;const t=this.container.getBoundingClientRect(),{width:i,height:s}=t;i<2||s<2||(null==this.lastBounds?this.setConfigSpaceViewportRect(new o.Rect(new o.Vec2(0,-1),new o.Vec2(this.configSpaceSize().x,s/this.LOGICAL_VIEW_SPACE_FRAME_HEIGHT))):e&&this.setConfigSpaceViewportRect(this.props.configSpaceViewportRect.withSize(this.props.configSpaceViewportRect.size.timesPointwise(new o.Vec2(i/this.lastBounds.width,s/this.lastBounds.height)))),this.lastBounds=t)}renderRects(){this.container&&(this.updateConfigSpaceViewport(),this.props.configSpaceViewportRect.isEmpty()||this.props.canvasContext.renderInto(this.container,e=>{this.props.flamechartRenderer.render({physicalSpaceDstRect:new o.Rect(o.Vec2.zero,this.physicalViewSize()),configSpaceSrcRect:this.props.configSpaceViewportRect,renderOutlines:!0})}))}pan(e){this.interactionLock="pan";const t=this.logicalToPhysicalViewSpace().transformVector(e),i=this.configSpaceToPhysicalViewSpace().inverseTransformVector(t);i&&this.props.transformViewport(o.AffineTransform.withTranslation(i))}zoom(e,t){this.interactionLock="zoom";const i=this.logicalToPhysicalViewSpace().transformPosition(e),s=this.configSpaceToPhysicalViewSpace().inverseTransformPosition(i);if(!s)return;const n=o.AffineTransform.withTranslation(s.times(-1)).scaledBy(new o.Vec2(t,1)).translatedBy(s);this.props.transformViewport(n)}updateCursor(){this.lastDragPos?(document.body.style.cursor="grabbing",document.body.style.cursor="-webkit-grabbing"):document.body.style.cursor="default"}shouldComponentUpdate(){return!1}componentWillReceiveProps(e){this.props.flamechart!==e.flamechart?this.renderCanvas():this.props.configSpaceViewportRect!==e.configSpaceViewportRect&&this.renderCanvas()}componentDidMount(){this.props.canvasContext.addBeforeFrameHandler(this.onBeforeFrame),window.addEventListener("resize",this.onWindowResize),window.addEventListener("keydown",this.onWindowKeyPress)}componentWillUnmount(){this.props.canvasContext.removeBeforeFrameHandler(this.onBeforeFrame),window.removeEventListener("resize",this.onWindowResize),window.removeEventListener("keydown",this.onWindowKeyPress)}render(){return e.h("div",{className:t.css(r.style.panZoomView,r.style.vbox),onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onMouseLeave:this.onMouseLeave,onDblClick:this.onDblClick,onWheel:this.onWheel,ref:this.containerRef},e.h("canvas",{width:1,height:1,ref:this.overlayCanvasRef,className:t.css(r.style.fill)}))}}exports.FlamechartPanZoomView=w;class d extends i.ReloadableComponent{constructor(){super(),this.container=null,this.setConfigSpaceViewportRect=(e=>{const t=new o.Rect(new o.Vec2(0,-1),o.Vec2.max(new o.Vec2(0,0),this.configSpaceSize().minus(e.size))),i=new o.Rect(new o.Vec2(this.minConfigSpaceViewportRectWidth(),e.height()),new o.Vec2(this.configSpaceSize().x,e.height()));this.setState({configSpaceViewportRect:new o.Rect(t.closestPointTo(e.origin),i.closestPointTo(e.size))})}),this.transformViewport=(e=>{const t=e.transformRect(this.state.configSpaceViewportRect);this.setConfigSpaceViewportRect(t)}),this.onNodeHover=((e,t)=>{this.setState({hoveredNode:e,logicalSpaceMouse:t.plus(new o.Vec2(0,r.Sizes.MINIMAP_HEIGHT))})}),this.containerRef=(e=>{this.container=e||null}),this.panZoomRef=(e=>{this.panZoomView=e}),this.state={hoveredNode:null,configSpaceViewportRect:o.Rect.empty,logicalSpaceMouse:o.Vec2.zero}}configSpaceSize(){return new o.Vec2(this.props.flamechart.getTotalWeight(),this.props.flamechart.getLayers().length)}minConfigSpaceViewportRectWidth(){return Math.min(this.props.flamechart.getTotalWeight(),3*this.props.flamechart.getMinFrameWidth())}formatValue(e){const t=this.props.flamechart.getTotalWeight(),i=100*e/t;let o=`${i.toFixed(0)}%`;return 100===i?o="100%":i>99?o=">99%":i<.01?o="<0.01%":i<1?o=`${i.toFixed(2)}%`:i<10&&(o=`${i.toFixed(1)}%`),`${this.props.flamechart.formatValue(e)} (${o})`}renderTooltip(){if(!this.container)return null;const{hoveredNode:i,logicalSpaceMouse:o}=this.state;if(!i)return null;const{width:s,height:n}=this.container.getBoundingClientRect(),a={};return o.x+7+r.Sizes.TOOLTIP_WIDTH_MAX<s?a.left=o.x+7:a.right=s-o.x+1,o.y+7+r.Sizes.TOOLTIP_HEIGHT_MAX<n?a.top=o.y+7:a.bottom=n-o.y+1,e.h("div",{className:t.css(r.style.hoverTip),style:a},e.h("div",{className:t.css(r.style.hoverTipRow)},e.h("span",{className:t.css(r.style.hoverCount)},this.formatValue(i.getTotalWeight()))," ",i.frame.name))}subcomponents(){return{panZoom:this.panZoomView}}render(){return e.h("div",{className:t.css(r.style.fill,r.style.clip,r.style.vbox),ref:this.containerRef},e.h(n.FlamechartMinimapView,{configSpaceViewportRect:this.state.configSpaceViewportRect,transformViewport:this.transformViewport,flamechart:this.props.flamechart,flamechartRenderer:this.props.flamechartRenderer,canvasContext:this.props.canvasContext,setConfigSpaceViewportRect:this.setConfigSpaceViewportRect}),e.h(w,{ref:this.panZoomRef,canvasContext:this.props.canvasContext,flamechart:this.props.flamechart,flamechartRenderer:this.props.flamechartRenderer,setNodeHover:this.onNodeHover,transformViewport:this.transformViewport,configSpaceViewportRect:this.state.configSpaceViewportRect,setConfigSpaceViewportRect:this.setConfigSpaceViewportRect}),this.renderTooltip())}}exports.FlamechartView=d;
},{"preact":3,"aphrodite":13,"./reloadable":4,"./math":29,"./utils":52,"./flamechart-minimap-view":55,"./flamechart-style":56,"./style":9}],2:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("preact"),t=require("aphrodite"),r=require("./reloadable"),a=require("./import/bg-flamegraph"),s=require("./import/stackprof"),o=require("./import/chrome"),n=require("./flamechart-renderer"),i=require("./canvas-context"),l=require("./flamechart"),h=require("./flamechart-view"),c=require("./style");var d;!function(e){e[e.CHRONO=0]="CHRONO",e[e.LEFT_HEAVY=1]="LEFT_HEAVY"}(d||(d={}));function m(e,t){try{if(t.endsWith(".cpuprofile"))return o.importFromChromeCPUProfile(JSON.parse(e));if(t.endsWith(".chrome.json")||/Profile-\d{8}T\d{6}/.exec(t))return o.importFromChromeTimeline(JSON.parse(e));if(t.endsWith(".stackprof.json"))return s.importFromStackprof(JSON.parse(e));if(t.endsWith(".txt"))return a.importFromBGFlameGraph(e);try{const t=JSON.parse(e);if(Array.isArray(t)&&"CpuProfile"===t[t.length-1].name)return o.importFromChromeTimeline(t);if("nodes"in t&&"samples"in t&&"timeDeltas"in t)return o.importFromChromeCPUProfile(t);if("mode"in t&&"frames"in t)return s.importFromStackprof(t)}catch(t){const r=e.split(/\n/).length;if(r>1&&r===e.split(/ \d+\n/).length)return a.importFromBGFlameGraph(e)}return null}catch(e){return null}}class p extends r.ReloadableComponent{constructor(){super(...arguments),this.setTimeOrder=(()=>{this.props.setSortOrder(d.CHRONO)}),this.setLeftHeavyOrder=(()=>{this.props.setSortOrder(d.LEFT_HEAVY)})}render(){const r=e.h("div",{className:t.css(g.toolbarTab)},e.h("a",{href:"https://github.com/jlfwong/speedscope#usage",className:t.css(g.noLinkStyle),target:"_blank"},e.h("span",{className:t.css(g.emoji)},"❓"),"Help"));return this.props.profile?e.h("div",{className:t.css(g.toolbar)},e.h("div",{className:t.css(g.toolbarLeft)},e.h("div",{className:t.css(g.toolbarTab,this.props.sortOrder===d.CHRONO&&g.toolbarTabActive),onClick:this.setTimeOrder},e.h("span",{className:t.css(g.emoji)},"🕰"),"Time Order"),e.h("div",{className:t.css(g.toolbarTab,this.props.sortOrder===d.LEFT_HEAVY&&g.toolbarTabActive),onClick:this.setLeftHeavyOrder},e.h("span",{className:t.css(g.emoji)},"⬅️"),"Left Heavy"),r),this.props.profile.getName(),e.h("div",{className:t.css(g.toolbarRight)},"🔬speedscope")):e.h("div",{className:t.css(g.toolbar)},e.h("div",{className:t.css(g.toolbarLeft)},r),"🔬speedscope")}}exports.Toolbar=p;class f extends r.ReloadableComponent{constructor(){super(...arguments),this.canvas=null,this.canvasContext=null,this.ref=(e=>{e instanceof HTMLCanvasElement?(this.canvas=e,this.canvasContext=new i.CanvasContext(e)):(this.canvas=null,this.canvasContext=null),this.props.setCanvasContext(this.canvasContext)}),this.onWindowResize=(()=>{this.maybeResize(),window.addEventListener("resize",this.onWindowResize)})}maybeResize(){if(!this.canvas)return;let{width:e,height:t}=this.canvas.getBoundingClientRect();if(e=Math.floor(e)*window.devicePixelRatio,t=Math.floor(t)*window.devicePixelRatio,e<4||t<4)return;const r=this.canvas.width,a=this.canvas.height;e===r&&t===a||(this.canvas.width=e,this.canvas.height=t)}componentDidMount(){window.addEventListener("resize",this.onWindowResize),requestAnimationFrame(()=>this.maybeResize())}componentWillUnmount(){window.removeEventListener("resize",this.onWindowResize)}render(){return e.h("canvas",{className:t.css(g.glCanvasView),ref:this.ref,width:1,height:1})}}exports.GLCanvas=f;class u extends r.ReloadableComponent{constructor(){super(),this.loadExample=(()=>{this.setState({loading:!0}),fetch("dist/perf-vertx-stacks-01-collapsed-all.txt").then(e=>e.text()).then(e=>{this.loadFromString("perf-vertx-stacks-01-collapsed-all.txt",e)})}),this.onDrop=(e=>{this.loadFromFile(e.dataTransfer.files.item(0)),e.preventDefault()}),this.onDragOver=(e=>{e.preventDefault()}),this.onWindowKeyPress=(e=>{"1"===e.key?this.setState({sortOrder:d.CHRONO}):"2"===e.key&&this.setState({sortOrder:d.LEFT_HEAVY})}),this.flamechartRef=(e=>this.flamechartView=e),this.onFileSelect=(e=>{this.loadFromFile(e.target.files.item(0))}),this.setSortOrder=(e=>{this.setState({sortOrder:e})}),this.canvasContext=null,this.setCanvasContext=(e=>{this.canvasContext=e}),this.state={loading:!1,profile:null,flamechart:null,flamechartRenderer:null,sortedFlamechart:null,sortedFlamechartRenderer:null,sortOrder:d.CHRONO}}serialize(){const e=super.serialize();return delete e.state.flamechartRenderer,delete e.state.sortedFlamechartRenderer,e}rehydrate(e){super.rehydrate(e);const{flamechart:t,sortedFlamechart:r}=e.state;this.canvasContext&&t&&r&&this.setState({flamechartRenderer:new n.FlamechartRenderer(this.canvasContext,t),sortedFlamechartRenderer:new n.FlamechartRenderer(this.canvasContext,r)})}loadFromString(e,t){if(!this.canvasContext)return;const r=m(t,e);if(null==r)return this.setState({loading:!1}),void alert("Unrecognized format! See documentation about supported formats.");r.setName(e),document.title=`${e} - speedscope`;const a=[];r.forEachFrame(e=>a.push(e));function s(e){return(e.file||"")+e.name}function o(e,t){return s(e)>s(t)?1:-1}a.sort(o);const i=new Map;for(let e=0;e<a.length;e++)i.set(a[e],Math.floor(255*e/a.length));function h(e){return i.get(e)||0}const c=new l.Flamechart({getTotalWeight:r.getTotalWeight.bind(r),forEachCall:r.forEachCall.bind(r),formatValue:r.formatValue.bind(r),getColorBucketForFrame:h}),d=new n.FlamechartRenderer(this.canvasContext,c),p=new l.Flamechart({getTotalWeight:r.getTotalNonIdleWeight.bind(r),forEachCall:r.forEachCallGrouped.bind(r),formatValue:r.formatValue.bind(r),getColorBucketForFrame:h}),f=new n.FlamechartRenderer(this.canvasContext,p);this.setState({profile:r,flamechart:c,flamechartRenderer:d,sortedFlamechart:p,sortedFlamechartRenderer:f,loading:!1},()=>{})}loadFromFile(e){this.setState({loading:!0},()=>{requestAnimationFrame(()=>{const t=new FileReader;t.addEventListener("loadend",()=>{this.loadFromString(e.name,t.result)}),t.readAsText(e)})})}componentDidMount(){window.addEventListener("keypress",this.onWindowKeyPress)}componentWillUnmount(){window.removeEventListener("keypress",this.onWindowKeyPress)}subcomponents(){return{flamechart:this.flamechartView}}renderLanding(){return e.h("div",{className:t.css(g.landingContainer)},e.h("div",{className:t.css(g.landingMessage)},e.h("p",{className:t.css(g.landingP)},"👋 Hi there! Welcome to 🔬speedscope, an interactive"," ",e.h("a",{className:t.css(g.link),href:"http://www.brendangregg.com/FlameGraphs/cpuflamegraphs.html"},"flamegraph")," visualizer. Use it to help you make your software faster."),e.h("p",{className:t.css(g.landingP)},"Drag and drop a profile file onto this window to get started, click the big blue button below to browse for a profile to explore, or"," ",e.h("a",{className:t.css(g.link),onClick:this.loadExample},"click here")," ","to load an example profile."),e.h("div",{className:t.css(g.browseButtonContainer)},e.h("input",{type:"file",name:"file",id:"file",onChange:this.onFileSelect,className:t.css(g.hide)}),e.h("label",{for:"file",className:t.css(g.browseButton)},"Browse")),e.h("p",{className:t.css(g.landingP)},"See the ",e.h("a",{className:t.css(g.link),href:"https://github.com/jlfwong/speedscope#usage",target:"_blank"},"documentation")," for information about supported file formats, keyboard shortcuts, and how to navigate around the profile."),e.h("p",{className:t.css(g.landingP)},"speedscope is open source. Please ",e.h("a",{className:t.css(g.link),target:"_blank",href:"https://github.com/jlfwong/speedscope/issues"},"report any issues on GitHub"),".")))}renderLoadingBar(){return e.h("div",{className:t.css(g.loading)})}render(){const{flamechart:r,flamechartRenderer:a,sortedFlamechart:s,sortedFlamechartRenderer:o,sortOrder:n,loading:i}=this.state,l=n==d.CHRONO?r:s,c=n==d.CHRONO?a:o;return e.h("div",{onDrop:this.onDrop,onDragOver:this.onDragOver,className:t.css(g.root)},e.h(f,{setCanvasContext:this.setCanvasContext}),e.h(p,Object.assign({setSortOrder:this.setSortOrder},this.state)),i?this.renderLoadingBar():this.canvasContext&&l&&c?e.h(h.FlamechartView,{canvasContext:this.canvasContext,flamechartRenderer:c,ref:this.flamechartRef,flamechart:l}):this.renderLanding())}}exports.Application=u;const g=t.StyleSheet.create({glCanvasView:{position:"absolute",width:"100vw",height:"100vh",zIndex:-1,pointerEvents:"none"},loading:{height:3,marginBottom:-3,background:c.Colors.DARK_BLUE,transformOrigin:"0% 50%",animationName:[{from:{transform:"scaleX(0)"},to:{transform:"scaleX(1)"}}],animationTimingFunction:"cubic-bezier(0, 1, 0, 1)",animationDuration:"30s"},root:{width:"100vw",height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column",position:"relative",fontFamily:c.FontFamily.MONOSPACE,lineHeight:"20px"},landingContainer:{display:"flex",alignItems:"center",justifyContent:"center",flex:1},landingMessage:{maxWidth:600},landingP:{marginBottom:16},hide:{display:"none"},browseButtonContainer:{display:"flex",alignItems:"center",justifyContent:"center"},browseButton:{marginBottom:16,height:72,flex:1,maxWidth:256,textAlign:"center",fontSize:c.FontSize.BIG_BUTTON,lineHeight:"72px",background:c.Colors.DARK_BLUE,color:"white",cursor:"pointer"},link:{color:c.Colors.LIGHT_BLUE,cursor:"pointer",textDecoration:"none"},toolbar:{height:18,background:"black",color:"white",textAlign:"center",fontFamily:c.FontFamily.MONOSPACE,fontSize:c.FontSize.TITLE,lineHeight:"18px",userSelect:"none"},toolbarLeft:{position:"absolute",height:18,overflow:"hidden",top:0,left:0,marginRight:2,textAlign:"left"},toolbarRight:{height:18,overflow:"hidden",position:"absolute",top:0,right:0,marginRight:2,textAlign:"right"},toolbarTab:{background:c.Colors.DARK_GRAY,marginTop:2,height:16,lineHeight:"16px",paddingLeft:2,paddingRight:8,display:"inline-block",marginLeft:2,":hover":{background:c.Colors.GRAY,cursor:"pointer"}},toolbarTabActive:{background:c.Colors.LIGHT_BLUE,":hover":{background:c.Colors.LIGHT_BLUE}},noLinkStyle:{textDecoration:"none",color:"inherit"},emoji:{display:"inline-block",verticalAlign:"middle",paddingTop:"0px",marginRight:"0.3em"}});
},{"preact":3,"aphrodite":13,"./reloadable":4,"./import/bg-flamegraph":11,"./import/stackprof":10,"./import/chrome":12,"./flamechart-renderer":6,"./canvas-context":7,"./flamechart":8,"./flamechart-view":5,"./style":9}],1:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("preact"),t=require("./application");let o=null;const d=window.__retained__;module.hot&&(module.hot.dispose(()=>{o&&(window.__retained__=o.serialize())}),module.hot.accept());function i(e){o=e,e&&d&&e.rehydrate(d)}e.render(e.h(t.Application,{ref:i}),document.body,document.body.lastElementChild||void 0);
},{"preact":3,"./application":2}]},{},[1])